(function(c){function k(f,c,k,h,m){this._listener=c;this._isOnce=k;this.context=h;this._signal=f;this._priority=m||0}function h(f,c){if("function"!==typeof f)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",c));}function m(){this._bindings=[];this._prevParams=null;var f=this;this.dispatch=function(){m.prototype.dispatch.apply(f,arguments)}}k.prototype={active:!0,params:null,execute:function(f){var c;this.active&&this._listener&&(f=this.params?this.params.concat(f):
f,c=this._listener.apply(this.context,f),this._isOnce&&this.detach());return c},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+
", isBound:"+this.isBound()+", active:"+this.active+"]"}};m.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(f,c,h,m){var C=this._indexOfListener(f,h);if(-1!==C){if(f=this._bindings[C],f.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(!c?"":"Once")+"() the same listener without removing the relationship first.");}else f=new k(this,f,c,h,m),this._addBinding(f);this.memorize&&this._prevParams&&f.execute(this._prevParams);return f},
_addBinding:function(f){var c=this._bindings.length;do--c;while(this._bindings[c]&&f._priority<=this._bindings[c]._priority);this._bindings.splice(c+1,0,f)},_indexOfListener:function(f,c){for(var k=this._bindings.length,h;k--;)if(h=this._bindings[k],h._listener===f&&h.context===c)return k;return-1},has:function(f,c){return-1!==this._indexOfListener(f,c)},add:function(f,c,k){h(f,"add");return this._registerListener(f,!1,c,k)},addOnce:function(f,c,k){h(f,"addOnce");return this._registerListener(f,!0,
c,k)},remove:function(f,c){h(f,"remove");var k=this._indexOfListener(f,c);-1!==k&&(this._bindings[k]._destroy(),this._bindings.splice(k,1));return f},removeAll:function(){for(var f=this._bindings.length;f--;)this._bindings[f]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(f){if(this.active){var c=Array.prototype.slice.call(arguments),k=this._bindings.length,h;this.memorize&&(this._prevParams=
c);if(k){h=this._bindings.slice();this._shouldPropagate=!0;do k--;while(h[k]&&this._shouldPropagate&&!1!==h[k].execute(c))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var f=m;f.Signal=m;"function"===typeof define&&define.amd?define(function(){return f}):"undefined"!==typeof module&&module.exports?module.exports=f:c.signals=
f})(this);var OB={updateAtInterval:new signals.Signal,displayInterval:new signals.Signal,start:new signals.Signal,stop:new signals.Signal,preStart:new signals.Signal,preStop:new signals.Signal,insert:new signals.Signal,update:new signals.Signal,reset:new signals.Signal,remove:new signals.Signal,removeAll:new signals.Signal,init:new signals.Signal,options:new signals.Signal,postItemRender:new signals.Signal,postAllItemRender:new signals.Signal,onLoad:new signals.Signal,onUnLoad:new signals.Signal,onBeforeUnLoad:new signals.Signal};(function(){var c=this.Store=function(c,h){var m;this.name=c;if(void 0!==h)for(m in h)h.hasOwnProperty(m)&&void 0===this.get(m)&&this.set(m,h[m])};c.prototype.get=function(c){c="store."+this.name+"."+c;if(!("null"===localStorage.getItem(c)||null===localStorage.getItem(c)))try{return JSON.parse(localStorage.getItem(c))}catch(h){return null}};c.prototype.set=function(c,h){if(void 0===h)this.remove(c);else{if("function"===typeof h)h=null;else try{h=JSON.stringify(h)}catch(m){h=null}localStorage.setItem("store."+
this.name+"."+c,h)}return this};c.prototype.remove=function(c){localStorage.removeItem("store."+this.name+"."+c);return this};c.prototype.removeAll=function(){var c,h;c="store."+this.name+".";for(h=localStorage.length-1;0<=h;h--)localStorage.key(h).substring(0,c.length)===c&&localStorage.removeItem(localStorage.key(h));return this};c.prototype.toObject=function(){var c,h,m,f,v;c={};h="store."+this.name+".";for(m=localStorage.length-1;0<=m;m--)localStorage.key(m).substring(0,h.length)===h&&(f=localStorage.key(m).substring(h.length),
v=this.get(f),void 0!==v&&(c[f]=v));return c};c.prototype.fromObject=function(c,h){!0!==h&&this.removeAll();for(var m in c)c.hasOwnProperty(m)&&this.set(m,c[m]);return this}})();var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(c){for(var k=0;k<c.length;k++){var h=c[k].string,m=c[k].prop;this.versionSearchString=c[k].versionSearch||c[k].identity;if(h){if(-1!=h.indexOf(c[k].subString))return c[k].identity}else if(m)return c[k].identity}},
searchVersion:function(c){var k=c.indexOf(this.versionSearchString);if(-1!=k)return parseFloat(c.substring(k+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",
identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",
identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();$.ajaxSetup({beforeSend:function(c){c.setRequestHeader("Accept-Language","en")}});
var attask=function(){function c(a){if(e.get("host")){e.set("general",!1);var b=e.get("host").replace(/[|&;$%@"<>()+,]/g,""),d=new Date;d.setHours(d.getHours()-d.getTimezoneOffset()/60);var g=function(a){a&&(TASK_CNTRL.showWindow('<div class="content">'+a+'<div id="close" class="btn btn-primary" style="width:290px"><h3 style="line-height:0px">close</h3></div></div>'),jQuery("#close").unbind("click").click(function(a){a.preventDefault();TASK_CNTRL.hideWindow()}))},b={url:"https://"+Ga+"/Tools/Subform/UsageTracker.aspx?f=Stopwatch",
data:JSON.stringify({dateTime:d.toJSON(),activity:{request:b},userID:e.get("userID"),username:e.get("username")}),dataType:"json",type:"POST"},b=jQuery.ajax(b);b.done(function(b,E,f){b.date&&e.set("license_expiry_days",Math.floor(((new Date(b.date)).getTime()-d.getTime())/864E5));if(b.isValid){try{b.message=JSON.parse(b.message),b.isWarn&&(console.log(b.message.message),b.message.message&&g(b.message.message))}catch(c){void 0==e.get("access")?aa(e.get("username"),e.get("password"),ba(e.get("host")+
"."+e.get("domain")),a,function(){ca(a)},!0):(!0!=e.get("is_auth")&&(e.set("access","demo"),e.set("is_auth",!1)),a&&a());console.log(b.message);return}e.set("ent",!0);e.set("updateAtInterval",void 0!=b.message.updateAtInterval?b.message.updateAtInterval:!1);e.set("userHostName",b.message.userHostName);e.set("stopOnClose",void 0!=b.message.stopOnClose?b.message.stopOnClose:!1);e.set("forceHourTypeID",b.message.forceHourTypeID);e.set("maxTaskTime",void 0!=b.message.maxTaskTime?parseFloat(b.message.maxTaskTime):
8.5);e.set("hideTaskButtons",void 0!=b.message.hideTaskButtons?b.message.hideTaskButtons:!1);e.set("projectFilter",void 0!=b.message.projectFilter?b.message.projectFilter:!0);e.set("projectsAll",void 0!=b.message.projectsAll?b.message.projectsAll:!0);e.set("personalTasks",void 0!=b.message.personalTasks?b.message.personalTasks:!0);e.set("useCalculatedDueDate",void 0!=b.message.useCalculatedDueDate?b.message.useCalculatedDueDate:!1);e.set("showParent",void 0!=b.message.showParent?b.message.showParent:
!1);e.set("searchScore",void 0!=b.message.searchScore?b.message.searchScore:0.6);e.get("hideTaskButtons")&&e.set("sort","project");C();var h=function(){e.set("is_auth",!0);e.set("auth_key",!0);b.message.apiKey&&(e.set("password",null),e.set("apiKey",b.message.apiKey));a&&a();jQuery("#top-bar").show();da()};(void 0!=b.message.forceLogin?b.message.forceLogin:1)?void 0==e.get("sessionID")?N(h):h():!e.get("userID")&&e.get("username")?(E={url:t()+"user/search",type:"get",data:{fields:"ID",emailAddr:e.get("username"),
apiKey:b.message.apiKey},dataType:"json"},E=jQuery.ajax(E),E.done(function(b){void 0!=b.error?($error.html(b.error.message),q.hide(),void 0!==a&&N(h)):(b=b.data,b.length&&e.get("password")==b[0].ID.slice(-6)?(e.set("userID",b[0].ID),h()):N(h))}),E.fail(function(a,b,d){console.log(d);q.hide();void 0!==h&&N(h)})):h()}else e.set("is_auth",!1),console.log(b.message),b.isWarn&&(console.log(b.message),b.message&&g(b.message)),F()});b.fail(function(b,d,g){a&&a()})}else F()}function k(a){e.set("updateAtInterval",
!1);e.set("general",!0);if(e.get("ent"))c(a);else{var b=-1==window.location.origin.indexOf("atappstore.com")?"https://"+la:window.location.origin,d=e.get("qr")?"shiftwatch-qr":"stopwatch",b={url:b+"/api/authorize/",data:{product:d,host:e.get("host"),sessionID:e.get("sessionID"),user:e.get("username"),domain:e.get("domain")},type:"GET",dataType:"json"};x(b);b=jQuery.ajax(b);b.done(function(b,d,E){!1!=b.success&&(e.set("auth_key",b.auth_key),e.set("access",b.access),e.set("is_auth",b.is_auth),e.set("license_expiry_days",
b.license_expiry_days),e.get("qr")&&(e.set("view","team"),e.set("sort","project"),e.set("logout_on_select",!0),e.set("multi",!0),e.set("hide_team_done",!0),e.set("minuteBuffer",30),e.set("minuteBufferSnapToSched",!0),TASK_DB.userId=e.get("userID")),e.get("minuteBufferSnapToSched")&&ma(),e.get("restrict_sched")?ma(function(b){var d;void 0==b&&(d="Today is not a work day");var g=new Date,g=Date.parse("01/01/2011 "+g.getHours()+":"+g.getMinutes()),l=Date.parse("01/01/2011 "+b.start),E=Date.parse("01/01/2011 "+
b.stop),f=e.get("minuteBuffer");null!=f&&(l.setMinutes(l.getMinutes()-f),E.setMinutes(E.getMinutes()+f));void 0==b||l>g||g>E?(d=d?d:"Please return at "+b.start,TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Not scheduled to work</h3></div><div class="content"><p>'+d+'.</p><a href="#" class="btn btn-primary logout cancel" title="Logout">Logout</a></div>')):a()}):na(a))});b.fail(function(a,b,d){})}}function h(){var a={url:t()+"user/count",type:"get",data:{},dataType:"json"};
x(a);a=jQuery.ajax(a);a.done(function(a){void 0!=a.error?(a.error["class"]==y[0]?u(function(){}):f(s[0],"uCount,"+JSON.stringify(a.error)),n.hide(),q.hide()):(a=a.data,f(s[1],{uc:a.count}))});a.fail(function(a,d,g){w({response:a.responseText,type:d,msg:g,status:a.status},h,"uCount")})}function m(){var a={url:t()+"user/search?ID=$$USER.ID&fields=name,customer:name,customer:fullUsers,customer:limitedUsers,customer:teamUsers",type:"get",data:{},dataType:"json"};x(a);a=jQuery.ajax(a);a.done(function(a){void 0!=
a.error?(a.error["class"]==y[0]?u(function(){}):f(s[0],"uInfo,"+JSON.stringify(a.error)),n.hide(),q.hide()):(a=a.data,a.name&&e.set("name",a.name),f(s[1],a))});a.fail(function(a,d,g){w({response:a.responseText,type:d,msg:g,status:a.status},m,"uInfo")})}function f(a,b,d){TASK_DB.setEvent(a,JSON.stringify(b))}function v(){if(P||H||void 0!=e.get("host")&&"full"==getQueryString("view"))window.clearInterval(U),U=window.setInterval(function(){if(navigator.onLine&&(H||!document.hasFocus()))jQuery("#search-bar").is(":visible")&&
jQuery("#search").click(),jQuery("#form-list").hide(),!e.get("apiKey")&&!e.get("sessionID")?F():Q()},1E3*(Ha+120))}function p(a,b){var d;return(d=e.get("maxTaskTime"))&&void 0!=d&&d<=Number((b/3600).toFixed(2))?(a=TASK_DB.get(a.ID),a.disable=1,TASK_DB.setTask(a),TASK_CNTRL.toggleTimer(a),d=jQuery("#item"+a.ID),d.find(".timer").unbind("click").addClass("disabled"),d.find(".timer-info").text("Max Reached"),!0):!1}function z(){var a=new Date;a.setHours(23,59,0,0);var b=new Date;clearTimeout(Ia);Ia=setTimeout(function(){TASK_DB.running(function(a){TASK_CNTRL.toggleTimer(a)})},
a-b);clearTimeout(Ja);Ja=setTimeout(function(){location.reload()},a-b+65E3)}function G(){var a=!1;if(void 0==e.get("date")||(new Date(e.get("date"))).getDay()!=(new Date).getDay())oa(),a=!0;Q();return a}function C(){var a=e.get("license_expiry_days"),b=jQuery("#licence"),d="silver";if(e.get("ent")){var g="";b.text("Enterprise").css("color",d);var b=jQuery("#licence-renew"),l=new Date;0<a&&(l.setDate(l.getDate()+a),g="Please renew your Annual License before it expires in "+a+" Days on "+l.toLocaleDateString(),
14>=a?d="red":90>=a?d="orange":g="");g?(b.text(g).parent().css("background-color",d),b.parent().show()):b.parent().hide()}else 0<a?b.text("Expires in "+a+" day(s)").css("color","red"):Ra()}function oa(){jQuery("#form-list").empty();e.set("notified",!1);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();var a=new Date;jQuery("#todayDate").html("Date: "+pa(a.getMonth())+" "+a.getDate());z();e.set("date",a.toDateString());e.get("ent")&&c(function(){})}function ea(){var a=e.get("view");
void 0==a?Ka():jQuery("#button-"+a).click()}function Ka(){jQuery("#button-current").click()}function Sa(a,b){for(var d='<div style="text-align: center; font-weight: bold;"><h3>Track these Offline Tasks?</h3></div><div class="content"><div><p>Would you like to track time for the running task(s):',g=a.length,l=0;l<g;l++)d+="<p><strong>"+a[l].name+"</strong> with duration "+Number((a[l].duration/3600).toFixed(2))+" ?</p>";TASK_CNTRL.showWindow(d+'</p></div><div style="text-align:center"></div><div id="yes" class="btn btn-primary" style="width:230px"><h3 style="line-height:0px">Yes</h3></div><div id="no" class="btn btn-default" style="width:230px"><h3 style="line-height:0px">No</h3></div></div>');
jQuery("#yes").unbind("click").click(function(d){d.preventDefault();TASK_CNTRL.hideWindow();b(a)});jQuery("#no").unbind("click").click(function(a){a.preventDefault();TASK_CNTRL.hideWindow()})}function Ta(a){TASK_DB.running(function(b){"GEN"!=b.details.objCode&&void 0==a[b.syncID]&&fa(b)},function(a){})}function J(a){var b=a.name;e.get("showParent")&&null!=a.parent&&(b=(15<a.parent.name.length?a.parent.name.substring(0,15).concat("..."):a.parent.name)+" > "+b);return b}function fa(a){var b=a.syncID;
n.show();var d="OPTASK"==a.details.objCode?"CLS":"CPL",d={url:t()+a.details.objCode.toLowerCase()+"/"+b,data:{status:d},type:"get",dataType:"json"};x(d);d=jQuery.ajax(d);d.done(function(d){void 0!=d.error?d.error["class"]==y[0]?u(function(){fa(a)}):w({response:d.error,type:null,msg:null,status:null},function(){fa(a)},"setTaskDone,"+b):Ua(a);n.hide();q.hide()});d.fail(function(d,l,E){w({response:d.responseText,type:l,msg:E,status:d.status},function(){fa(a)},"checkTaskDone,"+b+", "+d.responseText)})}
function Ua(a){if(a.running){var b=new Date(a.start),b=Math.floor(((new Date).getTime()-b.getTime())/1E3);a.done=1;0==b||0==Number((b/3600).toFixed(2))?(a.running=!1,TASK_DB.setTask(a),TASK_CNTRL.toggleRunText()):(b='<div style="text-align: center; font-weight: bold;"><h3>Marked done in Workfront</h3></div><div class="content"><div><p>Would you like to track '+TASK_CNTRL.hms(b)+" for <strong>"+a.name+'</strong>?</p></div><div style="text-align:center"></div><div id="yes" class="btn btn-primary" style="width:230px"><h3 style="line-height:0px">Yes</h3></div><div id="no" class="btn btn-default" style="width:230px"><h3 style="line-height:0px">No</h3></div></div>',
TASK_CNTRL.showWindow(b),jQuery("#yes").unbind("click").click(function(b){b.preventDefault();TASK_CNTRL.hideWindow();TASK_CNTRL.stopTask(a)}),jQuery("#no").unbind("click").click(function(b){b.preventDefault();TASK_CNTRL.hideWindow();a.running=!1;TASK_DB.setTask(a);TASK_CNTRL.toggleRunText()}))}}function Ra(){if(e.get("userID")&&""==e.get("access")&&(jQuery("#licence").text("Expired").css("color","red"),!e.get("notified"))){e.set("notified",!0);var a='<div style="text-align: center; font-weight: bold;"><h3>Expired for '+
e.get("host")+'</h3></div><div class="content"><div><p>The Enterprise Stopwatch license (or 30 day trial) for your Workfront domain has expired. to obtain a license. Please visit </p></div><a href="http://store.atappstore.com/product/stopwatch" target="_blank">http://store.atappstore.com/product/stopwatch</a><div style="font-size: 10px;">* this notification will only appear once daily.</div></div><div id="close" class="btn btn-primary" style=""><h3 style="line-height:0px">close</h3></div>';TASK_CNTRL.showWindow(a);
jQuery("#close").unbind("click").click(function(a){a.preventDefault();TASK_CNTRL.hideWindow()});f(s[1],{os:BrowserDetect.OS,browser:BrowserDetect.browser,version:BrowserDetect.version,extension:!P,user:e.get("userObj"),license_expiry_days:e.get("license_expiry_days")});h();m()}}function Va(){document.onkeydown=function(a){a=window.event?event:a;if(66==a.keyCode&&a.ctrlKey){a=TASK_DB.getEvents();for(var b=0;b<a.length;b++)console.log("%c %s - %c %s - %c %s","color:blue",a[b].time,"color:orange",a[b].type,
"color:brown",a[b].message);console.log(TASK_DB.getEvents())}else 87==a.keyCode&&a.altKey&&window.open(t()+"work/myWork?fields=statusEquatesWith,primaryAssignment:status,canStart,isReady,isStatusComplete,parent:status,parent:canStart,parent:isReady,parent:isStatusComplete,project:statusEquatesWith,project:status,parent:statusEquatesWith,parent:primaryAssignment:status&sessionID="+e.get("sessionID"))};var a=jQuery("#content");a.after('<form id="form-qrlogin" class="form" style="display: none"><h3>Login to Workfront</h3><span class="error"></span><p><div id="outdiv" style="text-align:center;"></div><canvas id="qr-canvas" width="640" height="480" style="display:none;"></canvas><h4 id="result" style="text-align:center;"></h4><button type="submit" class="btn btn-success needsclick" style="display:none;" id="button-appscan" value="scan" tabindex="3">Scan</button><button type="submit" class="btn needsclick" style="" id="button-standard" tabindex="5">Standard Login</button><button type="submit" class="btn btn-primary needsclick" style="display:none;" id="button-qrlogin" value="login" tabindex="4">Login</button></form><div class="spinner-bottom"><div id="blockG_1" class="metro_blockG"></div><div id="blockG_2" class="metro_blockG"></div><div id="blockG_3" class="metro_blockG"></div></div>');
jQuery(document).on("click","#button-standard",function(a){a.preventDefault();N();jQuery("#form-qrlogin").show()});jQuery(document).on("click","#button-appscan",function(a){a.preventDefault();a=window.navigator.userAgent;a.match(/iPad/i)||a.match(/iPhone/i)?window.location="zxing://scan/?ret="+encodeURIComponent(window.location+"&code={CODE}"):window.location="http://zxing.appspot.com/scan?ret="+encodeURIComponent(window.location+"&code={CODE}")});a.after('<form id="form-login" class="form" style="display: none"><h3>Login to Workfront</h3><span class="error"></span><div><div style=""><label for="username">Username</label><input style="" type="text" name="username" id="username" class="text" tabindex="1"></div><div style="clear: both;" id="password-container"><label for="password">Password</label><input type="password" name="password" id="password" class="text" tabindex="2" autocomplete="off"/></div><div style="clear: both;"></div><label for="host">Subdomain</label><input type="text" name="host" id="host" class="text" tabindex="4"/></div><p>eg. <strong>Subdomain</strong>.my.workfront.com</p></p></br><button type="submit" class="btn btn-primary needsclick" id="button-login" value="login" tabindex="5">Login</button></form>');
jQuery(document).on("click","#singlesignon",function(a){jQuery("#password-container").toggle()});a='<div id="hourTypeWindow" class="window"><div style="text-align: center; font-weight: bold;"><h3>Track as Type:</h3></div><div class="content"><div><select id="hourTypeSelector" ></select><div><a href="#" id="done_hourType" class="btn btn-primary" rel="'+jQuery(this).attr("rel")+'" title="Start">Start</a><a href="#" id="cancel_hourType" class="btn" title="Cancel">Cancel</a><div><div></div>';jQuery("#window").after(a);
if(P||"full"==getQueryString("view")||H)jQuery("#popout").replaceWith('<span id="refresh" style="float: right;" title="Manual Refresh"><img src="core/img/refresh.gif"></span>'),jQuery("html").css("width","100%"),jQuery(document).on("click","#refresh",function(a){a.preventDefault();jQuery("#form-list").hide();jQuery("#search-bar").is(":visible")&&jQuery("#search").click();Q()});var a=new Date,b='<div id="top-menu"><div class="btn-group"><a id="filter" title="Filter for other assigned tasks and issues" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">Filters<span class="caret"></span></a><ul class="dropdown-menu">',
d;for(d in R)R.hasOwnProperty(d)&&(b+='<li id="filter-'+d+'"><a href="#" id="button-'+d+'" class="filter" title="'+R[d].d+'" >'+R[d].t+"</a></li>");b+='<div id="custom-filters"><div id="task-filters" style="display:none;"></div><div id="opTask-filters" style="display:none;"></div></div><li><a href="#" class="logout" id="button-logout" >Login as New User</a></li></ul></div><span id="totalHours" title="Go To Timesheets" class="btn" style="">Today\'s Hours: 0</span><span id="todayDate" class="btn disabled" style="">Date: '+
pa(a.getMonth())+" "+a.getDate()+"</span></div>";jQuery("#bar").html(b);La(R);jQuery(document).on("click","#totalHours",function(a){a.preventDefault();a="https://"+e.get("host")+"."+e.get("domain")+"/timesheets/current";H?window.open(a,"_blank","location=yes"):window.open(a);return!1});var g=function(a,b){for(var d in B)B.hasOwnProperty(d)&&d!=b&&(B[d]="desc");e.set("current_sort",{sort:b,order:B[b]});B[b]="asc"==B[b]?"desc":"asc";jQuery("#sort-menu").find(">ul>li>a").removeClass();jQuery(a).addClass("btn active");
sortable("#form-list","disable");jQuery("#form-list").removeClass("sortable")};jQuery(document).on("click","#sort-task",function(a){a.preventDefault();g(this,"task");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{order:B.task},{selector:".details",order:"desc"})});jQuery(document).on("click","#sort-project",function(a){a.preventDefault();a={selector:".details",order:B.projects};"projects"==e.get("view")&&(a={order:B.projects});
g(this,"projects");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},a,{selector:".details",order:"desc",useVal:!0,attr:"data-days"})});jQuery(document).on("click","#sort-date",function(a){a.preventDefault();g(this,"date");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:B.date,useVal:!0,attr:"data-days"},{selector:".details",
order:"desc"})});jQuery(document).on("click","#sort-priority",function(a){a.preventDefault();g(this,"priority");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:B.priority,useVal:!0,attr:"data-priority"},{selector:".details",order:"desc"})});jQuery(document).on("click","#sort-status",function(a){a.preventDefault();g(this,"status");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",
{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:B.status,useVal:!0,attr:"data-status"},{selector:".details",order:"desc"})});jQuery(document).on("click","#sort-order",function(a){a.preventDefault();g(this,"order");sortable("#form-list","enable");jQuery("#form-list").addClass("sortable");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:B.order,useVal:!0,attr:"data-order"},
{selector:".details",order:"desc"})});jQuery(document).on("click",".done",function(a){a.preventDefault();a=jQuery(this);var b=a.parent().parent(),d=b.children("span.name").attr("title"),b=b.children("span.details").attr("title");a='<div style="text-align: center; font-weight: bold;"><h3>Confirm</h3></div><div class="content"><div>Are you sure you completed <strong>'+d+"</strong><br>from <br><strong>"+b+'?</strong><div><br><a href="#" id="done_confirm" class="btn btn-primary" rel="'+a.attr("rel")+
'" title="Done">Done</a><a href="#" class="btn cancel" title="Cancel">Cancel</a><div>';TASK_CNTRL.showWindow(a)});jQuery(document).on("click","#done_confirm",function(a){a.preventDefault();TASK_DB.updateValidate(jQuery(this).attr("rel"),function(a){ga(a,function(a,b){b.running?(b.done=1,TASK_CNTRL.stopTask(b)):V(a,b)})});TASK_CNTRL.hideWindow()});jQuery(document).on("click","#cancel_confirm",function(a){a.preventDefault();TASK_CNTRL.hideWindow()});d=function(a){a.preventDefault();a=jQuery(this).find(".hour-note").attr("rel");
if((a=TASK_DB.get(a))&&a.time&&!a.running&&!a.disable)Wa(a,function(a,b){TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><div class="spinner"><div id="blockG_1" class="metro_blockG"></div><div id="blockG_2" class="metro_blockG"></div><div id="blockG_3" class="metro_blockG"></div></div><h3>Timesheet Hour Note:</h3></div><div class="content"><strong>'+a.name+'</strong><br><br><div><textarea maxlength="2000" rows="2" cols="100" class="comment" style="width:300px" id="comment_message">'+
(null==b.description?"":b.description)+'</textarea><div><a href="#" id="hour-note_confirm" class="btn btn-primary" task="'+a.ID+'" hour="'+b.ID+'" title="Update Note">Update Note</a><a href="#" class="btn cancel" title="Cancel">Cancel</a><div>')}),jQuery("textarea.comment").focus()};jQuery(document).on("click",".task-lower-block",d);jQuery(document).on("click",".general-lower-block",d);jQuery(document).on("click","#hour-note_confirm",function(a){a.preventDefault();$t=jQuery(this);TASK_DB.updateValidate($t.attr("task"),
function(a){Xa(a,$t.attr("hour"),jQuery("#comment_message").val())});TASK_CNTRL.hideWindow()});jQuery(document).on("click",".percent",function(a){a.preventDefault();a=jQuery(this);var b=jQuery("#form-list");b.scrollTop(b.scrollTop()+jQuery("#item"+a.attr("rel")).offset().top-100);if(0==a.children("input").length){var d=a.text().slice(0,-1);a.html("<input type='number' class='inputbox percent' value=\""+d+'">');var g=function(a){a=jQuery(a);var b=Number(a.val()).toFixed(0);isNaN(b)||0>b||100<b||d==
b?b=d:TASK_DB.updateValidate(a.parent().attr("rel"),function(a){ha(a,b)});a.parent().text(b+"%")};jQuery("input.percent").focus().blur(function(){g(this)}).keypress(function(a){13==a.which&&(g(this),a.preventDefault())})}});jQuery(document).on("click",".btn-comment",function(a){a.preventDefault();a=jQuery(this);a='<div style="text-align: center; font-weight: bold;"><h3>Comment</h3></div><div class="content"><strong>'+a.parent().parent().children("span.name").attr("title")+'</strong><br><br><div><textarea maxlength="2000" rows="2" cols="100" class="comment" style="width:300px" id="comment_message"></textarea><label style="float:right; margin-top: 10px;">Private:<input type="checkbox" name="isPrivate" id="comment_is_private" style="margin: 0 4px;"></label><div><a href="#" id="comment_confirm" class="btn btn-primary" rel="'+
a.attr("rel")+'" title="Comment">Comment</a><a href="#" class="btn cancel" title="Cancel">Cancel</a><div>';TASK_CNTRL.showWindow(a);jQuery("textarea.comment").focus()});jQuery(document).on("click","#comment_confirm",function(a){a.preventDefault();a=jQuery(this);var b=jQuery("#comment_is_private").is(":checked"),d=jQuery("#comment_message").val();if(!e.get("sessionID")){var g=e.get("username");e.get("name")&&(g=e.get("name")+" - "+e.get("username"));d+="\n\u23f1 Posted on behalf of "+g}TASK_DB.updateValidate(a.attr("rel"),
function(a){ia(a,d,b)});TASK_CNTRL.hideWindow()});var l=jQuery("#form-list");l.scroll(function(){e.set("vpos",l.scrollTop())});q=jQuery(".spinner-bottom");n=jQuery(".spinner")}function Ma(a,b){var d=jQuery("#"+a+"-filters").first(),g="",l;for(l in b)b.hasOwnProperty(l)&&(g+='<li><a href="#" id="button-'+l+'" class="filter" title="'+b[l].d+'" >'+b[l].t+"</a></li>");d.append(g);La(b)}function La(a){var b=jQuery(".filter"),d=jQuery("#active-filter"),g;for(g in a)a.hasOwnProperty(g)&&(jQuery("#active-filter").hide(),
jQuery("#button-"+g).attr("name",g),jQuery(document).on("click","#button-"+g,function(){var g=jQuery(this),f=g.attr("name");B=[];b.removeClass("btn");qa();d.html("Filter: "+g.text());d.css("display","inline-block");g.toggleClass("btn");e.set("view",f);a[f].f()}))}function F(){if(S&&e.get("allowOffline"))e.remove("apiKey"),e.remove("sessionID"),e.remove("userID"),e.remove("username"),e.remove("password"),e.remove("host"),e.remove("domain"),e.remove("alltasks");else{var a=e.get("qr");e.removeAll();
e.set("qr",a)}for(var b in TASK_CNTRL.update_intervals)window.clearInterval(TASK_CNTRL.update_intervals[b]);for(b in TASK_CNTRL.display_intervals)window.clearInterval(TASK_CNTRL.display_intervals[b]);ca()}function D(a){TASK_DB.loadAll(function(b){var d=b.length,g,l;if(0<d)for(g=0;g<d;g++)l=b[g],null!=l&&"GEN"!=l.details.objCode&&jQuery("#item"+l.ID).hide();a()})}function u(a){getQueryString("sid")?(e.set("sessionID",""),window.opener.postMessage({refresh:!0})):e.get("ent")?na(a):aa(e.get("username"),
e.get("password"),ba(e.get("host")+"."+e.get("domain")),a,function(){ca(a)})}function ca(a){e.get("qr")?Ya(a):N(a)}function na(a,b){n.show();jQuery("#loading").hide();window.clearInterval(U);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();e.set("date",(new Date).toDateString());n.hide();q.hide();jQuery("#top-bar").hide();jQuery("#bar").hide();jQuery(".form").hide();c(function(){var d=e.get("sessionID");(void 0==d||""==d)&&!e.get("apiKey")?F():Q(function(){C();ra();void 0!=a&&
a()},function(a){C();void 0!=b?b():ca(a)})})}function Ya(a){n.show();jQuery("#loading").hide();window.clearInterval(U);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();resetForQR();n.hide();q.hide();jQuery("#top-bar").hide();jQuery("#bar").hide();jQuery(".form").hide();jQuery("webcamimg").show();var b=jQuery("#form-qrlogin");jQuery("#form-list").html("");H?b.show():b.slideDown(400,function(){});jQuery("#button-qrlogin").unbind("click").click(function(b){var g=jQuery("#form-qrlogin");
b.preventDefault();q.show();aa(e.get("username"),e.get("password"),ba(e.get("host")),function(){ignoreForQR();jQuery("#bar").show();H?g.hide():g.slideUp();jQuery("#top-bar").show();jQuery("#loading").show();void 0!=a&&a()},function(){resetForQR()})})}function N(a){n.show();jQuery("#loading").hide();window.clearInterval(U);e.set("apiKey","");e.set("sessionID","");e.set("userID","");e.set("ent",!1);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();e.set("date",(new Date).toDateString());
n.hide();q.hide();jQuery("#top-bar").hide();jQuery("#bar").hide();jQuery(".form").hide();var b=jQuery("#form-login"),d=e.get("domain"),g=e.get("host");b.find(":input[name='username']").focus().val("");b.find(":input[name='host']").val(void 0==g||"undefined"==g?"":"my.workfront.com"!=d||"testdrive.workfront.com"!=d?g+"."+d:g);b.find(":input[name='password']").val("");jQuery("#form-list").html("");var l=jQuery("#username");H?(b.show(),l.focus()):b.slideDown(400,function(){l.focus()});jQuery("#button-login").unbind("click").click(function(d){d.preventDefault();
q.show();aa(jQuery.trim(b.find(":input[name='username']").val()),jQuery.trim(b.find(":input[name='password']").val()),ba(jQuery.trim(b.find(":input[name='host']").val())),function(){jQuery("#bar").show();H?b.hide():b.slideUp();jQuery("#top-bar").show();jQuery("#loading").show();void 0!=a&&a()})})}function T(a,b,d){var g=new Date;a.dateStr=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();a.duration=b;navigator.onLine?ja(a,Za,d):(b=e.get("offlineTasks"),void 0==b&&(b=[]),b.push(a),e.set("offlineTasks",
b),a.running=0,a.interval=0,TASK_DB.setTask(a),TASK_CNTRL.toggleRunText(),n.hide(),q.hide(),!0==e.get("logout_on_select")&&F())}function sa(a){ja(a,function(a,d){var g=new Date,l={entryDate:g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate(),ownerID:e.get("userID")};l.extRefID=d&&d.extRefID?"ON!"+g.getHours()+":"+g.getMinutes()+";"+d.extRefID:"ON~"+g.getHours()+":"+g.getMinutes()+".";l.extRefID=l.extRefID.substring(0,254);void 0==d||-1!=d.permissions.actions.indexOf("ADD_HOURS")&&-1!=d.permissions.actions.indexOf("CHANGE_STATUS")?
(l.hours=0.01,l.method="POST"):(l.method="PUT",l.ID=d.ID);if("GEN"==a.details.objCode)l.hourTypeID=a.syncID;else{switch(a.details.objCode){case "OPTASK":l.opTaskID=a.syncID;break;case "TASK":l.taskID=a.syncID;break;case "PROJ":l.projectID=a.syncID;break;default:l.hourTypeID=a.syncID}l.hourTypeID||(l.hourTypeID=e.get("forceHourTypeID"),void 0==l.hourTypeID&&(void 0!=a.details.hourTypeID&&""!=a.details.hourTypeID)&&(l.hourTypeID=a.details.hourTypeID))}g={url:t()+"hour/",type:"get",data:l,dataType:"json",
async:!1};x(g);g=jQuery.ajax(g);g.done(function(d){void 0!=d.error?d.error["class"]==y[0]?u(function(){setHourAttask()}):w({response:d.error,type:null,msg:null,status:null},function(){sa(a)},"logStart,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(l)+" "+I(a)):(void 0!=l.taskID||void 0!=l.opTaskID)&&W(a)});g.fail(function(d,g,e){w({response:d.responseText,type:g,msg:e,status:d.status},function(){sa(a)},"logStart-fail,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(l)+" "+I(a)+","+a.duration+
", "+d.responseText+", "+e,"Error occured, perform action in Workfront.");window.setTimeout(function(){TASK_CNTRL.stopTask(a);TASK_CNTRL.toggleRunText()},2E3);n.hide();q.hide()})})}function pa(a){return"Jan. Feb. Mar. Apr. May June Jul. Aug. Sep. Oct. Nov. Dec.".split(" ")[a]}function I(a){return void 0!=a.details.project?a.details.project.name.split(",").join(" ")+","+a.name.split(",").join(" "):a.details}function x(a,b,d){void 0==d&&(d=!1);void 0==b&&(b=1E4);a.timeout=b;P&&!Na&&(a.dataType="jsonp",
a.crossDomain=!0,a.jsonp="jsonp",a.cache=!0);b=e.get("sessionID");var g=e.get("apiKey");g&&(!d||!b)?("PUT"==a.data.method&&(a.type="POST"),a.data.apiKey=g):b&&(a.data.sessionID=b)}function ba(a){if(1<a.split(".").length){var b=a.split("//");return 1<b.length?(b.shift(),b[0]):a}return a+".my.workfront.com"}function aa(a,b,d,g,l,f){if(void 0==a||void 0==b||void 0==d)l();else{var h=jQuery(".error");h.html("");!f&&6==b.length&&""!=d?(e.set("username",a),e.set("password",b),f=d.split("."),e.set("host",
f[0]),f.shift(),e.set("domain",f.join(".")),c(function(){q.hide();K();v();void 0!=g&&g()})):(f={url:"https://"+d+"/attask/api/v20.0/login",type:"POST",data:{username:a,password:b,method:"POST"},dataType:"json"},x(f),S?(f=e.get(a),void 0!=f?(Oa(f.sessionID,f.userID,f.username,f.password,d),q.hide(),K(),v(),void 0!=g&&g()):h.html("OFFLINE")):(f=jQuery.ajax(f),f.done(function(f){void 0!=f.error?(e.get("qr")?h.html("Please Scan Again."):h.html(f.error.message),q.hide(),void 0!==l&&l()):(f=f.data,Oa(f.sessionID,
f.userID,a,b,d),e.set("userObj",JSON.stringify(f)),q.hide(),k(function(){e.get("ent")||K();v();void 0!=g&&g()}))}),f.fail(function(a,b,g){a.responseText&&""!==a.responseText?-1!=a.responseText.indexOf("<html>")?e.get("qr")?h.html("Please Scan Again."):h.html("Host Invalid: "+d):e.get("qr")?h.html("Please Scan Again."):h.html(JSON.parse(a.responseText).error.message.replace("Authentication Exception: Authentication Exception: {0}","Wrong login, please try again.")):e.get("qr")?h.html("Please Scan Again."):
h.html("Host Invalid: "+d);q.hide();void 0!==l&&l()})))}}function Oa(a,b,d,g,l){e.set("sessionID",a);e.set("userID",b);e.set("username",d);e.set("password",g);l=l.split(".");e.set("host",l[0]);l.shift();e.set("domain",l.join("."));e.get("allowOffline")&&e.set(d,{sessionID:a,userID:b,username:d,password:g})}function Q(a,b){var d=e.get("sessionID");(void 0==d||""==d)&&!e.get("apiKey")?u(a):e.get("userID")?(n.show(),d={url:t()+"user/"+e.get("userID"),data:{method:"PUT",updates:"{isActive: true}"},type:"get",
dataType:"json"},x(d),d=jQuery.ajax(d),d.done(function(d){void 0!=d.error?(d.error["class"]==y[0]?void 0!=b?b(a):u(a):f(s[0],"sessionValid,"+e.get("sessionID")+","+JSON.stringify(d.error)),n.hide(),q.hide()):(d.data.name&&e.set("name",d.data.name),n.hide(),q.hide(),void 0==e.get("auth_key")?k(K):K(),void 0!=a&&a())}),d.fail(function(d,l,c){422==d.status&&e.get("apiKey")?w({response:"",type:l,msg:c,status:d.status},function(){e.set("apiKey","");e.get("sessionID")?Q(a,b):F()},"sessionValid","Please contact your internal stopwatch support, API Key invalid"):
401==d.status?void 0!=b?b(a):u(a):"timeout"==l?Q(a,b):f(s[0],"sessionValid,"+e.get("sessionID")+","+d.responseText)})):(console.log("UserID not found"),F())}function K(){n.show();ta();if((L||X)&&e.get("alltasks"))TASK_CNTRL.taskDB.loadAll(function(a){TASK_CNTRL.showAll(a)});else{Pa();var a=e.get("userID"),b={url:t("api-internal")+"timeSheet/search",type:"get",data:{startDate:"$$TODAY+1",startDate_Mod:"lte",endDate:"$$TODAY-1",endDate_Mod:"gte",fields:"extRefID,startDate,timesheetProfile:description,timesheetProfile:hourTypes:ID,timesheetProfile:hourTypes:name,timesheetProfile:hourTypes:description,timesheetProfile:hourTypes:scope,timesheetProfile:hourTypes:isActive",
userID:a},dataType:"json"};x(b,35E3);S?e.get("allowOffline")?(a=TASK_DB.userRunningTasks(a),void 0!=a&&(A=!0,TASK_DB.insert(a.name,{syncID:a.syncID,details:a.details},!0))):TASK_CNTRL.displayError("OFFLINE"):(a=jQuery.ajax(b),a.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?u(function(){K()}):f(s[0],"addGeneralTasks-done,"+JSON.stringify(a.error));else{a=a.data;if(0!=a.length){var b=new Date(e.get("launched"));if(null==a[0].extRefID)Y(a[0].ID,b,0);else if(e.get("updateAtInterval")){var l=
0,c=1;if(isNaN(parseInt(a[0].extRefID)))var h=JSON.parse(a[0].extRefID),l=h.last_launched,c=parseInt(h.count);else l=a[0].extRefID;l=new Date(parseInt(l));if(0<l.getTime()){if(l.getTime()>b.getTime()){TASK_CNTRL.showWindow('<div class="content"><h3>Stopwatch has been launched on another computer at '+l.toLocaleTimeString()+', Would you like to keep this stopwatch?</h3><div style="text-align:center"></div><div id="dupe-yes" class="btn btn-primary" style="width:230px"><h3 style="line-height:0px">Yes</h3></div><div id="dupe-no" class="btn btn-default" style="width:230px"><h3 style="line-height:0px">No</h3></div></div></div>');
jQuery("#dupe-yes").unbind("click").click(function(b){b.preventDefault();n.show();TASK_CNTRL.hideWindow();b=new Date;e.set("launched",b.getTime());Y(a[0].ID,b,c,function(){K()})});jQuery("#dupe-no").unbind("click").click(function(a){a.preventDefault();n.show();jQuery("#holder").empty();e.get("updateAtInterval")?(TASK_DB.running(function(a){T(a,-Ha)}),setTimeout(function(){oa();window.close();TASK_CNTRL.hideWindow()},2E3)):(oa(),window.close(),TASK_CNTRL.hideWindow())});return}l.getTime()!=b.getTime()&&
Y(a[0].ID,b,c)}}}if(0!=a.length&&void 0!=a[0].timesheetProfile&&void 0!=a[0].timesheetProfile.hourTypes)if(a[0].timesheetProfile.description==$a&&H)jQuery(".holder").empty(),TASK_CNTRL.showWindow('<div class="content"><h3>Please use Stopwatch on a desktop computer.</h3></div>'),n.hide(),q.hide();else if(b=e.get("userHostName"),void 0!=b&&-1==a[0].timesheetProfile.description.indexOf(b)&&!getQueryString("force_host"))jQuery(".holder").empty(),TASK_CNTRL.showWindow('<div class="content"><h3>Please use Stopwatch on a work computer.</h3></div>'),
n.hide(),q.hide();else{if(0!=a[0].timesheetProfile.hourTypes.length){var b=0,l=a[0].timesheetProfile.hourTypes,k;for(k in l)l.hasOwnProperty(k)&&(!0==l[k].isActive&&"P"!=l[k].scope)&&(b++,TASK_DB.insert(l[k].name,{syncID:l[k].ID,details:{objCode:"GEN",description:null!=l[k].description?"General - "+l[k].description:"'General"}},0))}ea()}else e.get("general")?ua():ea()}}),a.fail(function(a,g,l){w({response:a.responseText,type:g,msg:l,status:a.status},K,"addGeneralTasks-fail"+g+"-"+l+" "+a.responseText+
" "+a.status+" "+JSON.stringify(b))}))}}function Y(a,b,d,g){var l={url:t()+"timeSheet/",type:"get",data:{ID:a,extRefID:JSON.stringify({last_launched:b.getTime(),count:++d}),method:"PUT"},dataType:"json"};x(l);var e=jQuery.ajax(l);e.done(function(l){void 0!=l.error?l.error["class"]==y[0]?u(function(){Y(a,b,d,g)}):f(s[0],"ownTimesheet,"+a+JSON.stringify(l.error)):void 0!=g&&g()});e.fail(function(f,e,c){w({response:f.responseText,type:e,msg:c,status:f.status},function(){Y(a,b,d,g)},"ownTimesheet-fail"+
a+" "+e+"-"+c+" "+f.responseText+" "+f.status+" "+JSON.stringify(l))})}function ra(){var a={url:t()+"HourType/search",type:"get",data:{fields:"ID",description:"Stopwatch",description_Mod:"cicontains"},dataType:"json"};x(a);var b=jQuery.ajax(a);b.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?u(function(){ra()}):f(s[0],"getStopwatchHourType-done,"+JSON.stringify(a.error));else if(0!==a.data.length){var b={};a.data.forEach(function(a,d){b[a.name]=a.ID});e.set("sw_hour_types",b)}});b.fail(function(b,
g,l){w({response:b.responseText,type:g,msg:l,status:b.status},ra,"getStopwatchHourType-fail"+g+"-"+l+" "+b.responseText+" "+b.status+" "+JSON.stringify(a))})}function da(){n.show();var a={filterType:"STANDARD",fields:"name, definition, enteredByID",method:"get"};ab||(a.enteredByID_Mod="notnull");a={url:t()+"uift/filtersForObjCode/",data:a,type:"GET",dataType:"json"};x(a);var b=jQuery.extend(!0,{},a);b.data.objCode="OPTASK";a.data.objCode="TASK";jQuery.when(jQuery.ajax(a),jQuery.ajax(b)).done(function(a,
b){a=a[0];b=b[0];var l=void 0!=a.error?a.error:b.error;void 0!=l?l["class"]==y[0]?N(function(){da()}):f(s[0],"addCustomFilters,"+JSON.stringify(r.error)):(Ma("task",Qa("task",a.data)),Ma("opTask",Qa("opTask",b.data)),l=jQuery("#opTask-filters"),l.children().length&&l.show(),l=jQuery("#task-filters"),l.children().length&&l.show(),void 0==R[e.get("view")]&&ea())}).fail(function(a,b,l){if(401==a.status){if(-1!=this.url.indexOf("apiKey")&&e.get("apiKey")&&(jQuery(".error").html("Please contact your internal stopwatch support, API Key invalid"),
e.get("sessionID"))){e.set("apiKey","");da();return}u(function(){})}else w({response:a.responseText,type:b,msg:l,status:a.status},da,"addCustomFilters-fail"+b+"-"+l+" "+a.responseText+" "+a.status)})}function Qa(a,b){var d="task"==a?"task":"issue",g={},l=-1;b.sort(function(a,b){return a.name.localeCompare(b.name)});for(var f in b)if(b.hasOwnProperty(f)&&(l=b[f].name.indexOf(" - Stopwatch"),null!=b[f].enteredByID&&-1!=l)){var c={},h,k;for(k in b[f].definition)h=b[f].definition[k].replace(/&/g,"%26").replace("$$USER.ID",
e.get("userID")),-1==h.indexOf("$$USER")&&(c[k]=h.split("\t"));g[b[f].ID]={q:jQuery.param(c).replace(RegExp("%5B%5D","g"),""),f:function(){return va(a,this.q)},t:b[f].name.substr(l),d:"Custom "+d+" filter: "+bb(c)}}return g}function bb(a){var b="",d;for(d in a)a.hasOwnProperty(d)&&(b+=d+"="+a[d]+"\n");return b}function va(a,b){var d={};a=void 0==a?"task":a;d.fields="parent,extRefID,priority,project,project:hourTypes,project:status,plannedCompletionDate,permissions,canStart,status";"task"==a&&(d.fields+=
",percentComplete");n.show();var g={url:t()+a+"/search?"+b,type:"get",data:d,dataType:"json"};e.get("useCalculatedDueDate")&&(g.data["DE:Calculated Due Date_Mod"]="notnull",g.data.fields+=",DE:Calculated Due Date");x(g);g=jQuery.ajax(g);g.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?u(function(){va(a,d)}):f(s[0],"addFilteredTasks,"+JSON.stringify(b.error)),n.hide(),q.hide()):(b=b.data,0==b.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){var a=b.length;A=!0;for(var d,g=0;g<
a;g++)d=-1!=["CPL","DED","REJ","CLS","RLV"].indexOf(b[g].status)?1:!1==b[g].canStart||e.get("useCalculatedDueDate")&&!b[g]["DE:Calculated Due Date"]||-1==b[g].permissions.actions.indexOf("ADD_HOURS")&&-1==b[g].permissions.actions.indexOf("CHANGE_STATUS"),TASK_DB.insert(J(b[g]),{syncID:b[g].ID,details:b[g],disable:d},g==a-1)}))});g.fail(function(a,b,g){w({response:a.responseText,type:b,msg:g,status:a.status},va(b,d),"addFilteredTasks")})}function ua(){n.show();var a={url:t()+"HourType/search?nameKey=default.hourtype.optask&nameKey=default.hourtype.task&nameKey=default.hourtype.project&nameKey_Mod=notin",
type:"get",data:{fields:"ID,name,description",isActive:!0,scope:"G",countAsRevenue:!0},dataType:"json"};x(a,35E3);var b=jQuery.ajax(a);b.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?u(function(){ua()}):f(s[0],"addAllGeneralTasks-done,"+JSON.stringify(a.error));else{a=a.data;var b=0,e;for(e in a)a.hasOwnProperty(e)&&("Task Time"!=a[e].name&&"Issue Time"!=a[e].name)&&(b++,TASK_DB.insert(a[e].name,{syncID:a[e].ID,details:{objCode:"GEN",description:null!=a[e].description?"General - "+a[e].description:
"'General"}},0));ea()}});b.fail(function(b,g,f){w({response:b.responseText,type:g,msg:f,status:b.status},ua,"addAllGeneralTasks-fail"+g+"-"+f+" "+b.responseText+" "+b.status+" "+JSON.stringify(a))})}function w(a,b,d,g){if(401==a.status||0==a.status)u(function(){b&&b()});else if("timeout"==a.type)b&&b();else{if(void 0!=a.response&&""!=a.response){var e;e="object"===typeof a.response?a.response.message:"string"===typeof a.response?JSON.parse(a.response).error.message:"object"===typeof a.error?a.error.message:
JSON.stringify(a.response);TASK_CNTRL.displayError("Workfront Error: "+e+"<br>"+(void 0!=g&&""!=g?g:""))}else TASK_CNTRL.displayError("Error: "+(void 0!=g&&""!=g?g:"Failed to perform action"));f(s[0],d+","+a.msg+" "+a.type+" "+JSON.stringify(a.response)+" "+g)}}function t(a){void 0==a&&(a="api/v20.0");var b="";e.get("domain")&&(b="."+e.get("domain"));return"https://"+e.get("host")+b+"/attask/"+a+"/"}function wa(){n.show();var a={url:t()+"proj/search?statusEquatesWith=CUR&statusEquatesWith=QUE&statusEquatesWith_Mod=in&projectedCompletionDate=$$TODAYb-2w&projectedCompletionDate_Mod=gt&$$LIMIT=2000",
data:{fields:"priority, permissions, hourTypes, status, extRefID, plannedCompletionDate, percentComplete",method:"get"},type:"GET",dataType:"json"};e.get("useCalculatedDueDate")&&(a.data["DE:Calculated Due Date_Mod"]="notnull",a.data.fields+=",DE:Calculated Due Date");x(a);e.get("projectsAll")||(a.data["projectUsers:userID"]=e.get("userID"));jQuery.ajax(a).done(function(a){var d=a.error;void 0!=d?d["class"]==y[0]?u(function(){wa()}):f(s[0],"addCurrentProjects,"+JSON.stringify(r.error)):D(function(){A=
!0;for(var d=a.data,f=d.length,c,h=0;h<f;h++)c=d[h],c.project=jQuery.extend(!0,{},c),c.type="Project",(!e.get("useCalculatedDueDate")||c["DE:Calculated Due Date"])&&TASK_DB.insert(J(c),{syncID:c.ID,details:c},h==f-1)})}).fail(function(a,d,g){w({response:a.responseText,type:d,msg:g,status:a.status},wa,"addCurrentProjects-fail"+d+"-"+g+" "+a.responseText+" "+a.status)})}function O(a,b,d){a=void 0==a?"task":a;d=void 0==d?!1:d;n.show();var g={url:t()+"assgn/search?"+a+":statusEquatesWith=NEW&"+a+":statusEquatesWith=INP&"+
a+":statusEquatesWith=ONH&"+a+":statusEquatesWith=AWF&"+a+":statusEquatesWith=ROP&project:statusEquatesWith=IDA&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE",type:"get",data:{},dataType:"json"};g.data[a+":statusEquatesWith_Mod"]="in";g.data["project:statusEquatesWith_Mod"]="in";g.data.fields=a+":parent,"+a+":canStart,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":plannedCompletionDate,"+a+":status, "+a+":extRefID,"+a+":permissions";g.data.status="DN";
g.data.status_Mod="ne";g.data.assignedToID=e.get("userID");g.data.$$LIMIT=2E3;d&&(g.data["project:projectedCompletionDate"]="$$TODAYb-2w",g.data["project:projectedCompletionDate_Mod"]="gt");var l=e.get("currentRole");"role"==e.get("view")&&void 0!=l?g.data[a+":roleID"]=l.ID:g.data.assignedToID=e.get("userID");"task"==a&&(g.data[a+":canStart"]=!0,g.data.fields+=","+a+":percentComplete");e.get("useCalculatedDueDate")&&(g.data["DE:"+a+":Calculated Due Date_Mod"]="notnull",g.data.fields+=",DE:"+a+":Calculated Due Date");
x(g);g=jQuery.ajax(g);g.done(function(g){if(void 0!=g.error)g.error["class"]==y[0]?u(function(){O(a,b,d)}):f(s[0],"addAllAssignedTasks-"+a+","+JSON.stringify(g.error)),n.hide(),q.hide();else{g=g.data;var l=!0,c=e.get("view");"all"!=c&&"role"!=c&&(l=!1);var h=e.get("hour_type_list");if("opTask"!=a)O("opTask",b,d),D(function(){var a=[];if(void 0!=h)for(var b=0;b<h.length;b++)void 0==a[h[b].ID]&&(a[h[b].ID]=!0);var d=g.length;if(d)for(b=0;b<d;b++){var f=g[b].task;if(-1!=f.permissions.actions.indexOf("ADD_HOURS")&&
-1!=f.permissions.actions.indexOf("CHANGE_STATUS")){var c=!1;if(0<a.length&&Array.isArray(f.project.hourTypes)&&f.project.hourTypes.length)for(var k=0;k<f.project.hourTypes.length;k++){if(void 0!=h[f.project.hourTypes[k].ID]){c=!0;break}}else c=!0;if(c&&f.canStart&&(!e.get("useCalculatedDueDate")||f["DE:Calculated Due Date"]))TASK_DB.insert(J(f),{syncID:f.ID,details:f},l&&b==d-1),xa[f.ID]=!0}}});else{c=g.length;A=l;if(c){for(var k=0;k<c;k++){var p=g[k].opTask;if(-1!=p.permissions.actions.indexOf("ADD_HOURS")&&
-1!=p.permissions.actions.indexOf("CHANGE_STATUS")&&(!e.get("useCalculatedDueDate")||p["DE:Calculated Due Date"])){var m=!1;if(void 0!=h&&Array.isArray(p.project.hourTypes)&&p.project.hourTypes.length)for(var v=0;v<p.project.hourTypes.length;v++){if(void 0!=h[p.project.hourTypes[v].ID]){m=!0;break}}else m=!0;m&&(TASK_DB.insert(J(p),{syncID:p.ID,details:p},l&&k==c-1),xa[p.ID]=!0)}}Ta(xa)}e.set("alltasks",!0);TASK_CNTRL.showAll();n.hide();b&&b(g)}}});g.fail(function(a,b,d){w({response:a.responseText,
type:b,msg:d,status:a.status},function(a,b,d){O(a,b,d)},"addAllAssignedTasks-fail"+b+"-"+d+" "+a.responseText)})}function ya(a){n.show();var b={url:t()+"user/search",type:"get",data:{fields:"role:*,roles:*",ID:e.get("userID")},dataType:"json"};x(b);b=jQuery.ajax(b);b.done(function(b){if(void 0!=b.error)b.error["class"]==y[0]?u(function(){ya(a)}):f(s[0],"addAllRoleTasks,"+JSON.stringify(b.error)),n.hide(),q.hide();else if(b=b.data[0],0==b.length)a&&a(),n.hide(),q.hide();else{var g=jQuery("#role-filter"),
c=function(){O("task",function(){jQuery("#active-filter").hide();g.css("display","inline-block");n.hide();q.hide()})},h=function(a,b){e.set("currentRole",{name:a,ID:b});g.find("button").html("<strong>Role: </strong><span>"+a+'</span><span class="caret"></span>');c()},k=e.get("currentRole");void 0!=k?h(k.name,k.ID):void 0!=b.role&&h(b.role.name,b.role.ID);if(void 0!=b.roles&&0!=b.roles.length)for(var k=g.find(".dropdown-menu").html("").first(),p=0,m=b.roles.length;p<m;p++)k.append('<li><a href="#" id="'+
b.roles[p].ID+'">'+b.roles[p].name+"</a></li>"),k.find("#"+b.roles[p].ID).click(function(){h(jQuery(this).text(),jQuery(this).attr("id"))});else qa(),n.hide(),q.hide(),Ka(),TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Roles</h3></div><div class="content"><div><p>No additional roles available.</strong></h3><div><a href="#" class="btn btn-primary cancel" title="Ok">Ok</a><div>')}});b.fail(function(a,b,f){w({response:a.responseText,type:b,msg:f,status:a.status},ya,"addAllRoleTasks")})}
function qa(){var a=jQuery("#role-filter");a.hide();a.find(".dropdown-menu").first().html("")}function za(a){n.show();var b={url:t()+"team/search",type:"get",data:{fields:"ID","users:ID":e.get("userID")},dataType:"json"};x(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?u(function(){za(a)}):f(s[0],"addAllGroupTasks,"+JSON.stringify(b.error)),n.hide(),q.hide()):(b=b.data,0==b.length?(a?a():jQuery("#form-list").hide(),n.hide(),q.hide(),TASK_CNTRL.showNoTaskWindow()):D(function(){for(var g=
b.length,f=function(b,d){if(0==--g){var f=M.length;A=!0;if(0==f)TASK_CNTRL.showAll(M);else{for(var e=0;e<f;e++)TASK_DB.insert(J(M[e]),{syncID:M[e].ID,details:M[e]},e==f-1);M=[];a&&a()}}},e=0;e<g;e++)ka("task",b[e].ID,f)}))});b.fail(function(a,b,f){w({response:a.responseText,type:b,msg:f,status:a.status},za,"addAllGroupTasks")})}function ka(a,b,d){a=void 0==a?"task":a;n.show();var g={url:t()+a+"/search?statusEquatesWith=NEW&statusEquatesWith=INP&statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE&project:statusEquatesWith=INF",
type:"get",data:{statusEquatesWith_Mod:"in","project:statusEquatesWith_Mod":"in",fields:"permissions,extRefID,status,parent,priority,project,project:hourTypes,project:status,plannedCompletionDate",$$LIMIT:1E3,"team:ID":b},dataType:"json"};"task"==a&&(g.data.canStart=!0,g.data.fields+=",percentComplete");e.get("useCalculatedDueDate")&&(g.data["DE:Calculated Due Date_Mod"]="notnull",g.data.fields+=",DE:Calculated Due Date");x(g);g=jQuery.ajax(g);g.done(function(g){if(void 0!=g.error)g.error["class"]==
y[0]?u(function(){ka(a,b,d)}):f(s[0],"addGroupTasks-"+a+","+JSON.stringify(g.error)),n.hide(),q.hide();else if(g=g.data,"opTask"==a&&0==g.length)d&&d(a,b);else if("opTask"!=a){ka("opTask",b,d);for(var e=g.length,c=0;c<e;c++)M.push(g[c])}else{e=g.length;for(c=0;c<e;c++)M.push(g[c]);d&&d(a,b)}});g.fail(function(a,b,d){w({response:a.responseText,type:b,msg:d,status:a.status},ka,"addGroupTasks-fail"+b+"-"+d+" "+a.responseText)})}function Aa(){n.show();var a={url:t()+"hour/report",type:"get",data:{entryDate:"$$TODAY-14d",
entryDate_Range:"$$TODAY",entryDate_Mod:"between","timesheet:userID":e.get("userID")},dataType:"json"};x(a);var b=jQuery.extend(!0,{},a);b.data.opTaskID_1_GroupBy=!0;a.data["task:canStart"]=!0;a.data.taskID_1_GroupBy=!0;jQuery.when(jQuery.ajax(a),jQuery.ajax(b)).done(function(a,b){a=a[0];b=b[0];var e=void 0!=a.error?a.error:b.error;if(void 0!=e)e["class"]==y[0]?u(function(){Aa()}):f(s[0],"addRecentTasks,"+JSON.stringify(e)),n.hide(),q.hide();else{var c=Object.keys(b.data).concat(Object.keys(a.data));
0==c.length?(A=!0,D(function(){TASK_CNTRL.showAll(c)})):D(function(){A=!0;TASK_CNTRL.showAll(TASK_CNTRL.taskDB.loadSyncIds(c))})}}).fail(function(a,b,f){w({response:a.responseText,type:b,msg:f,status:a.status},Aa,"addRecentTasks")})}function Ba(){function a(a,d){var g={url:t()+"assgn/search?"+a+":statusEquatesWith=NEW&"+a+":statusEquatesWith=INP&"+a+":statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE&status=AD",type:"get",data:{},dataType:"json"};g.data[a+":statusEquatesWith_Mod"]=
"in";g.data[a+":isComplete"]=!1;g.data.status_Mod="in";g.data["project:statusEquatesWith_Mod"]="in";d?g.data[a+":personal"]=!0:(g.data["project:projectedCompletionDate"]="$$TODAYb-2w",g.data["project:projectedCompletionDate_Mod"]="gt");g.data.assignedToID=e.get("userID");g.data.fields=a+":canStart,"+a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":status, "+a+":extRefID,"+a+":permissions,"+a+":plannedCompletionDate";"task"==a&&(g.data.fields+=",task:percentComplete");
e.get("useCalculatedDueDate")&&(g.data["DE:"+a+":Calculated Due Date_Mod"]="notnull",g.data.fields+=",DE:"+a+":Calculated Due Date");x(g);return g}n.show();jQuery.when(jQuery.ajax(a("task",!1)),jQuery.ajax(a("task",!0)),jQuery.ajax(a("opTask",!1))).done(function(a,d,g,c){a=a[0];d=d[0];g=g[0];c=void 0!=a.error?a.error:g.error;void 0!=c?(c["class"]==y[0]?u(function(){Ba()}):f(s[0],"addCurrentTasks,"+JSON.stringify(c)),n.hide(),q.hide()):0==d.data.length&&0==a.data.length&&0==g.data.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):
D(function(){function f(a,b,d){for(var g=a.length,e,c=0;c<g;c++)e=a[c],e=e[b],TASK_DB.insert(J(e),{syncID:e.ID,details:e},d&&c==g-1)}A=!0;e.get("personalTasks")&&f(d.data,"task",!(a.data.length+g.data.length));f(a.data,"task",!g.data.length);f(g.data,"opTask",!0)})}).fail(function(a,d,g){w({response:a.responseText,type:d,msg:g,status:a.status},function(){Ba()},"addCurrentTasks")})}function Ca(){function a(a){var d={url:t()+"assgn/search?"+a+":statusEquatesWith=NEW&"+a+":statusEquatesWith=INP&"+a+
":statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE",type:"get",data:{},dataType:"json"};d.data[a+":statusEquatesWith_Mod"]="in";d.data[a+":isComplete"]=!1;d.data.status="AA";d.data["project:statusEquatesWith_Mod"]="in";d.data["project:projectedCompletionDate"]="$$TODAYb-2w";d.data["project:projectedCompletionDate_Mod"]="gt";d.data.assignedToID=e.get("userID");d.data.fields=a+":canStart,"+a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+
a+":status, "+a+":extRefID,"+a+":permissions,"+a+":plannedCompletionDate";"task"==a&&(d.data[a+":canStart"]=!0,d.data.fields+=",task:percentComplete");e.get("useCalculatedDueDate")&&(d.data["DE:"+a+":Calculated Due Date_Mod"]="notnull",d.data.fields+=",DE:"+a+":Calculated Due Date");x(d);return d}n.show();jQuery.when(jQuery.ajax(a("task")),jQuery.ajax(a("opTask"))).done(function(a,d){a=a[0];d=d[0];var g=void 0!=a.error?a.error:d.error;void 0!=g?(g["class"]==y[0]?u(function(){Ca()}):f(s[0],"addRequestedTasks,"+
JSON.stringify(g)),n.hide(),q.hide()):0==a.data.length&&0==d.data.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){function g(a,b){for(var d=a.length,f,c=0;c<d;c++)f=a[c][b],f.canStart&&(!e.get("useCalculatedDueDate")||f["DE:Calculated Due Date"])&&TASK_DB.insert(J(f),{syncID:f.ID,details:f},c==d-1)}A=!0;g(a.data,"task");g(d.data,"opTask")})}).fail(function(a,d,g){w({response:a.responseText,type:d,msg:g,status:a.status},function(){Ca()},"addRequestedTasks")})}function Da(){function a(a){var d=
{url:t()+"assgn/search?"+a+":statusEquatesWith=ONH&"+a+":statusEquatesWith=AWF&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE&project:statusEquatesWith=ONH&project:statusEquatesWith=PLN",type:"get",data:{},dataType:"json"};d.data[a+":statusEquatesWith_Mod"]="in";d.data[a+":isComplete"]=!1;d.data.status="AD";d.data["project:statusEquatesWith_Mod"]="in";d.data["project:projectedCompletionDate"]="$$TODAYb-2w";d.data["project:projectedCompletionDate_Mod"]="gt";d.data.assignedToID=e.get("userID");
d.data.fields=a+":canStart,"+a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":status, "+a+":extRefID,"+a+":permissions,"+a+":plannedCompletionDate";"task"==a&&(d.data.fields+=",task:percentComplete");e.get("useCalculatedDueDate")&&(d.data["DE:"+a+":Calculated Due Date_Mod"]="notnull",d.data.fields+=",DE:"+a+":Calculated Due Date");x(d);return d}n.show();jQuery.when(jQuery.ajax(a("task")),jQuery.ajax(a("opTask"))).done(function(a,d){a=a[0];d=d[0];var g=void 0!=
a.error?a.error:d.error;void 0!=g?(g["class"]==y[0]?u(function(){Da()}):f(s[0],"addOnHoldTasks,"+JSON.stringify(g)),n.hide(),q.hide()):0==a.data.length&&0==d.data.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){function g(a,b){for(var d=a.length,f,e=0;e<d;e++)f=a[e],f=f[b],TASK_DB.insert(J(f),{syncID:f.ID,details:f},e==d-1)}A=!0;g(a.data,"task");g(d.data,"opTask")})}).fail(function(a,d,g){w({response:a.responseText,type:d,msg:g,status:a.status},function(){Da()},"addOnHoldTasks")})}
function Pa(){var a={url:t()+"user/search",data:{"hourTypes:isActive":!0,fields:"hourTypes:ID,hourTypes:name,hourTypes:description,hourTypes:countAsRevenue",ID:e.get("userID")},type:"get",dataType:"json"};x(a);var b={url:t()+"hourType/search?nameKey=default.hourtype.optask&nameKey=default.hourtype.task&nameKey_Mod=in",data:{isActive:!0,fields:"nameKey"},type:"get",dataType:"json"};x(b);jQuery.when(jQuery.ajax(a),jQuery.ajax(b)).done(function(a,b){a=a[0];b=b[0];e.set("hour_type_list",[]);if(void 0!=
a.error)a.error["class"]==y[0]?u(function(){}):f(s[0],"getHourTypes,"+JSON.stringify(a.error)),n.hide(),q.hide();else{a=a.data;if(void 0!=a&&0!=a.length&&0!=a[0].hourTypes.length){for(var c=[],h=[],k=0;k<a[0].hourTypes.length;k++)void 0==c[a[0].hourTypes[k].ID]&&(c[a[0].hourTypes[k].ID]=!0,h[k]=a[0].hourTypes[k]);e.set("hour_type_list",h)}b=b.data;if(void 0!=b&&0!=b.length){c={};for(k=0;k<b.length;k++){var p;"default.hourtype.task"==b[k].nameKey?p="TASK":"default.hourtype.optask"==b[k].nameKey&&(p=
"OPTASK");p&&(c[p]=b[k])}e.set("default_hour_type_list",c)}}}).fail(function(a,b,e){401==a.status?u(function(){}):"timeout"==b?Pa():f(s[0],"getHourTypes,"+a.responseText)})}function cb(a,b){if("GEN"==a.details.objCode)b(a);else{var d=e.get("hour_type_list");d||(d=[]);var g=e.get("default_hour_type_list");if(d&&1==d.length)a.details.hourTypeID=d[0].ID,TASK_DB.updateDetails(a.ID,a.details),b(a);else if(Array.isArray(a.details.project.hourTypes)&&1==a.details.project.hourTypes.length)a.details.hourTypeID=
a.details.project.hourTypes[0].ID,TASK_DB.updateDetails(a.ID,a.details),b(a);else{var f=jQuery("#hourTypeSelector");f.text("");g[a.details.objCode]&&f.append($("<option />").val(g[a.details.objCode].ID).text(g[a.details.objCode].name));d&&d.length&&jQuery.each(d,function(){var a=this.ID;f.append($("<option />").val(a).text(this.name))});Array.isArray(a.details.project.hourTypes)&&a.details.project.hourTypes.length&&jQuery.each(a.details.project.hourTypes,function(){f.append($("<option />").val(this.ID).text(this.name))});
TASK_CNTRL.showWindow(null,"#hourTypeWindow");jQuery("#done_hourType").unbind("click").bind("click",function(d){d.preventDefault();a.details.hourTypeID=jQuery("#hourTypeSelector").find(":selected").val();TASK_DB.updateDetails(a.ID,a.details);b(a);TASK_CNTRL.hideWindow("#hourTypeWindow")});jQuery("#cancel_hourType").unbind("click").bind("click",function(a){a.preventDefault();TASK_CNTRL.hideWindow("#hourTypeWindow")})}}}function ma(a){var b=e.get("todaySched");null!=b?a(b):(b={url:t()+"user/search?ID=$$USER.ID&fields=schedule:*,schedule:nonWorkDays:*",
type:"get",data:{},dataType:"json"},x(b),b=jQuery.ajax(b),b.done(function(b){if(void 0!=b.error)b.error["class"]==y[0]?u(function(){}):f(s[0],"getSchedule,"+JSON.stringify(b.error)),n.hide(),q.hide();else if(b=b.data[0].schedule,0!=b.length){var g=new Date,c=b["sunday monday tuesday wednesday thursday friday saturday".split(" ")[g.getDay()]],h;if(!0==b.hasNonWorkDays){for(var k=0;k<b.nonWorkDays.length;k++)if(b.nonWorkDays[k].nonWorkDate==g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate()&&(void 0!=
h&&null!=b.nonWorkDays[k].userID||void 0==h))h=b.nonWorkDays[k].scheduleDay;void 0!=h&&(c=h)}void 0!=c&&0!=c.length&&(c={start:c[0],stop:c[1]},e.set("todaySched",c));a&&a(c)}}),b.fail(function(b,g,e){401==b.status?u(function(){}):"timeout"==g?ma(a):f(s[0],"getSchedule,"+b.responseText)}))}function ta(){var a=new Date,a={url:t()+"hour/report?hours_AggFunc=sum",type:"get",data:{entryDate:a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),ownerID:e.get("userID")},dataType:"json"};x(a);a=jQuery.ajax(a);
a.done(function(a){void 0!=a.error?(a.error["class"]==y[0]?u(function(){}):f(s[0],"getTodaysTotalHours,"+JSON.stringify(a.error)),n.hide(),q.hide()):(a=a.data,jQuery("#totalHours").html("Today's Hours: "+(null==a.sum_hours?"0":a.sum_hours.toFixed(2))))});a.fail(function(a,d,g){401==a.status?u(function(){}):"timeout"==d?ta():f(s[0],"getTodaysTotalHours,"+a.responseText)})}function ga(a,b){n.show();var d={assignedToID:e.get("userID")};"OPTASK"==a.details.objCode?d.opTaskID=a.syncID:d.taskID=a.syncID;
d={url:t()+"assignment/search",type:"get",data:d,dataType:"json"};x(d);d=jQuery.ajax(d);d.done(function(d){void 0!=d.error?(d.error["class"]==y[0]?u(function(){ga(a,b)}):f(s[0],"getTaskAssignment,"+a.syncID+","+JSON.stringify(d.error)),n.hide(),q.hide()):(d=d.data[0],b&&b(d,a))});d.fail(function(d,f,e){w({response:d.responseText,type:f,msg:e,status:d.status},function(){ga(a,b)},"getTaskAssignment,"+a.syncID)})}function V(a,b){n.show();var d={url:t()+"assignment/"+a.ID,data:{method:"PUT",status:"DN"},
type:"get",dataType:"json"};x(d);d=jQuery.ajax(d);d.done(function(d){void 0!=d.error?(d.error["class"]==y[0]?u(function(){V(a,b)}):f(s[0],"setAssignmentDone,"+a.ID+","+JSON.stringify(d.error)),n.hide(),q.hide()):(TASK_DB.remove(b.ID),n.hide(),q.hide(),f(s[2],I(b)+",assignment done"),f(s[1],"assignment done"),Ea(b))});d.fail(function(d,f,e){w({response:d.responseText,type:f,msg:e,status:d.status},function(){V(a,b)},"setAssignmentDone,"+a.ID+", "+d.responseText)})}function Ea(a){n.show();var b={url:t()+
"assignment/count",data:{status:"DN",status_Mod:"ne"},type:"GET",dataType:"json"};"OPTASK"==a.details.objCode?b.data.opTaskID=a.syncID:b.data.taskID=a.syncID;x(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?u(function(){Ea(a)}):f(s[0],"getTaskDoneAssignmentCount,"+taskID+","+JSON.stringify(b.error)),n.hide(),q.hide()):(b=b.data,n.hide(),q.hide(),0==b.count?Z(a):1==b.count&&Fa(a))});b.fail(function(b,g,f){w({response:b.responseText,type:g,msg:f,status:b.status},function(){Ea(a)},
"getTaskDoneAssignmentCount,"+a.syncID)})}function Fa(a){n.show();var b={url:t()+a.details.objCode.toLowerCase()+"/"+a.syncID,type:"get",data:{"teamAssignment:assignedToID":e.get("userID")},dataType:"json"};x(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?u(function(){Fa(a)}):f(s[0],"checkTeamDone,"+taskID+","+JSON.stringify(b.error)),n.hide(),q.hide()):(n.hide(),q.hide(),b.data&&Z(a))});b.fail(function(b,g,f){w({response:b.responseText,type:g,msg:f,status:b.status},
function(){Fa(a)},"checkTeamDone,"+a.syncID)})}function Z(a){var b=a.syncID;n.show();var d="OPTASK"==a.details.objCode?"CLS":"CPL",d={url:t()+a.details.objCode.toLowerCase()+"/"+b,data:{method:"PUT",status:d},type:"get",dataType:"json"};x(d);d=jQuery.ajax(d);d.done(function(d){void 0!=d.error?(d.error["class"]==y[0]?u(function(){Z(a)}):w({response:d.error,type:null,msg:null,status:null},function(){Z(a)},"setTaskDone,"+b),n.hide(),q.hide()):(n.hide(),q.hide(),f(s[2],I(a)+",task done"),f(s[1],"task done"))});
d.fail(function(d,f,e){w({response:d.responseText,type:f,msg:e,status:d.status},function(){Z(a)},"setTaskDone,"+b+", "+d.responseText)})}function W(a){n.show();var b={url:t()+a.details.objCode.toLowerCase()+"/"+a.syncID,data:{status:"INP",method:"PUT"},type:"get",dataType:"json"};x(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?u(function(){W(a)}):w({response:b.error,type:null,msg:null},function(){W(a)},"setTaskInProgress,"+a.syncID),n.hide(),q.hide()):(n.hide(),q.hide(),
!0==e.get("logout_on_select")&&F())});b.fail(function(b,f,e){w({response:b.responseText,type:f,msg:e,status:b.status},function(){W(a)},"setTaskInProgress-fail,"+a.syncID+", "+b.responseText)})}function ia(a,b,d){n.show();d={url:t()+"note/",data:{auditType:"NO",ownerID:e.get("userID"),objID:a.syncID,noteObjCode:a.details.objCode,noteText:b.substring(0,2E3),auditText:"Stopwatch",isPrivate:d,method:"POST"},type:"get",dataType:"json"};x(d,1E4,!0);d=jQuery.ajax(d);d.done(function(d){void 0!=d.error&&(d.error["class"]==
y[0]?u(function(){ia(a,b)}):w({response:d.error,type:null,msg:null,status:null},function(){ia(a,b)},"setComment,"+a.syncID));n.hide();q.hide()});d.fail(function(d,f,e){w({response:d.responseText,type:f,msg:e,status:d.status},function(){ia(a,b)},"setComment-fail,"+a.syncID+", "+d.responseText)})}function ha(a,b){n.show();var d={url:t()+a.details.objCode.toLowerCase()+"/"+a.syncID,data:{updates:"{ percentComplete: "+b+"}",method:"PUT"},type:"get",dataType:"json"};x(d);d=jQuery.ajax(d);d.done(function(d){void 0!=
d.error?d.error["class"]==y[0]?u(function(){ha(a,b)}):w({response:d.error,type:null,msg:null,status:null},function(){ha(a,b)},"setTaskPercent,"+a.syncID):(a.details.percentComplete=b,TASK_DB.updateDetails(a.ID,a.details));n.hide();q.hide()});d.fail(function(d,f,e){w({response:d.responseText,type:f,msg:e,status:d.status},function(){ha(a,b)},"setTaskPercent-fail,"+a.syncID+", "+d.responseText)})}function Za(a,b,d){var g,c={ownerID:e.get("userID")};void 0==b||-1!=b.permissions.actions.indexOf("ADD_HOURS")&&
-1!=b.permissions.actions.indexOf("CHANGE_STATUS")?(g=0,c.method="POST"):(g=b.hours,c.method="PUT",c.ID=b.ID);if("GEN"==a.details.objCode)c.hourTypeID=a.syncID;else{switch(a.details.objCode){case "OPTASK":c.opTaskID=a.syncID;break;case "TASK":c.taskID=a.syncID;break;case "PROJ":c.projectID=a.syncID;break;default:c.hourTypeID=a.syncID}c.hourTypeID||(c.hourTypeID=e.get("forceHourTypeID"),void 0==c.hourTypeID&&(void 0!=a.details.hourTypeID&&""!=a.details.hourTypeID)&&(c.hourTypeID=a.details.hourTypeID))}isNaN(g)&&
(g=0);c.entryDate=a.dateStr;var h=Number((a.duration/3600).toFixed(2));e.get("nearestHour")&&(h=Math.round(h));c.hours=parseFloat((h+parseFloat((""+g).split(".").join("."))+" ").split(".").join(".")).toFixed(2);c.ownerID=e.get("userID");var k=new Date;d||(c.extRefID=("OK~"+k.getHours()+":"+k.getMinutes()+"H"+c.hours+"D"+h+"T"+TASK_CNTRL.hms(a.time)+";"+(b&&b.extRefID?b.extRefID.replace("OK~","OK!"):".")).substring(0,254));f(s[1],"setHourAttask, oldhr: "+g+" method: "+c.method+" start: "+a.dateStr+
" task: "+JSON.stringify(a)+" sid: "+e.get("sessionID")+" time: "+k.toTimeString());var p=function(){n.show();var b={url:t()+"hour/",type:"get",data:c,dataType:"json",async:!1};x(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?u(function(){p()}):w({response:b.error,type:null,msg:null,status:null},p,"setHourAttask,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(c)+" "+I(a)+","+a.duration,'Time was not tracked, please click on "View" for task: '+a.name+" to record time manually."),
n.hide(),q.hide()):(TASK_DB.setTask(a),TASK_CNTRL.toggleRunText(),ta(),void 0!=c.taskID||void 0!=c.opTaskID?ga(a,a.done?function(a,b){V(a,b)}:function(b,d){"DN"==b.status?d.running?(d.done=1,TASK_CNTRL.stopTask(d)):V(b,d):W(a)}):!0==e.get("logout_on_select")&&F(),n.hide(),q.hide(),f(s[2],I(a)),f(s[1],"time tracked newHr: "+c.hours+" "+a.duration+" oldHr: "+g))});b.fail(function(b,d,f){w({response:b.responseText,type:d,msg:f,status:b.status},p,"setHourAttask-fail,"+a.syncID+" "+a.name+" url: "+t()+
" "+JSON.stringify(c)+" "+I(a)+","+a.duration+", "+b.responseText+", "+f,'<br>Time was not tracked, please click on "View" for task: '+a.name+" to record time manually.");TASK_DB.setTask(a);TASK_CNTRL.toggleRunText();n.hide();q.hide()})};p()}function Wa(a,b){ja(a,function(a,f,e){b(a,f)},!1)}function Xa(a,b,d){var f={method:"PUT",ID:b,description:d.substring(0,2E3)};switch(a.details.objCode){case "OPTASK":f.opTaskID=a.syncID;break;case "TASK":f.taskID=a.syncID;break;case "PROJ":f.projectID=a.syncID;
break;default:f.hourTypeID=a.syncID}var e=function(){n.show();var b={url:t()+"hour/",type:"get",data:f,dataType:"json",async:!1};x(b);b=jQuery.ajax(b);b.done(function(b){n.hide();q.hide();void 0!=b.error&&(b.error["class"]==y[0]?u(function(){e()}):w({response:b.error,type:null,msg:null,status:null},e,"setHourNoteAttask,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(f)+" "+I(a)+","+a.duration,"Timesheet hour note was not recorded."))});b.fail(function(b,d,c){w({response:b.responseText,type:d,
msg:c,status:b.status},e,"setHourNoteAttask-fail,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(f)+" "+I(a)+","+a.duration+", "+b.responseText+", "+c,b.responseText+"<br>Timesheet hour note was not recorded.")})};e()}function ja(a,b,d){var c=new Date,h={};h.entryDate=void 0!=a.dateStr?a.dateStr:c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();h.fields="permissions,ID,hours,extRefID,description";h.ownerID=e.get("userID");if("GEN"==a.details.objCode)h.hourTypeID=a.syncID;else{switch(a.details.objCode){case "OPTASK":h.opTaskID=
a.syncID;break;case "TASK":h.taskID=a.syncID;break;case "PROJ":h.projectID=a.syncID}void 0!=a.details.hourTypeID&&""!=a.details.hourTypeID&&(h.hourTypeID=a.details.hourTypeID)}c={url:t()+"hour/search",type:"get",data:h,dataType:"json",async:!1};x(c);c=jQuery.ajax(c);c.done(function(c){if(void 0!=c.error)c.error["class"]==y[0]?u(function(){ja(a,b,d)}):f(s[0],"getHour,"+a.syncID+","+JSON.stringify(c.error)),n.hide(),q.hide();else if(f(s[1],"getHour "+c.data.length+" "+JSON.stringify(c.data)),b){for(var e=
c.data.length,g=0;g<e;g++)if(-1!=c.data[g].permissions.actions.indexOf("ADD_HOURS")&&-1!=c.data[g].permissions.actions.indexOf("CHANGE_STATUS")){b(a,c.data[g],d);return}b(a,c.data[0],d)}});c.fail(function(b,d,c){f(s[0],"getHour,"+a.syncID+","+JSON.stringify(c))})}var y=["com.attask.common.AuthenticationException"],s=["error","debug","informational"],e,P=!(window.hasOwnProperty("chrome")&&window.chrome.hasOwnProperty("windows")),H=isMobile(),la="www.atappstore.com",Ga="secure.atappstore.com",Na=-1!==
document.URL.indexOf("dashboard.directory")||-1!==document.URL.indexOf(la)||-1!==document.URL.indexOf(Ga),S=!1,$a="Force Desktop Stopwatch Access",Ha=300,M=[],B=[],xa=[],Ia,Ja,R={current:{f:Ba,t:"Current",d:"Tasks and issues you're working on"},recent:{f:Aa,t:"Recent",d:"All tasks and issues tracked within 14 days"},requested:{f:Ca,t:"Requested",d:"Tasks and issues you can start on"},onhold:{f:Da,t:"On Hold",d:"Tasks and issues that are on hold"},all:{f:O,t:"All Assigned",d:"All tasks and issues assigned to you"},
team:{f:za,t:"Team Assigned",d:"All tasks and issues assigned to your Teams"},role:{f:ya,t:"Role Assigned",d:"All tasks and issues available to your Roles"},projects:{f:wa,t:"Current Projects",d:"All current projects assigned to and own"}},ab=getQueryString("allfilters");P&&(!Na&&-1==location.origin.indexOf("localhost"))&&(location="https://"+la+"/client/enterprise-stopwatch/launch.html");var X=getQueryString("taskname"),L=getQueryString("taskid"),db=getQueryString("autostart"),A=!1;z();e=new Store("Attask");
if(L||X)A=!0;e.set("view","all");e.set("launched",(new Date).getTime());window.addEventListener("offline",function(a){jQuery("#refresh").hide();jQuery(".done").hide();jQuery(".percent").hide();jQuery(".btn-comment").hide();jQuery(".view").hide();S=!0});window.addEventListener("online",function(a){jQuery("#refresh").show();jQuery(".done").show();jQuery(".percent").show();jQuery(".btn-comment").show();jQuery(".view").show();a=e.get("offlineTasks");void 0!=a&&a.length&&Sa(a,function(a){for(var d=a.length,
f=0;f<d;f++)T(a[f],a[f].duration)});e.set("offlineTasks",[]);S=!1});var U;OB.init.add(function(){void 0==e.get("qr")&&e.set("qr","true"==getQueryString("qr")||getQueryString("code"));Va();jQuery(document).on("click",".logout",function(){F()});v();var a=getQueryString("s"),b=getQueryString("sid"),d=getQueryString("d");if(d&&(a&&e.set("apiKey",a),b&&e.set("sessionID",b),a=d.split("."),e.set("host",a[0]),a.shift(),e.set("domain",a.join(".")),a=getQueryString("u"),b=e.get("userID"),void 0==b||""==b||
a&&b&&a!=b)){e.set("apiKey","");e.set("username","");e.set("password","");e.set("userID",a);e.set("ent",void 0!=e.get("userID"));na();return}G();!0==e.get("qr")&&void 0==e.get("sessionID")&&(getQueryString("code")?(document.getElementById("button-appscan").style.display="block",qrRead(getQueryString("code"),e)):qrLoad(e))});OB.onBeforeUnLoad.add(function(a){var b=TASK_CNTRL.getDuration(a);T(a,b.duration,!1)});OB.onUnLoad.add(function(){TASK_DB.running(function(a){e.get("stopOnClose")&&TASK_CNTRL.stopTask(a)})});
OB.onLoad.add(function(){document.addEventListener("resume",function(){jQuery("#loading").show();G()||v()},!1);document.addEventListener("pause",function(){jQuery("#form-list").html("")},!1);document.addEventListener("menubutton",function(){TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Welcome</h3></div><div class="content"><p>If you have any questions please visit <a href="https://store.atappstore.com/product/stopwatch/" target="_blank" class="btn" >store.atappstore.com</a></p><a href="#" class="btn btn-primary cancel" title="Done">Done</a></div>')},
!1)});OB.displayInterval.add(function(a,b){p(a,b)&&(window.clearInterval(TASK_CNTRL.display_intervals[a.ID]),P&&window.clearInterval(TASK_CNTRL.update_intervals[a.ID]),TASK_CNTRL.toggleRunText())});OB.updateAtInterval.add(function(a,b){e.get("updateAtInterval")&&(0==b?n.hide():(n.show(),T(a,b,!0),a.start=new Date,TASK_DB.setTask(a)))});OB.stop.add(function(a,b){n.show();var d,c;d=new Date(a.start);c=new Date;f(s[1],"stop: "+d+" == "+c+" dur:"+b+" totalDuration:"+a.time);if(e.get("minuteBufferSnapToSched")){var h=
e.get("todaySched"),k=e.get("minuteBuffer"),p=c.toLocaleDateString("en-US"),m=Date.parse(p+h.start),h=Date.parse(p+h.stop),p=new Date(m);d<m&&d>p.setMinutes(p.getMinutes()-k)&&(d=new Date(m));p=new Date(h);c>h&&c<p.setMinutes(p.getMinutes()+k)&&(c=new Date(h));if(d>=c){n.hide();return}b=Math.floor((c.getTime()-d.getTime())/1E3);f(s[1],"minuteBufferSnapToSched: "+d+" == "+c+" dur:"+b)}if(0==b||0==Number((b/3600).toFixed(2)))n.hide(),TASK_DB.setTask(a);else{if("GEN"==a.details.objCode)jQuery("#item"+
a.ID).find(".hour-note").show();else{d=jQuery("#item"+a.ID);var v=d.find(".date").hide(),q=d.find(".hour-note").show();setTimeout(function(){v.show();q.hide()},3E3)}T(a,b,!1)}});OB.update.add(function(a,b){q.show();T(a,b,!1)});OB.start.add(function(a){sa(a)});OB.preStart.add(function(a){a.running?TASK_CNTRL.toggleTimer(a):navigator.onLine&&!a.disable&&(p(a,a.time)||function(){TASK_DB.loadAll(function(b){var d,f,c=!1,h=b.length;for(d=0;d<h;d++)if(f=b[d],null!=f&&f.running&&a.ID!=f.ID){TASK_CNTRL.toggleTimer(f);
c=!0;break}(b=e.get("hour_type_list"))&&b.length||a.details.project&&Array.isArray(a.details.project.hourTypes)&&a.details.project.hourTypes.length?cb(a,function(a){TASK_CNTRL.toggleTimer(a)}):(TASK_CNTRL.toggleTimer(a),!c&&!0==e.get("logout_on_select")&&F())})}())});OB.postAllItemRender.add(function(){jQuery(".remove").css("display","none");jQuery(".update").css("display","none");jQuery(".reset").css("display","none");C();e.get("is_auth")||(jQuery("#sort-date").remove(),jQuery(".timer").remove(),
jQuery(".done").remove(),jQuery(".percent").remove(),jQuery(".btn-comment").remove(),jQuery(".hour-note").remove(),jQuery(".date").removeClass("date").addClass("date-tall").html('<a href="https://store.atappstore.com/product/stopwatch/" target="_blank">Expired</a>'));e.get("hideTaskButtons")&&(jQuery(".timer").addClass("timer-tall"),jQuery(".done").remove(),jQuery(".percent").remove(),jQuery(".task").remove(),jQuery(".view").remove(),jQuery(".date").remove(),jQuery(".btn-comment").remove(),jQuery(".hour-note").remove(),
jQuery("#sort-date").remove());e.get("ent")?(jQuery("#totalHours").attr("title","").attr("data-hasqtip",!1).unbind("click").addClass("disabled"),e.get("projectFilter")||jQuery("#filter-projects").remove()):(jQuery(".btn-comment").remove(),jQuery("#sort-order").remove(),jQuery(".hour-note").remove(),jQuery("#filter-projects").remove(),jQuery("#filter-onhold").remove());if(A){var a=jQuery("#form-list"),b=e.get("vpos");void 0!=b&&a.scrollTop(b);"team"==e.get("view")&&!0==e.get("hide_team_done")&&jQuery(".done").remove();
S?e.get("allowOffline")&&(jQuery(".done").remove(),jQuery(".percent").remove(),jQuery(".view").remove(),jQuery("#bar").hide()):jQuery("#bar").show();b=e.get("current_sort");void 0!=b?("string"===typeof b&&(b=JSON.parse(b)),B[b.sort]=b.order,b=b.sort):(b=e.get("sort"),void 0==b&&(b="date"));jQuery("#sort-"+b).click();jQuery("#loading").hide();a.show();jQuery("#search-bar").is(":visible")&&jQuery("#search").click();a=jQuery("#holder")[0];a.style.display="none";a.style.display="block";n.hide();A=!1;
a=e.get("searchScore");jQuery("#searchfor").domsearch("#form-list",{unit:"div.item:visible",criteria:["span.search"],minimumScore:a});var d,a=X?X:"";if(L||a){var f=function(a){a&&(X=L="",jQuery("#search-bar").show(),jQuery("#sort-bar").toggle(),jQuery("#searchfor").val(a),jQuery("#searchfor").keydown(),setTimeout(function(){var a=jQuery("div.item:visible");a.length&&(n.hide(),q.hide(),d||(d=TASK_CNTRL.taskDB.get(a.attr("rel"))),d.running||jQuery("#item"+d.ID+" .timer").click())},1E3))},a=function(){n.hide();
q.hide();if(L)if(d=TASK_CNTRL.taskDB.getSyncId(L))f(d.name);else{console.log("search task not found, loading all and trying again");var a=L;L="";O("task",function(){(d=TASK_CNTRL.taskDB.getSyncId(a))?f(d.name):(n.hide(),q.hide(),TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Not Found</h3></div><div class="content"><div><p>Please select a task you\'re assigned to and not yet completed.</p></div></div><div id="close" class="btn btn-primary"><h3 style="line-height:0px">close</h3></div>'),
jQuery("#close").unbind("click").click(function(a){a.preventDefault();TASK_CNTRL.hideWindow()}))})}};(b=getQueryString("sid"))&&e.set("sessionID",b);e.get("sessionID")||console.log("Session not found");"all"!=e.get("view")?(B=[],qa(),e.set("view","all"),O("task",a())):a()}}});OB.postItemRender.add(function(a){var b=jQuery("#item"+a.ID),d=b.find(".details");if(0==b.find("#buttons .view").length){var f=b.find("#buttons"),c=[{label:"Low",css:"default"},{label:"Low",css:"default"},{label:"Normal",css:"success"},
{label:"High",css:"warning"},{label:"Urgent",css:"danger"}];if("GEN"!=a.details.objCode&&void 0!=a.details.priority&&0!=a.details.priority){var h=c[a.details.priority];h||(console.log("priority "+a.details.priority),h=c[c.length-1]);f.append('<span class="task priority '+h.css+'" title="'+h.label+'" data-priority="'+a.details.priority+'">'+h.label[0]+"</span> ")}var k;"GEN"==a.details.objCode?(k="General",b.attr("data-type",k),b.attr("data-force-order",0),f.attr("class","days priority"),b.attr("class",
"item general")):"OPTASK"==a.details.objCode?(k="Issue",b.attr("data-type",k),b.attr("data-force-order",1),f.append('<span class="issue" title="Issue">I</span> ')):"TASK"==a.details.objCode?(k="Task",b.attr("data-type",k),b.attr("data-force-order",1),f.append('<span class="task" title="Task">T</span> ')):"PROJ"==a.details.objCode&&(k="Project",b.attr("data-type",k),b.attr("data-force-order",1),f.append('<span class="project" title="Project">P</span> '));void 0!=a.details.status&&(d.attr("data-status",
a.details.status),f.append('<span class="status" title="'+k+" status: "+a.details.status+("Project"!==k?"<br>Project status: "+a.details.project.status:"")+'">'+a.details.status+"</span> "));"General"!=k&&(db||f.append('<a href="https://'+e.get("host")+"."+e.get("domain")+"/"+k.toLowerCase()+"/view?ID="+a.syncID+'" target="_blank" class="btn btn-mini view" rel="'+a.ID+'" title="View '+k+'"><i class="fas fa-tasks"></i></a> '),a.disable?void 0!=a.details.status&&(b.find(".timer").text("status: "+a.details.status).unbind("click").addClass("disabled"),
b.find(".timer-info").text("status: "+a.details.status)):"Project"!=k&&f.append('<a href="#" class="btn btn-mini done" rel="'+a.ID+'" title="Done '+k+'"><i class="fas fa-check"></i></a> '));"General"!=k&&f.append('<a href="#" class="btn btn-mini btn-comment" rel="'+a.ID+'" title="Add Comment"><i class="fas fa-comment-dots"></i></a> ');!a.disable&&void 0!=a.details.percentComplete&&("Task"==k?f.append('<a href="#" class="btn btn-mini percent" rel="'+a.ID+'" title="Percent Completed">'+a.details.percentComplete+
"%</a> "):"Project"==k&&f.append('<span class="btn-mini" rel="'+a.ID+'" title="Percent Completed">'+a.details.percentComplete+"%</span> "));c=a.details.plannedCompletionDate;e.get("useCalculatedDueDate")&&a.details["DE:Calculated Due Date"]&&(c=a.details["DE:Calculated Due Date"]);f='<span class="date" style="background-color: #EEE;"></span>';if(!a.disable&&"General"!=k&&void 0!=c)if(c=c.replace(/:\d\d\d/,"").replace(/-/g,"/").replace(/[a-z]+/gi," ").replace(/\/(\d\d\d\d)/,"-$1"),c=new Date(Date.parse(c)),
isNaN(c.getTime()))d.attr("data-days",9999);else{h=new Date;h.setHours(0);h.setMinutes(0);h.setSeconds(0);f="#D2E0FF";h=Math.round((c.getTime()-h.getTime())/1E3/60/60/24);0>h?f="#FFCDCD":1>=h&&(f="#FFD7AB");var p;p=0<h?"days due: "+h:"days late: "+Math.abs(h);f='<div class="date" style="background-color: '+f+';"><div class="days">'+p+"</div><div>"+pa(c.getMonth())+" "+c.getDate()+", "+c.getFullYear()+"</div></div>";d.attr("data-days",h)}else d.attr("data-days",9999);c="";null!=a.details.parent&&(c=
"<br><br>Parent Task: <br>"+a.details.parent.name);h="";a.details.extRefID&&(h="Reference: <br>"+a.details.extRefID);b.find(".name").attr("title",k+": <br>"+a.name+h+c);"General"!=k?(k="Project"==k?"":a.details.project.name,d.html(k).attr("title","Project: <br>"+k+"<br>Status: "+a.details.project.status).attr("search",k+" "+a.name).attr("data-priority",a.details.priority),d.append('<span class="search" style="display:none">'+k+" "+a.name+"</span>"),d="",a.disable||(d='<span class="hour-note" rel="'+
a.ID+'">Add Note</span>'),b.find(".c6").after('<div class="task-lower-block">'+f+d+"</div>")):(d.html(a.details.description).attr("title",a.details.description),d=a.time?"block":"hidden",b.find(".c6").after('<div class="general-lower-block"><span class="hour-note" style="display:'+d+';" rel="'+a.ID+'">Add Note</span></div>'));H||b.find(".task-lower-block").mouseover(function(){var a=jQuery(this).find(".hour-note"),b=a.attr("rel");if((b=TASK_DB.get(b))&&b.time&&!b.running&&!b.disable){var d=jQuery(this).find(".date").hide(),
f=a.show();setTimeout(function(){d.show();f.hide()},3E3)}}).mouseout(function(){jQuery(this).find(".date").show();jQuery(this).find(".hour-note").hide()})}});OB.remove.add(function(a){jQuery("#item"+a).remove()});OB.reset.add(function(a,b){OB.update.dispatch(b,-b.time);jQuery("#item"+a+" .timer").text(TASK_CNTRL.hms(0))});var q,n}();var QUERY_LOOKUP=null;function getQueryString(c){if(null==QUERY_LOOKUP){var k=location.search.substring(1),h=/([^&=]+)=([^&]*)/g,m;for(QUERY_LOOKUP={};m=h.exec(k);)QUERY_LOOKUP[decodeURIComponent(m[1])]=decodeURIComponent(m[2])}return c in QUERY_LOOKUP?QUERY_LOOKUP[c]:null}
function isMobile(){var c=!1,k=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(k)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(k.substr(0,
4)))c=!0;return c}
function taskController(c){var k,h=window.hasOwnProperty("chrome")&&window.chrome.hasOwnProperty("windows"),m=!h&&isMobile();OB.start.add(function(f){startNotify(f)});OB.stop.add(function(f,c,h){stopNotify(f)});OB.onLoad.add(function(){});OB.postAllItemRender.add(function(){m&&(jQuery("#form-list").height(0),k=124);if(!h||"full"==getQueryString("view")){var f=function(){var f=jQuery("#form-list"),c;c=f.height();c+=window.innerHeight-k;0!=window.innerHeight-k&&f.height(c);k=window.innerHeight};jQuery(window).unbind("resize");
jQuery(window).bind("resize",f);f()}var c=!1,f={style:{tip:{corner:!0,width:5,height:5},def:!1,classes:"qtip-info"},position:{adjust:{method:"flip flip"},at:"bottom left",my:"top left",viewport:jQuery(window)},show:{},events:{show:function(f,h){c=!0}},hide:{delay:m?0:100}};jQuery("span[title]").qtip(f);jQuery("#form-list").bind("scroll",function(){c&&(jQuery("span[title]").qtip("hide"),c=!1)});m||(jQuery("a[title]").qtip(f),jQuery("#form-list").bind("scroll",function(){c&&(jQuery("a[title]").qtip("hide"),
c=!1)}));f.content="time < 30 seconds<br> time was not tracked";f.show.event=!1;var p=jQuery(".timer");p.qtip(f);m||p.mouseover(function(){var f=jQuery(this).find(".time").hide(),c=jQuery(this).find(".timer-info").show();setTimeout(function(){f.show();c.hide()},3E3)}).mouseout(function(){jQuery(this).find(".time").show();jQuery(this).find(".timer-info").hide()});m&&(jQuery(".item").css("padding-right","5px"),jQuery(".task").css("padding-right","5px").css("padding-left","5px"),jQuery(".issue").css("padding-right",
"5px").css("padding-left","5px"),jQuery("body").css("font-size","12px"))});return{display_intervals:[],update_intervals:[],taskDB:c,init:function(){var f=this;this.bind();this.toggleRunText();var c=jQuery("#form-list");!h||"full"==getQueryString("view")?c.addClass("full"):c.css("max-height","439px");!h&&(window.webkitNotifications&&0!=window.webkitNotifications.checkPermission())&&window.open("core/js/permission.html","Permission","height=540,width=447");k=594;sortable("#form-list",{forcePlaceholderSize:!0,
items:".item",handle:".handle"});sortable("#form-list","disable");sortable("#form-list")[0].addEventListener("sortupdate",function(c){var h=f.taskDB.get(jQuery(c.detail.item).attr("rel"));h.order=c.detail.destination.index+1;f.taskDB.setTask(h)})},bind:function(){if(m)jQuery(document).on("click","a[target='_blank']",function(f){f.preventDefault();window.open(jQuery(this).attr("href"),"_blank","location=yes");return!1});jQuery("#cover").hide();jQuery(document).on("click",".cancel",function(c){c.preventDefault();
jQuery("#"+jQuery(this).attr("rel")).hide().hide().find("input:text").val("");jQuery("#form-list").show();jQuery("#top-bar").show();jQuery("#bar").show();f.hideWindow()});jQuery(document).on("click","#search",function(f){f.preventDefault();jQuery("#sort-bar").toggle();jQuery("#search-bar").toggle();jQuery("#searchfor").focus().val("").domsearchClear()});jQuery(document).on("click","#popout",function(f){f.preventDefault();h&&window.chrome.windows.create({url:"index.html?view=full",type:"popup",width:468,
height:600})});jQuery(document).on("click","#create",function(f){f.preventDefault();jQuery(".form").hide();jQuery("#form-create").slideDown().find("input[name='task-name']").focus()});var f=this;jQuery(document).on("click","#button-create",function(){var c=jQuery("#form-create");f.taskDB.insert(c.find(":input[name='task-name']").val());c.hide().find("input:text").val("")});jQuery("#task-name").keydown(function(c){13==c.keyCode&&(c=jQuery("#form-create"),f.taskDB.insert(c.find(":input[name='task-name']").val()),
c.hide().find("input:text").val(""))});jQuery(document).on("click",".remove",function(c){c.preventDefault();jQuery(".form").hide();jQuery("#button-remove").attr("rel",jQuery(this).attr("rel"));jQuery("#remove-confirm").html("Are you sure? You want to <strong>delete "+jQuery(this).attr("title")+"</strong>?");jQuery("#form-remove").show()});jQuery(document).on("click","#button-remove",function(){jQuery("#form-remove").hide();f.taskDB.remove(jQuery(this).attr("rel"))});jQuery(document).on("click","#remove-all",
function(c){c.preventDefault();jQuery(".form").hide();jQuery("#form-remove-all").slideDown()});jQuery(document).on("click","#button-remove-all",function(){jQuery("#form-remove-all").hide();f.taskDB.removeall()});jQuery(document).on("click",".update",function(c){c.preventDefault();jQuery(".form").hide();jQuery("#top-bar").hide();jQuery("#bar").hide();this.taskDB.updateValidate(jQuery(this).attr("rel"),this.update)});jQuery(document).on("click","#button-update",function(){var c=jQuery("#form-update");
c.hide();jQuery("#top-bar").show();jQuery("#bar").show();f.taskDB.update(c.find(":input[name='task-id']").val(),c.find(":input[name='task-name']").val(),c.find(":input[name='task-time']").val())});jQuery(document).on("click",".reset",function(c){c.preventDefault();c=jQuery(this).attr("rel");f.taskDB.reset(c)});var c=function(c){c.preventDefault();f.taskDB.updateValidate(jQuery(this).attr("rel"),function(c){OB.preStart.dispatch(c)});return!1};jQuery(document).on("click",".timer",c);jQuery("#running").click(c);
jQuery("#holder").show()},isMobile:m,displayError:function(c){this.showWindow('<h3><div style="text-align: center; font-weight: bold;">Error</div></h3><div class="content"><p>'+c+'</p><a href="#" id="cancel_confirm" class="btn btn-primary" title="Done">Done</a></div>')},showWindow:function(c,h){var k=jQuery("#cover");h=void 0==h?"#window":h;null!=c&&jQuery(h).html(c);m?(k.css("height","100%").css("opacity","0.8").show(),jQuery(h).animate({top:60+window.pageYOffset+"px"},{easing:"easeInCubic",duration:400,
complete:function(){}})):k.css("height","100%").show().animate({opacity:"0.8"},400,function(){jQuery(h).animate({top:1+window.pageYOffset+"px"},{easing:"easeInCubic",duration:400,complete:function(){}})})},hideWindow:function(c){var h=jQuery("#cover");c=void 0==c?"#window":c;m?jQuery(c).animate({top:"-700px"},{easing:"easeOutCubic",duration:400,complete:function(){h.hide()}}):jQuery(c).animate({top:"-700px"},{easing:"easeOutCubic",duration:400,complete:function(){h.animate({opacity:"0"},{duration:400,
complete:function(){h.hide()}})}})},update:function(c){var h=jQuery("#form-update");h.find(":input[name='task-id']").val(c.ID);h.find(":input[name='task-name']").val(c.name);h.find(":input[name='task-time']").val(this.hms(c.time));h.slideDown()},truncateString:function(c){return c},showTask:function(c){var h,k="";h=jQuery("#item"+c.ID);0!=h.length?h.show():(k+='<div class="item'+(c.running?" running":"")+'" id="item'+c.ID+'" rel="'+c.ID+'">',k+='<div class="handle" title="drag to order tasks"></div><div class="c3">',
k+='<span class="name c1" title="Task: <br>'+c.name+'" ><strong>'+this.truncateString(c.name)+"</strong></span><br>",k+='<span class="details" title="'+c.details+'" data-order="'+(c.order?c.order:1E3)+'">'+this.truncateString(c.details)+"</span><br>",k+='<span id="buttons"><a href="#" class="btn btn-mini update" rel="'+c.ID+'" title="Edit: '+c.name+'">Edit</a> ',k+='<a href="#" class="btn btn-mini reset" rel="'+c.ID+'" title="Reset: '+c.name+'">Reset</a> ',k+='<a href="#" class="btn btn-mini remove" rel="'+
c.ID+'" title="Delete: '+c.name+'">Delete</a></span>',k+="</div>",k+='<div class="c8"><div class="c6">',c.running?(h=new Date(c.start),h=Number(c.time)+Math.floor(((new Date).getTime()-h.getTime())/1E3),k+='<a href="#" class="btn timer btn-primary" rel="'+c.ID+'"><span class="time">'+this.hms(h)+"</span>"):k+='<a href="#" class="btn timer '+(c.disable?"disabled":"")+'" rel="'+c.ID+'"><span class="time">'+this.hms(c.time)+"</span>",k+='<span class="timer-info" style="display: none;">'+(c.running?"Stop":
c.disable?"Max Reached":"Start")+"</span></a>",k+="</div>",k+="</div></div>",c.running&&(this.startTask(c),this.toggleRunText()),jQuery("#form-list").append(k),OB.postItemRender.dispatch(c))},showAll:function(c){if(void 0!=c){var h,k=c.length;if(0!=k)for(h=0;h<k;h++)this.showTask(c[h])}jQuery(".item");OB.postAllItemRender.dispatch()},showNoTaskWindow:function(){this.showWindow('<h3><div style="text-align: center; font-weight: bold;">No Tasks</div></h3><div class="content"><p>Please assign a task to yourself.</p><a href="#" id="cancel_confirm" class="btn btn-primary cancel" title="Done">Done</a></div>')},
toggleTimer:function(c){jQuery("#item"+c.ID+" .timer").toggleClass("btn-primary");c.running?this.stopTask(c):this.startTask(c);this.toggleRunText()},startTask:function(c){if(navigator.onLine){var k=this,m=jQuery("#item"+c.ID),z=new Date;m.find(".timer .timer-info").text("Stop");window.clearInterval(k.display_intervals[c.ID]);h||window.clearInterval(k.update_intervals[c.ID]);c.running?z=new Date(c.start):this.taskDB.start(c.ID,z);k.display_intervals[c.ID]=window.setInterval(function(){var h=Number(c.time)+
Math.floor(((new Date).getTime()-z.getTime())/1E3);jQuery("#item"+c.ID).find(".timer .time").text(k.hms(h));OB.displayInterval.dispatch(c,h)},500);h||(k.update_intervals[c.ID]=window.setInterval(function(){navigator.onLine&&k.taskDB.updateAtInterval(c.ID,Number(c.time)+Math.floor(((new Date).getTime()-z.getTime())/1E3),300)},3E5))}},stopTask:function(c){var k=jQuery("#item"+c.ID),m=this.getDuration(c),z=Number(c.time);if(k)var G=k.find(".timer");z=c.interval?z-300*c.interval+m:z+m;window.clearInterval(this.display_intervals[c.ID]);
h||window.clearInterval(this.update_intervals[c.ID]);this.taskDB.stop(c.ID,z,m,c.done);k&&G&&(0==m&&G.qtip("show"),G.find(".time").text(this.hms(z)),G.find(".timer-info").text("Start"))},getDuration:function(c){c=new Date(c.start);c=Math.floor(((new Date).getTime()-c.getTime())/1E3);30>c?c=0:60>c&&29<c&&(c=60);return c},toggleRunText:function(){var c=jQuery("#running"),k=jQuery(".bar-text");this.taskDB.running(function(m){h?chrome.action.setBadgeText({text:"RUN"}):document.title="Stopwatch - Running: "+
m.name;c.text("Running: "+m.name).attr("rel",m.ID).show();k.hide()},function(m){0==m&&(h?chrome.action.setBadgeText({text:""}):document.title="Stopwatch",c.hide(),k.show())})},hms:function(c){c=[0,0,c];var h;for(h=2;0<h;h--)c[h-1]=Math.floor(c[h]/60),c[h]%=60,10>c[h]&&(c[h]="0"+c[h]);return c.join(":")},sec:function(c){c=String(c).split(":");return Number(parseFloat(3600*c[0])+60*parseFloat(c[1])+parseFloat(c[2]))}}};function taskDB(){return{dm:[],log:[],lastId:0,sql:function(c,k,h,m,f,v){},init:function(){this.createDB();return this},setEvent:function(c,k){var h=this.log;20==h.length&&h.shift();h.push({type:c,message:k,time:(new Date).getTime()});this.log=h},getEvents:function(){return this.log},onError:function(c){},createDB:function(){this.dm=[];this.lastId=0},dropTaskTable:function(){this.createDB()},get:function(c){return this.dm[c]},getSyncId:function(c){for(var k in this.dm)if(null!=this.dm[k]&&this.dm[k].syncID==
c)return this.dm[k];return null},start:function(c,k){this.dm[c].running=1;this.dm[c].start=k;OB.start.dispatch(this.dm[c])},updateAtInterval:function(c,k,h){this.dm[c].running=1;this.dm[c].time=Number(k);this.dm[c].interval+=1;OB.updateAtInterval.dispatch(this.dm[c],Number(h))},stop:function(c,k,h,m){c=this.dm[c];c.running=0;c.interval=0;c.done=m;c.time=Number(k);OB.stop.dispatch(c,Number(h))},setTask:function(c){this.dm[c.ID]=c},running:function(c,k){for(var h in this.dm)if(null!=this.dm[h]&&this.dm[h].running)return c(this.dm[h]),
!0;k();return!1},insert:function(c,k,h){var m="null",f="",v=0;void 0!=k&&(void 0!=k.syncID&&(m=k.syncID),void 0!=k.details&&(f=k.details),void 0!=k.disable&&(v=k.disable));if("null"!=m){k=!1;for(var p in this.dm)if(null!=this.dm[p]&&this.dm[p].syncID==m){k=!0;break}k||(p=this.nextID(),this.dm[p]={ID:p,syncID:m,name:c,details:f,time:0,start:new Date,running:0,done:0,disable:v,interval:!1,order:1E3},OB.insert.dispatch(c,{syncID:m,details:f}));TASK_CNTRL.showTask(this.dm[p]);h&&OB.postAllItemRender.dispatch()}},
nextID:function(){return this.lastId++},updateValidate:function(c,k){null!=this.dm[c]&&k(this.dm[c])},update:function(c,k,h){h=TASK_CNTRL.sec(h);var m;null!=this.dm[c]&&(this.dm[c].name=k,m=this.dm[c].time,this.dm[c].time=h);OB.update.dispatch(this.dm[c],h-m)},updateDetails:function(c,k){null!=this.dm[c]&&(this.dm[c].details=k)},remove:function(c){this.dm[c]=null;void 0!=TASK_CNTRL.update_intervals[c]&&window.clearInterval(TASK_CNTRL.update_intervals[c]);void 0!=TASK_CNTRL.display_intervals[c]&&window.clearInterval(TASK_CNTRL.display_intervals[c]);
OB.remove.dispatch(c)},removeall:function(){this.createDB();for(var c in TASK_CNTRL.update_intervals)window.clearInterval(TASK_CNTRL.update_intervals[c]);for(c in TASK_CNTRL.display_intervals)window.clearInterval(TASK_CNTRL.display_intervals[c]);OB.removeall.dispatch()},reset:function(c){null!=this.dm[c]&&(OB.reset.dispatch(c,this.dm[c]),this.dm[c].time=0)},loadAll:function(c){c(this.dm)}}.init()};function taskDBls(){return{ls:null,ps:null,log:null,userId:null,sql:function(c,k,h,m,f,v){},init:function(){this.ps=new Store("AttaskPersistModel");this.log=new Store("StopwatchLog");null==this.log.get("trace")&&this.log.set("trace",[]);this.ls=new Store("AttaskModel");null==this.ls.get("list")&&(this.createDB(),this.ls.set("date",(new Date).toDateString()));return this},setEvent:function(c,k){var h=this.log.get("trace");20==h.length&&h.shift();h.push({type:c,message:k,time:(new Date).getTime()});
this.log.set("trace",h)},getEvents:function(){return this.log.get("trace")},onError:function(c){},createDB:function(){this.ls.set("lastId",0);this.ls.set("list",[])},dropTaskTable:function(){this.ls.removeAll()},userRunningTasks:function(c){return this.ps.get(c+""+this.ps.get(c))},start:function(c,k){var h=this.ls.get(c);null!=h&&void 0!=h&&(h.running=1,h.start=k,this.ls.set(c,h),null!=this.userId&&(this.ps.set(this.userId+""+h.syncID,h),this.ps.set(this.userId,h.syncID)),OB.start.dispatch(h))},updateAtInterval:function(c,
k,h){var m=this.ls.get(c);null!=m&&void 0!=m&&(m.time=Number(k),m.running=1,m.interval+=1,this.ls.set(c,m),OB.updateAtInterval.dispatch(m,Number(h)))},stop:function(c,k,h,m){c=this.ls.get(c);null!=c&&void 0!=c&&(c.running=0,c.interval=0,c.done=m,c.time=Number(k),null!=this.userId&&(this.ps.remove(this.userId+""+c.syncID),this.ps.remove(this.userId)),OB.stop.dispatch(c,Number(h)))},setTask:function(c){this.ls.set(c.ID,c)},running:function(c,k){var h=this.ls.get("list"),m,f=0,v;for(v in h)h.hasOwnProperty(v)&&
(m=this.ls.get(v),null!=m&&(void 0!=m&&m.running)&&(void 0!=c&&c(m),f++));void 0!=k&&k(f);return 0!=f},getAllRunning:function(){return this.ps.toObject()},insert:function(c,k,h){var m=this,f="null",v="",p=0;void 0!=k&&(void 0!=k.syncID&&(f=k.syncID),void 0!=k.details&&(v=k.details),void 0!=k.disable&&(p=k.disable));k=function(c,f,h,k,p){var v=m.nextID();p={ID:v,syncID:c,name:f,details:h,time:0,start:new Date,running:0,disable:p,interval:!1,order:1E3};if(null!=m.userId){var z=m.ps.get(m.userId+""+
c);null!=z&&z.running&&(p=z)}m.ls.set(v,p);z=m.ls.get("list");z[v]=c;m.ls.set("list",z);OB.insert.dispatch(f,{syncID:c,details:h});TASK_CNTRL.showTask(p);k&&OB.postAllItemRender.dispatch()};if("null"!=f){var z=m.ls.get("list"),G=!1,C;for(C in z)if(z.hasOwnProperty(C)&&null!=z[C]&&z[C]==f){G=!0;break}G?(f=m.ls.get(C),f.name=c,v&&Object.assign(f.details,v),m.ls.set(C,f),TASK_CNTRL.showTask(f),h&&OB.postAllItemRender.dispatch()):k(f,c,v,h,p)}else k(f,c,v,h,p)},nextID:function(){var c=this.ls.get("lastId");
c++;this.ls.set("lastId",c);return c},updateValidate:function(c,k){var h=this.ls.get(c);null!=h&&void 0!=h&&k(h)},get:function(c){return this.ls.get(c)},getSyncId:function(c){var k=this.ls.get("list"),h;for(h in k)if(k.hasOwnProperty(h)&&null!=k[h]&&k[h]==c)return this.ls.get(h);return null},update:function(c,k,h){h=TASK_CNTRL.sec(h);c=this.ls.get(c);null!=c&&void 0!=c&&(c.name=k,k=c.time,c.time=h,OB.update.dispatch(c,h-k))},updateDetails:function(c,k){var h=this.ls.get(c);null!=h&&void 0!=h&&(h.details=
k,this.ls.set(c,h))},remove:function(c){var k=this.ls.get("list");k[c]=null;this.ls.set("list",k);this.ls.remove(c);void 0!=TASK_CNTRL.update_intervals[c]&&window.clearInterval(TASK_CNTRL.update_intervals[c]);void 0!=TASK_CNTRL.display_intervals[c]&&window.clearInterval(TASK_CNTRL.display_intervals[c]);OB.remove.dispatch(c)},removeall:function(){this.createDB();for(var c in TASK_CNTRL.update_intervals)window.clearInterval(TASK_CNTRL.update_intervals[c]);for(c in TASK_CNTRL.display_intervals)window.clearInterval(TASK_CNTRL.display_intervals[c]);
OB.removeall.dispatch()},reset:function(c){var k=this.ls.get(c);null!=k&&void 0!=k&&(OB.reset.dispatch(c,k),k.time=0,this.ls.set(c,k))},loadAll:function(c){var k=this.ls.get("list"),h=[],m,f;for(f in k)k.hasOwnProperty(f)&&(m=this.ls.get(f),null!=m&&void 0!=m&&h.push(m));c(h)},loadSyncIds:function(c){for(var k=this.ls.get("list"),h=[],m,f=c.length,v=0;v<f;v++)m=k.indexOf(c[v]),-1!=m&&(m=this.ls.get(m),null!=m&&void 0!=m&&h.push(m));return h}}.init()};var TASK_DB,IS_WEB=!(window.hasOwnProperty("chrome")&&window.chrome.hasOwnProperty("windows"));TASK_DB=!IS_WEB||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?taskDBls():lscheck()?taskDBls():taskDB();var TASK_CNTRL=taskController(TASK_DB);Offline.options={interceptRequests:!1,requests:!1,checks:{image:{url:"https://www.atappstore.com/client/enterprise-stopwatch/icons/timer32x32.png"},active:"image"}};jQuery(function(){TASK_CNTRL.init();OB.init.dispatch()});
function onLoad(){OB.onLoad.dispatch()}window.addEventListener("beforeunload",function(c){console.log("beforeunload");if(IS_WEB&&TASK_DB.running(function(c){OB.onBeforeUnLoad.dispatch(c)}))return(c||window.event).returnValue="Stopwatch has a task running, are you sure?"});window.addEventListener("pagehide",function(c){console.log("pagehide");OB.onUnLoad.dispatch()});
function lscheck(){try{return localStorage.setItem("stopwatch","stopwatch"),localStorage.removeItem("stopwatch"),!0}catch(c){return!1}};var interval,notifyWorkIntervalTime=30;function startNotify(c){interval=setInterval(function(){notifyWorking(c)},6E4*notifyWorkIntervalTime)}function stopNotify(){clearInterval(interval)}function notifyWorking(c){if(window.webkitNotifications){var k=webkitNotifications.createNotification("../icons/timer48x48.png","Still working on Task:",c.name+"\n"+c.details.split(", Due:")[0]);k.show();setTimeout(function(){k.cancel()},7E3)}else stopNotify()}
function notifyFriday(){var c=webkitNotifications.createNotification("icons/timer48x48.png","Remember: Submit Timesheet!","");c.show();setTimeout(function(){c.cancel()},7E3)};
