(function(b){function d(e,b,d,g,l){this._listener=b;this._isOnce=d;this.context=g;this._signal=e;this._priority=l||0}function g(e,b){if("function"!==typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}function l(){this._bindings=[];this._prevParams=null;var e=this;this.dispatch=function(){l.prototype.dispatch.apply(e,arguments)}}d.prototype={active:!0,params:null,execute:function(e){var b;this.active&&this._listener&&(e=this.params?this.params.concat(e):
e,b=this._listener.apply(this.context,e),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+
", isBound:"+this.isBound()+", active:"+this.active+"]"}};l.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,b,g,l){var B=this._indexOfListener(e,g);if(-1!==B){if(e=this._bindings[B],e.isOnce()!==b)throw Error("You cannot add"+(b?"":"Once")+"() then add"+(!b?"":"Once")+"() the same listener without removing the relationship first.");}else e=new d(this,e,b,g,l),this._addBinding(e);this.memorize&&this._prevParams&&e.execute(this._prevParams);return e},
_addBinding:function(e){var b=this._bindings.length;do--b;while(this._bindings[b]&&e._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,e)},_indexOfListener:function(e,b){for(var d=this._bindings.length,g;d--;)if(g=this._bindings[d],g._listener===e&&g.context===b)return d;return-1},has:function(e,b){return-1!==this._indexOfListener(e,b)},add:function(e,b,d){g(e,"add");return this._registerListener(e,!1,b,d)},addOnce:function(e,b,d){g(e,"addOnce");return this._registerListener(e,!0,
b,d)},remove:function(e,b){g(e,"remove");var d=this._indexOfListener(e,b);-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1));return e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var b=Array.prototype.slice.call(arguments),d=this._bindings.length,g;this.memorize&&(this._prevParams=
b);if(d){g=this._bindings.slice();this._shouldPropagate=!0;do d--;while(g[d]&&this._shouldPropagate&&!1!==g[d].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var e=l;e.Signal=l;"function"===typeof define&&define.amd?define(function(){return e}):"undefined"!==typeof module&&module.exports?module.exports=e:b.signals=
e})(this);var OB={updateAtInterval:new signals.Signal,displayInterval:new signals.Signal,start:new signals.Signal,stop:new signals.Signal,preStart:new signals.Signal,preStop:new signals.Signal,insert:new signals.Signal,update:new signals.Signal,reset:new signals.Signal,remove:new signals.Signal,removeAll:new signals.Signal,init:new signals.Signal,options:new signals.Signal,postItemRender:new signals.Signal,postAllItemRender:new signals.Signal,onLoad:new signals.Signal,onUnLoad:new signals.Signal,onBeforeUnLoad:new signals.Signal};(function(){var b=this.Store=function(b,g){var l;this.name=b;if(void 0!==g)for(l in g)g.hasOwnProperty(l)&&void 0===this.get(l)&&this.set(l,g[l])};b.prototype.get=function(b){b="store."+this.name+"."+b;if(null!==localStorage.getItem(b))try{return JSON.parse(localStorage.getItem(b))}catch(g){return null}};b.prototype.set=function(b,g){if(void 0===g)this.remove(b);else{if("function"===typeof g)g=null;else try{g=JSON.stringify(g)}catch(l){g=null}localStorage.setItem("store."+this.name+"."+b,g)}return this};
b.prototype.remove=function(b){localStorage.removeItem("store."+this.name+"."+b);return this};b.prototype.removeAll=function(){var b,g;b="store."+this.name+".";for(g=localStorage.length-1;0<=g;g--)localStorage.key(g).substring(0,b.length)===b&&localStorage.removeItem(localStorage.key(g));return this};b.prototype.toObject=function(){var b,g,l,e,u;b={};g="store."+this.name+".";for(l=localStorage.length-1;0<=l;l--)localStorage.key(l).substring(0,g.length)===g&&(e=localStorage.key(l).substring(g.length),
u=this.get(e),void 0!==u&&(b[e]=u));return b};b.prototype.fromObject=function(b,g){!0!==g&&this.removeAll();for(var l in b)b.hasOwnProperty(l)&&this.set(l,b[l]);return this}})();var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(b){for(var d=0;d<b.length;d++){var g=b[d].string,l=b[d].prop;this.versionSearchString=b[d].versionSearch||b[d].identity;if(g){if(-1!=g.indexOf(b[d].subString))return b[d].identity}else if(l)return b[d].identity}},
searchVersion:function(b){var d=b.indexOf(this.versionSearchString);if(-1!=d)return parseFloat(b.substring(d+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",
identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",
identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();var attask=function(){function b(a){f.set("general",!1);var c=f.get("host").replace(/[|&;$%@"<>()+,]/g,""),h=new Date;h.setHours(h.getHours()-h.getTimezoneOffset()/60);h=h.toJSON();c={url:"https://"+xa+"/Tools/Subform/UsageTracker.aspx?f=Stopwatch",data:JSON.stringify({dateTime:h,activity:{request:c},userID:f.get("userID")}),dataType:"json",type:"POST"};c=jQuery.ajax(c);c.done(function(c,h,e){if(c.isValid){try{c.message=JSON.parse(c.message),c.isWarn&&console.log(c.message.message)}catch(b){f.set("access",
"demo");f.set("is_auth",!1);console.log(c.message);a&&a();return}f.set("ent",!0);f.set("updateAtInterval",void 0!=c.message.updateAtInterval?c.message.updateAtInterval:!1);f.set("userHostName",c.message.userHostName);f.set("stopOnClose",void 0!=c.message.stopOnClose?c.message.stopOnClose:!0);f.set("forceHourTypeID",c.message.forceHourTypeID);f.set("maxTaskTime",void 0!=c.message.maxTaskTime?parseFloat(c.message.maxTaskTime):8.5);f.set("hideTaskButtons",void 0!=c.message.hideTaskButtons?c.message.hideTaskButtons:
!1);f.get("hideTaskButtons")&&f.set("sort","project");h=function(){f.set("is_auth",!0);f.set("auth_key",!0);f.set("sessionID",c.message.apiKey);f.set("password",null);a&&a();jQuery("#top-bar").show();aa()};(void 0!=c.message.forceLogin?c.message.forceLogin:1)?void 0==f.get("sessionID")?ba(h):h():h()}else f.set("access","demo"),f.set("is_auth",!1),console.log(c.message),a&&a()});c.fail(function(a,c,h){})}function d(a){f.set("updateAtInterval",!1);f.set("general",!0);if(f.get("ent"))b(a);else{var c=
-1==window.location.origin.indexOf("atappstore.com")?"https://"+ca:window.location.origin,h=f.get("qr")?"shiftwatch-qr":"stopwatch",c={url:c+"/api/authorize/",data:{product:h,host:f.get("host"),sessionID:f.get("sessionID"),user:f.get("username"),domain:f.get("domain")},type:"GET",dataType:"json"};w(c);c=jQuery.ajax(c);c.done(function(c,h,e){!1!=c.success&&(f.set("auth_key",c.auth_key),f.set("access",c.access),f.set("is_auth",c.is_auth),f.set("license_expiry_days",c.license_expiry_days),f.get("qr")&&
(f.set("view","team"),f.set("sort","project"),f.set("logout_on_select",!0),f.set("multi",!0),f.set("hide_team_done",!0),f.set("minuteBuffer",30),f.set("minuteBufferSnapToSched",!0),TASK_DB.userId=f.get("userID")),f.get("minuteBufferSnapToSched")&&da(),f.get("restrict_sched")?da(function(c){var h;void 0==c&&(h="Today is not a work day");var k=new Date,k=Date.parse("01/01/2011 "+k.getHours()+":"+k.getMinutes()),m=Date.parse("01/01/2011 "+c.start),e=Date.parse("01/01/2011 "+c.stop),b=f.get("minuteBuffer");
null!=b&&(m.setMinutes(m.getMinutes()-b),e.setMinutes(e.getMinutes()+b));void 0==c||m>k||k>e?(h=h?h:"Please return at "+c.start,TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Not scheduled to work</h3></div><div class="content"><p>'+h+'.</p><a href="#" class="btn btn-primary logout cancel" title="Logout">Logout</a></div>')):a()}):""==f.get("access")?ea(a,function(){Ja()}):a&&a())});c.fail(function(a,c,h){})}}function g(){var a={url:t()+"user/count",type:"get",data:{},
dataType:"json"};w(a);a=jQuery.ajax(a);a.done(function(a){void 0!=a.error?(a.error["class"]==y[0]?v(function(){}):e(s[0],"uCount,"+JSON.stringify(a.error)),n.hide(),q.hide()):(a=a.data,e(s[1],{uc:a.count}))});a.fail(function(a,h,k){x({response:a.responseText,type:h,msg:k},g,"uCount")})}function l(){var a={url:t()+"user/search?ID=$$USER.ID&fields=customer:name,customer:fullUsers,customer:limitedUsers,customer:teamUsers",type:"get",data:{},dataType:"json"};w(a);a=jQuery.ajax(a);a.done(function(a){void 0!=
a.error?(a.error["class"]==y[0]?v(function(){}):e(s[0],"uInfo,"+JSON.stringify(a.error)),n.hide(),q.hide()):(a=a.data,e(s[1],a))});a.fail(function(a,h,k){x({response:a.responseText,type:h,msg:k},l,"uInfo")})}function e(a,c,h){TASK_DB.setEvent(a,JSON.stringify(c))}function u(){if(I||E||void 0!=f.get("host")&&"full"==getQueryString("view"))window.clearInterval(O),O=window.setInterval(function(){if(navigator.onLine&&(E||!document.hasFocus()))jQuery("#search-bar").is(":visible")&&jQuery("#search").click(),
jQuery("#form-list").hide(),void 0==f.get("sessionID")?J():S()},1E3*(ya+120))}function p(a,c){var h;return(h=f.get("maxTaskTime"))&&void 0!=h&&h<=Number((c/3600).toFixed(2))?(a=TASK_DB.get(a.ID),a.disable=1,TASK_DB.setTask(a),TASK_CNTRL.toggleTimer(a),h=jQuery("#item"+a.ID),h.find(".timer").unbind("click").addClass("disabled"),h.find(".timer-info").text("Max Reached"),!0):!1}function z(){var a=new Date;a.setHours(23,59,0,0);var c=new Date;clearTimeout(za);za=setTimeout(function(){TASK_DB.running(function(a){TASK_CNTRL.toggleTimer(a)})},
a-c);clearTimeout(Aa);Aa=setTimeout(function(){location.reload()},a-c+65E3)}function N(){var a=!1;if(void 0==f.get("date")||(new Date(f.get("date"))).getDay()!=(new Date).getDay())B(),a=!0;S();return a}function B(){jQuery("#form-list").empty();f.set("notified",!1);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();var a=new Date;jQuery("#todayDate").html("Date: "+fa(a.getMonth())+" "+a.getDate());z();f.set("date",a.toDateString())}function T(){var a=f.get("view");void 0==a?Ba():
jQuery("#button-"+a).click()}function Ba(){jQuery("#button-current").click()}function Ja(){if(""==f.get("access")&&!f.get("notified")){f.set("notified",!0);var a='<div style="text-align: center; font-weight: bold;"><h3>Expired for '+f.get("host")+'</h3></div><div class="content"><div><p>To keep the ease of tracking your time, see due dates, and completing your tasks, please visit our site below to see licencing options for your company or to arrange an extended demo. If seeing this for the first time, another employee at your company has used this service 30 days ago, please contact info@atappstore.com to extend.</p></div><a href="http://store.atappstore.com/index.php/portfolio/stopwatch/" target="_blank"><img src="icons/AtAppStore.png" style=""></a><div style="font-size: 10px;">* this notification will only appear once daily.</div></div><div id="close" class="btn btn-primary" style="width:230px"><h3 style="line-height:0px">close</h3></div>';
TASK_CNTRL.showWindow(a);jQuery("#close").unbind("click").click(function(a){a.preventDefault();TASK_CNTRL.hideWindow()});e(s[1],{os:BrowserDetect.OS,browser:BrowserDetect.browser,version:BrowserDetect.version,extension:!I,user:f.get("userObj"),license_expiry_days:f.get("license_expiry_days")});g();l()}}function Ka(){document.onkeydown=function(a){a=window.event?event:a;if(66==a.keyCode&&a.ctrlKey){a=TASK_DB.getEvents();for(var c=0;c<a.length;c++)console.log("%c %s - %c %s - %c %s","color:blue",a[c].time,
"color:orange",a[c].type,"color:brown",a[c].message);console.log(TASK_DB.getEvents())}else 87==a.keyCode&&a.altKey&&window.open(t()+"work/myWork?fields=statusEquatesWith,primaryAssignment:status,canStart,isReady,isStatusComplete,parent:status,parent:canStart,parent:isReady,parent:isStatusComplete,project:statusEquatesWith,project:status,parent:statusEquatesWith,parent:primaryAssignment:status&sessionID="+f.get("sessionID"))};var a=jQuery("#content");a.after('<form id="form-qrlogin" class="form" style="display: none"><h3>Login to Workfront</h3><span class="error"></span><p><div id="outdiv" style="text-align:center;"></div><canvas id="qr-canvas" width="640" height="480" style="display:none;"></canvas><h4 id="result" style="text-align:center;"></h4><button type="submit" class="btn btn-success needsclick" style="display:none;" id="button-appscan" value="scan" tabindex="3">Scan</button><button type="submit" class="btn needsclick" style="" id="button-standard" tabindex="5">Standard Login</button><button type="submit" class="btn btn-primary needsclick" style="display:none;" id="button-qrlogin" value="login" tabindex="4">Login</button></form><div class="spinner-bottom"><div id="blockG_1" class="metro_blockG"></div><div id="blockG_2" class="metro_blockG"></div><div id="blockG_3" class="metro_blockG"></div></div>');
jQuery(document).on("click","#button-standard",function(a){a.preventDefault();ba();jQuery("#form-qrlogin").show()});jQuery(document).on("click","#button-appscan",function(a){a.preventDefault();a=window.navigator.userAgent;a.match(/iPad/i)||a.match(/iPhone/i)?window.location="zxing://scan/?ret="+encodeURIComponent(window.location+"&code={CODE}"):window.location="http://zxing.appspot.com/scan?ret="+encodeURIComponent(window.location+"&code={CODE}")});a.after('<form id="form-login" class="form" style="display: none"><h3>Login to Workfront</h3><span class="error"></span><div><div style=""><label for="username">Username</label><input style="" type="text" name="username" id="username" class="text" tabindex="1"></div><div style="clear: both;" id="password-container"><label for="password">Password</label><input type="password" name="password" id="password" class="text" tabindex="2" autocomplete="off"/></div><div style="clear: both;"></div><label for="host">Subdomain</label><input type="text" name="host" id="host" class="text" tabindex="4"/></div><p>eg. <strong>Subdomain</strong>.my.workfront.com</p></p></br><button type="submit" class="btn btn-primary needsclick" id="button-login" value="login" tabindex="5">Login</button></form>');
jQuery(document).on("click","#singlesignon",function(a){jQuery("#password-container").toggle()});a='<div id="hourTypeWindow" class="window"><div style="text-align: center; font-weight: bold;"><h3>Track as Type:</h3></div><div class="content"><div><select id="hourTypeSelector" ></select><div><a href="#" id="done_hourType" class="btn btn-primary" rel="'+jQuery(this).attr("rel")+'" title="Start">Start</a><a href="#" id="cancel_hourType" class="btn" title="Cancel">Cancel</a><div><div></div>';jQuery("#window").after(a);
if(I||"full"==getQueryString("view")||E)jQuery("#popout").replaceWith('<span id="refresh" style="float: right;" title="Manual Refresh"><img src="core/img/refresh.gif"></span>'),jQuery("html").css("width","100%"),jQuery(document).on("click","#refresh",function(a){a.preventDefault();jQuery("#form-list").hide();jQuery("#search-bar").is(":visible")&&jQuery("#search").click();G()});var a=new Date,c='<div id="top-menu"><div class="btn-group"><a id="filter" title="Filter for other assigned tasks and issues" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">Filters<span class="caret"></span></a><ul class="dropdown-menu">',
h;for(h in K)K.hasOwnProperty(h)&&(c+='<li><a href="#" id="button-'+h+'" class="filter" title="'+K[h].d+'" >'+K[h].t+"</a></li>");c+='<div id="custom-filters"><div id="task-filters" style="display:none;"></div><div id="opTask-filters" style="display:none;"></div></div><li><a href="#" class="logout" id="button-logout" >Login as New User</a></li></ul></div><span id="totalHours" title="Go To Timesheets" class="btn" style="">Today\'s Hours: 0</span><span id="todayDate" class="btn disabled" style="">Date: '+
fa(a.getMonth())+" "+a.getDate()+"</span></div>";jQuery("#bar").html(c);Ca(K);jQuery(document).on("click","#totalHours",function(a){a.preventDefault();a="https://"+f.get("host")+"."+f.get("domain")+"/timesheets/current";E?window.open(a,"_blank","location=yes"):window.open(a);return!1});var k=function(a,c){for(var h in C)C.hasOwnProperty(h)&&h!=c&&(C[h]="desc");f.set("current_sort",{sort:c,order:C[c]});C[c]="asc"==C[c]?"desc":"asc";jQuery("#sort-menu").find(">ul>li>a").removeClass();jQuery(a).addClass("btn active")};
jQuery(document).on("click","#sort-task",function(a){a.preventDefault();k(this,"task");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{order:C.task},{selector:".details",order:"desc"})});jQuery(document).on("click","#sort-project",function(a){a.preventDefault();k(this,"project");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",
order:C.project},{selector:".details",order:"desc",useVal:!0,attr:"data-days"})});jQuery(document).on("click","#sort-date",function(a){a.preventDefault();k(this,"date");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:C.date,useVal:!0,attr:"data-days"},{selector:".details",order:"desc"})});jQuery(document).on("click","#sort-priority",function(a){a.preventDefault();k(this,"priority");jQuery("div#form-list>div").children().length&&
tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:C.priority,useVal:!0,attr:"data-priority"},{selector:".details",order:"desc"})});jQuery(document).on("click","#sort-status",function(a){a.preventDefault();k(this,"status");jQuery("div#form-list>div").children().length&&tinysort("div#form-list>div",{order:"desc",useVal:!0,attr:"data-force-order"},{selector:".details",order:C.status,useVal:!0,attr:"data-status"},{selector:".details",order:"desc"})});
jQuery(document).on("click",".done",function(a){a.preventDefault();a=jQuery(this);var c=a.parent().parent(),h=c.children("span.name").attr("title"),c=c.children("span.details").attr("title");a='<div style="text-align: center; font-weight: bold;"><h3>Confirm</h3></div><div class="content"><div>Are you sure you completed <strong>'+h+"</strong><br>from <br><strong>"+c+'?</strong><div><br><a href="#" id="done_confirm" class="btn btn-primary" rel="'+a.attr("rel")+'" title="Done">Done</a><a href="#" class="btn cancel" title="Cancel">Cancel</a><div>';
TASK_CNTRL.showWindow(a)});jQuery(document).on("click","#done_confirm",function(a){a.preventDefault();TASK_DB.updateValidate(jQuery(this).attr("rel"),function(a){U(a)});TASK_CNTRL.hideWindow()});jQuery(document).on("click","#cancel_confirm",function(a){a.preventDefault();TASK_CNTRL.hideWindow()});h=function(a){a.preventDefault();a=jQuery(this).find(".hour-note").attr("rel");if((a=TASK_DB.get(a))&&a.time&&!a.running&&!a.disable)La(a,function(a,c){TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><div class="spinner"><div id="blockG_1" class="metro_blockG"></div><div id="blockG_2" class="metro_blockG"></div><div id="blockG_3" class="metro_blockG"></div></div><h3>Timesheet Hour Note:</h3></div><div class="content"><strong>'+
a.name+'</strong><br><br><div><textarea maxlength="2000" rows="2" cols="100" class="comment" style="width:300px" id="comment_message">'+(null==c.description?"":c.description)+'</textarea><div><a href="#" id="hour-note_confirm" class="btn btn-primary" task="'+a.ID+'" hour="'+c.ID+'" title="Update Note">Update Note</a><a href="#" class="btn cancel" title="Cancel">Cancel</a><div>')}),jQuery("textarea.comment").focus()};jQuery(document).on("click",".task-lower-block",h);jQuery(document).on("click",".general-lower-block",
h);jQuery(document).on("click","#hour-note_confirm",function(a){a.preventDefault();$t=jQuery(this);TASK_DB.updateValidate($t.attr("task"),function(a){Ma(a,$t.attr("hour"),jQuery("#comment_message").val())});TASK_CNTRL.hideWindow()});jQuery(document).on("click",".percent",function(a){a.preventDefault();a=jQuery(this);var c=jQuery("#form-list");c.scrollTop(c.scrollTop()+jQuery("#item"+a.attr("rel")).offset().top-100);if(0==a.children("input").length){var h=a.text().slice(0,-1);a.html("<input type='number' class='inputbox percent' value=\""+
h+'">');var k=function(a){a=jQuery(a);var c=Number(a.val()).toFixed(0);isNaN(c)||0>c||100<c||h==c?c=h:TASK_DB.updateValidate(a.parent().attr("rel"),function(a){V(a,c)});a.parent().text(c+"%")};jQuery("input.percent").focus().blur(function(){k(this)}).keypress(function(a){13==a.which&&(k(this),a.preventDefault())})}});jQuery(document).on("click",".btn-comment",function(a){a.preventDefault();a=jQuery(this);a='<div style="text-align: center; font-weight: bold;"><h3>Comment</h3></div><div class="content"><strong>'+
a.parent().parent().children("span.name").attr("title")+'</strong><br><br><div><textarea maxlength="2000" rows="2" cols="100" class="comment" style="width:300px" id="comment_message"></textarea><label style="float:right; margin-top: 10px;">Private:<input type="checkbox" name="isPrivate" id="comment_is_private" style="margin: 0 4px;"></label><div><a href="#" id="comment_confirm" class="btn btn-primary" rel="'+a.attr("rel")+'" title="Comment">Comment</a><a href="#" class="btn cancel" title="Cancel">Cancel</a><div>';
TASK_CNTRL.showWindow(a);jQuery("textarea.comment").focus()});jQuery(document).on("click","#comment_confirm",function(a){a.preventDefault();a=jQuery(this);var c=jQuery("#comment_is_private").is(":checked"),h=jQuery("#comment_message").val();TASK_DB.updateValidate(a.attr("rel"),function(a){W(a,h,c)});TASK_CNTRL.hideWindow()});var m=jQuery("#form-list");m.scroll(function(){f.set("vpos",m.scrollTop())});q=jQuery(".spinner-bottom");n=jQuery(".spinner")}function Da(a,c){var h=jQuery("#"+a+"-filters").first(),
k="",m;for(m in c)c.hasOwnProperty(m)&&(k+='<li><a href="#" id="button-'+m+'" class="filter" title="'+c[m].d+'" >'+c[m].t+"</a></li>");h.append(k);Ca(c)}function Ca(a){var c=jQuery(".filter"),h=jQuery("#active-filter"),k;for(k in a)a.hasOwnProperty(k)&&(jQuery("#active-filter").hide(),jQuery("#button-"+k).attr("name",k),jQuery(document).on("click","#button-"+k,function(){var k=jQuery(this),e=k.attr("name");C=[];c.removeClass("btn");Ea();h.html("Filter: "+k.text());h.css("display","inline-block");
k.toggleClass("btn");f.set("view",e);a[e].f()}))}function J(){if(L&&f.get("allowOffline"))f.remove("sessionID"),f.remove("userID"),f.remove("username"),f.remove("password"),f.remove("host"),f.remove("domain");else{var a=f.get("qr");f.removeAll();f.set("qr",a)}for(var c in TASK_CNTRL.update_intervals)window.clearInterval(TASK_CNTRL.update_intervals[c]);for(c in TASK_CNTRL.display_intervals)window.clearInterval(TASK_CNTRL.display_intervals[c]);ga()}function D(a){TASK_DB.loadAll(function(c){var h=c.length,
k,m;if(0<h)for(k=0;k<h;k++)m=c[k],(null!=m&&"OPTASK"==m.details.objCode||"TASK"==m.details.objCode)&&jQuery("#item"+m.ID).hide();a()})}function v(a){f.get("ent")?ea(a):ha(f.get("username"),f.get("password"),ia(f.get("host")+"."+f.get("domain")),a,function(){ga(a)})}function ga(a){f.get("qr")?Na(a):ba(a)}function ea(a,c){n.show();jQuery("#loading").hide();window.clearInterval(O);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();n.hide();q.hide();jQuery("#top-bar").hide();jQuery("#bar").hide();
jQuery(".form").hide();b(function(){S(function(){ja();void 0!=a&&a()},function(a){void 0!=c?c():ga(a)})})}function Na(a){n.show();jQuery("#loading").hide();window.clearInterval(O);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();resetForQR();n.hide();q.hide();jQuery("#top-bar").hide();jQuery("#bar").hide();jQuery(".form").hide();jQuery("webcamimg").show();var c=jQuery("#form-qrlogin");jQuery("#form-list").html("");E?c.show():c.slideDown(400,function(){});jQuery("#button-qrlogin").unbind("click").click(function(c){var k=
jQuery("#form-qrlogin");c.preventDefault();q.show();ha(f.get("username"),f.get("password"),ia(f.get("host")),function(){ignoreForQR();jQuery("#bar").show();E?k.hide():k.slideUp();jQuery("#top-bar").show();jQuery("#loading").show();void 0!=a&&a()},function(){resetForQR()})})}function ba(a){n.show();jQuery("#loading").hide();window.clearInterval(O);TASK_DB.dropTaskTable();TASK_DB.createDB();TASK_CNTRL.toggleRunText();n.hide();q.hide();jQuery("#top-bar").hide();jQuery("#bar").hide();jQuery(".form").hide();
var c=jQuery("#form-login"),h=f.get("domain"),k=f.get("host");c.find(":input[name='username']").focus().val("");c.find(":input[name='host']").val(void 0==k||"undefined"==k?"":"my.workfront.com"!=h?k+"."+h:k);c.find(":input[name='password']").val("");jQuery("#form-list").html("");var m=jQuery("#username");E?(c.show(),m.focus()):c.slideDown(400,function(){m.focus()});jQuery("#button-login").unbind("click").click(function(h){h.preventDefault();q.show();ha(jQuery.trim(c.find(":input[name='username']").val()),
jQuery.trim(c.find(":input[name='password']").val()),ia(jQuery.trim(c.find(":input[name='host']").val())),function(){jQuery("#bar").show();E?c.hide():c.slideUp();jQuery("#top-bar").show();jQuery("#loading").show();void 0!=a&&a()})})}function M(a,c,h){var k=new Date;a.dateStr=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();a.duration=c;navigator.onLine?X(a,Oa,h):(c=f.get("offlineTasks"),void 0==c&&(c=[]),c.push(a),f.set("offlineTasks",c),n.hide(),q.hide(),!0==f.get("logout_on_select")&&J())}function ka(a){X(a,
function(a,h){var k=new Date,m={entryDate:k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate(),ownerID:f.get("userID")};m.extRefID=h&&h.extRefID?"ON!"+k.getHours()+":"+k.getMinutes()+";"+h.extRefID:"ON~"+k.getHours()+":"+k.getMinutes()+".";m.extRefID=m.extRefID.substring(0,254);void 0==h||-1!=h.permissions.actions.indexOf("ADD_HOURS")&&-1!=h.permissions.actions.indexOf("CHANGE_STATUS")?(m.hours=0.01,m.method="post"):(m.method="put",m.ID=h.ID);"GEN"==a.details.objCode?m.hourTypeID=a.syncID:("OPTASK"==
a.details.objCode?m.opTaskID=a.syncID:m.taskID=a.syncID,m.hourTypeID=f.get("forceHourTypeID"),void 0==m.hourTypeID&&(void 0!=a.details.hourTypeID&&""!=a.details.hourTypeID)&&(m.hourTypeID=a.details.hourTypeID));k={url:t("api/v7.0")+"hour/",type:"get",data:m,dataType:"json",async:!1};w(k);k=jQuery.ajax(k);k.done(function(h){void 0!=h.error?h.error["class"]==y[0]?v(function(){setHourAttask()}):x({response:h.error,type:null,msg:null},function(){ka(a)},"logStart,"+a.syncID+" "+a.name+" url: "+t()+" "+
JSON.stringify(m)+" "+F(a)):(void 0!=m.taskID||void 0!=m.opTaskID)&&P(a)});k.fail(function(h,k,e){x({response:h.responseText,type:k,msg:e},function(){ka(a)},"logStart-fail,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(m)+" "+F(a)+","+a.duration+", "+h.responseText+", "+e,h.responseText)})})}function fa(a){return"Jan. Feb. Mar. Apr. May June Jul. Aug. Sep. Oct. Nov. Dec.".split(" ")[a]}function F(a){return void 0!=a.details.project?a.details.project.name.split(",").join(" ")+","+a.name.split(",").join(" "):
a.details}function w(a,c){void 0==c&&(c=1E4);a.timeout=c;I&&!Fa&&(a.dataType="jsonp",a.crossDomain=!0,a.jsonp="jsonp",a.cache=!0);var h=f.get("sessionID");f.get("ent")?("PUT"==a.data.method&&(a.type="POST"),a.data.apiKey=h):a.data.sessionID=h}function ia(a){if(1<a.split(".").length){var c=a.split("//");return 1<c.length?(c.shift(),c[0]):a}return a+".my.workfront.com"}function ha(a,c,h,k,m){if(void 0==a||void 0==c||void 0==h)m();else{var e=jQuery(".error");e.html("");var b={url:"https://"+h+"/attask/api/v"+
(-1!=location.origin.indexOf("localhost")?2:5)+".0/login",type:"post",data:{username:a,password:c,method:"post"},dataType:"json"};w(b);L?(b=f.get(a),void 0!=b?(Ga(b.sessionID,b.userID,b.username,b.password,h),q.hide(),G(),u(),void 0!=k&&k()):e.html("OFFLINE")):(b=jQuery.ajax(b),b.done(function(b){void 0!=b.error?(f.get("qr")?e.html("Please Scan Again."):e.html(b.error.message),q.hide(),void 0!==m&&m()):(b=b.data,Ga(b.sessionID,b.userID,a,c,h),f.set("userObj",JSON.stringify(b)),q.hide(),d(function(){f.get("ent")||
G();u();void 0!=k&&k()}))}),b.fail(function(a,c,k){a.responseText&&""!==a.responseText?-1!=a.responseText.indexOf("<html>")?f.get("qr")?e.html("Please Scan Again."):e.html("Host Invalid: "+h):f.get("qr")?e.html("Please Scan Again."):e.html(JSON.parse(a.responseText).error.message.replace("Authentication Exception: Authentication Exception: {0}","Wrong login, please try again.")):f.get("qr")?e.html("Please Scan Again."):e.html("Host Invalid: "+h);q.hide();void 0!==m&&m()}))}}function Ga(a,c,h,k,e){f.set("sessionID",
a);f.set("userID",c);f.set("username",h);f.set("password",k);e=e.split(".");f.set("host",e[0]);e.shift();f.set("domain",e.join("."));f.get("allowOffline")&&f.set(h,{sessionID:a,userID:c,username:h,password:k})}function S(a,c){var h=f.get("sessionID");void 0==h||""==h?v(a):(n.show(),h={url:t()+"user/"+f.get("userID"),data:{method:"put",updates:"{isActive: true}"},type:"get",dataType:"json"},w(h),h=jQuery.ajax(h),h.done(function(h){void 0!=h.error?(h.error["class"]==y[0]?void 0!=c?c(a):v(a):e(s[0],
"sessionValid,"+f.get("sessionID")+","+JSON.stringify(h.error)),n.hide(),q.hide()):(n.hide(),q.hide(),void 0==f.get("auth_key")?d(G):G(),void 0!=a&&a())}),h.fail(function(h,m,b){401==h.status?void 0!=c?c(a):v(a):"timeout"==m?S(a):e(s[0],"sessionValid,"+f.get("sessionID")+","+h.responseText)}))}function G(){n.show();la();Ha();var a=f.get("userID"),c={url:t("api-internal")+"timeSheet/search",type:"get",data:{startDate:"$$TODAY+1",startDate_Mod:"lte",endDate:"$$TODAY-1",endDate_Mod:"gte",fields:"extRefID,startDate,timesheetProfile:description,timesheetProfile:hourTypes:ID,timesheetProfile:hourTypes:name,timesheetProfile:hourTypes:description,timesheetProfile:hourTypes:isActive",
userID:a},dataType:"json"};w(c,35E3);L?f.get("allowOffline")?(a=TASK_DB.userRunningTasks(a),void 0!=a&&(A=!0,TASK_DB.insert(a.name,{syncID:a.syncID,details:a.details},!0))):TASK_CNTRL.displayError("OFFLINE"):(a=jQuery.ajax(c),a.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?v(function(){G()}):e(s[0],"addGeneralTasks-done,"+JSON.stringify(a.error));else{a=a.data;if(0!=a.length){var c=new Date(f.get("launched"));if(null==a[0].extRefID)Q(a[0].ID,c,0);else if(f.get("updateAtInterval")){var m=
0,b=1;if(isNaN(parseInt(a[0].extRefID)))var g=JSON.parse(a[0].extRefID),m=g.last_launched,b=parseInt(g.count);else m=a[0].extRefID;m=new Date(parseInt(m));if(0<m.getTime()){if(m.getTime()>c.getTime()){TASK_CNTRL.showWindow('<div class="content"><h3>Stopwatch has been launched on another computer at '+m.toLocaleTimeString()+', Would you like to keep this stopwatch?</h3><div style="text-align:center"></div><div id="dupe-yes" class="btn btn-primary" style="width:230px"><h3 style="line-height:0px">Yes</h3></div><div id="dupe-no" class="btn btn-default" style="width:230px"><h3 style="line-height:0px">No</h3></div></div></div>');
jQuery("#dupe-yes").unbind("click").click(function(c){c.preventDefault();n.show();TASK_CNTRL.hideWindow();c=new Date;f.set("launched",c.getTime());Q(a[0].ID,c,b,function(){G()})});jQuery("#dupe-no").unbind("click").click(function(a){a.preventDefault();n.show();jQuery("#holder").empty();f.get("updateAtInterval")?(TASK_DB.running(function(a){M(a,-ya)}),setTimeout(function(){B();window.close();TASK_CNTRL.hideWindow()},2E3)):(B(),window.close(),TASK_CNTRL.hideWindow())});return}m.getTime()!=c.getTime()&&
Q(a[0].ID,c,b)}}}if(0!=a.length&&void 0!=a[0].timesheetProfile&&void 0!=a[0].timesheetProfile.hourTypes)if(a[0].timesheetProfile.description==Pa&&E)jQuery(".holder").empty(),TASK_CNTRL.showWindow('<div class="content"><h3>Please use Stopwatch on a desktop computer.</h3></div>'),n.hide(),q.hide();else if(c=f.get("userHostName"),void 0!=c&&-1==a[0].timesheetProfile.description.indexOf(c)&&!getQueryString("force_host"))jQuery(".holder").empty(),TASK_CNTRL.showWindow('<div class="content"><h3>Please use Stopwatch on a work computer.</h3></div>'),
n.hide(),q.hide();else{if(0!=a[0].timesheetProfile.hourTypes.length){var c=0,m=a[0].timesheetProfile.hourTypes,d;for(d in m)m.hasOwnProperty(d)&&!0==m[d].isActive&&(c++,TASK_DB.insert(m[d].name,{syncID:m[d].ID,details:{objCode:"GEN",description:null!=m[d].description?"General - "+m[d].description:"'General"}},0))}T()}else f.get("general")?ma():T()}}),a.fail(function(a,k,e){x({response:a.responseText,type:k,msg:e,status:a.status},G,"addGeneralTasks-fail"+k+"-"+e+" "+a.responseText+" "+a.status+" "+
JSON.stringify(c))}))}function Q(a,c,h,k){var b={url:t()+"timeSheet/",type:"get",data:{ID:a,extRefID:JSON.stringify({last_launched:c.getTime(),count:++h}),method:"put"},dataType:"json"};w(b);var f=jQuery.ajax(b);f.done(function(b){void 0!=b.error?b.error["class"]==y[0]?v(function(){Q(a,c,h,k)}):e(s[0],"ownTimesheet,"+a+JSON.stringify(b.error)):void 0!=k&&k()});f.fail(function(e,f,d){x({response:e.responseText,type:f,msg:d,status:e.status},function(){Q(a,c,h,k)},"ownTimesheet-fail"+a+" "+f+"-"+d+" "+
e.responseText+" "+e.status+" "+JSON.stringify(b))})}function ja(){var a={url:t()+"HourType/search",type:"get",data:{fields:"ID",description:"Stopwatch",description_Mod:"cicontains"},dataType:"json"};w(a);var c=jQuery.ajax(a);c.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?v(function(){ja()}):e(s[0],"getStopwatchHourType-done,"+JSON.stringify(a.error));else if(0!==a.data.length){var c={};a.data.forEach(function(a,h){c[a.name]=a.ID});f.set("sw_hour_types",c)}});c.fail(function(c,k,e){x({response:c.responseText,
type:k,msg:e,status:c.status},ja,"getStopwatchHourType-fail"+k+"-"+e+" "+c.responseText+" "+c.status+" "+JSON.stringify(a))})}function aa(){n.show();var a={url:t("api/v9.0")+"uift/filtersForObjCode/",data:{enteredByID_Mod:"notnull",filterType:"STANDARD",fields:"name, definition, enteredByID",method:"get"},type:"GET",dataType:"json"};w(a);var c=jQuery.extend(!0,{},a);c.data.objCode="OPTASK";a.data.objCode="TASK";jQuery.when(jQuery.ajax(a),jQuery.ajax(c)).done(function(a,c){a=a[0];c=c[0];var b=void 0!=
a.error?a.error:c.error;void 0!=b?b["class"]==y[0]?v(function(){aa()}):e(s[0],"addCustomFilters,"+JSON.stringify(r.error)):(Da("task",Ia("task",a.data)),Da("opTask",Ia("opTask",c.data)),b=jQuery("#opTask-filters"),b.children().length&&b.show(),b=jQuery("#task-filters"),b.children().length&&b.show(),void 0==K[f.get("view")]&&T())}).fail(function(a,c,e){x({response:a.responseText,type:c,msg:e,status:a.status},aa,"addCustomFilters-fail"+c+"-"+e+" "+a.responseText+" "+a.status)})}function Ia(a,c){var h=
"task"==a?"task":"issue",e={},b=-1;c.sort(function(a,c){return a.name.localeCompare(c.name)});for(var d in c)if(c.hasOwnProperty(d)&&(b=c[d].name.indexOf(" - Stopwatch"),null!=c[d].enteredByID&&-1!=b)){var g={},p,l;for(l in c[d].definition)p=c[d].definition[l].replace(/&/g,"%26").replace("$$USER.ID",f.get("userID")),-1==p.indexOf("$$USER")&&(g[l]=p.split("\t"));e[c[d].ID]={q:jQuery.param(g).replace(RegExp("%5B%5D","g"),""),f:function(){return na(a,this.q)},t:c[d].name.substr(b),d:"Custom "+h+" filter: "+
Qa(g)}}return e}function Qa(a){var c="",h;for(h in a)a.hasOwnProperty(h)&&(c+=h+"="+a[h]+"\n");return c}function na(a,c){var h={};a=void 0==a?"task":a;h.fields="parent,extRefID,priority,project,project:hourTypes,project:status,plannedCompletionDate,permissions,canStart,status";"task"==a&&(h.fields+=",percentComplete");n.show();var k={url:t("api/v9.0")+a+"/search?"+c,type:"get",data:h,dataType:"json"};w(k);k=jQuery.ajax(k);k.done(function(c){void 0!=c.error?(c.error["class"]==y[0]?v(function(){na(a,
h)}):e(s[0],"addFilteredTasks,"+JSON.stringify(c.error)),n.hide(),q.hide()):(c=c.data,0==c.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){var a=c.length;A=!0;for(var h=0;h<a;h++){var e=-1!=["CPL","DED","REJ","CLS","RLV"].indexOf(c[h].status)?1:!1==c[h].canStart||-1==c[h].permissions.actions.indexOf("ADD_HOURS")&&-1==c[h].permissions.actions.indexOf("CHANGE_STATUS");TASK_DB.insert(c[h].name,{syncID:c[h].ID,details:c[h],disable:e},h==a-1)}}))});k.fail(function(a,c,e){x({response:a.responseText,
type:c,msg:e},na(c,h),"addFilteredTasks")})}function ma(){n.show();var a={url:t()+"HourType/search",type:"get",data:{fields:"ID,name,description",isActive:!0},dataType:"json"};w(a,35E3);var c=jQuery.ajax(a);c.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?v(function(){ma()}):e(s[0],"addAllGeneralTasks-done,"+JSON.stringify(a.error));else{a=a.data;var c=0,b;for(b in a)a.hasOwnProperty(b)&&("Task Time"!=a[b].name&&"Issue Time"!=a[b].name)&&(c++,TASK_DB.insert(a[b].name,{syncID:a[b].ID,details:{objCode:"GEN",
description:null!=a[b].description?"General - "+a[b].description:"'General"}},0));T()}});c.fail(function(c,e,b){x({response:c.responseText,type:e,msg:b,status:c.status},ma,"addAllGeneralTasks-fail"+e+"-"+b+" "+c.responseText+" "+c.status+" "+JSON.stringify(a))})}function x(a,c,h,b){if(401==a.status)v(function(){c()});else if("timeout"==a.type)c();else{if(void 0!=a.response&&""!=a.response){var m;m="object"===typeof a.response?a.response.message:JSON.stringify(a.response);TASK_CNTRL.displayError("Workfront Error: "+
m+"<br>"+(void 0!=b&&""!=b?b:""))}else TASK_CNTRL.displayError("Error: "+(void 0!=b&&""!=b?b:""));e(s[0],h+","+a.msg+" "+a.type+" "+JSON.stringify(a.response)+" "+b)}}function t(a){void 0==a&&(a="api/v7.0");return"https://"+f.get("host")+"."+f.get("domain")+"/attask/"+a+"/"}function R(a,c,h){a=void 0==a?"task":a;h=void 0==h?!1:h;n.show();var b={url:t()+"assgn/search?"+a+":statusEquatesWith=NEW&"+a+":statusEquatesWith=INP&"+a+":statusEquatesWith=ONH&"+a+":statusEquatesWith=AWF&"+a+":statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE",
type:"get",data:{},dataType:"json"};b.data[a+":canStart"]=!0;b.data[a+":statusEquatesWith_Mod"]="in";b.data["project:statusEquatesWith_Mod"]="in";b.data.fields=a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":plannedCompletionDate,"+a+":status, "+a+":extRefID,"+a+":permissions";b.data.status="DN";b.data.status_Mod="ne";b.data.assignedToID=f.get("userID");b.data.$$LIMIT=2E3;h&&(b.data["project:projectedCompletionDate"]="$$TODAYb-1w",b.data["project:projectedCompletionDate_Mod"]=
"gt");var m=f.get("currentRole");"role"==f.get("view")&&void 0!=m?b.data[a+":roleID"]=m.ID:b.data.assignedToID=f.get("userID");"task"==a&&(b.data.fields+=","+a+":percentComplete");w(b);b=jQuery.ajax(b);b.done(function(b){if(void 0!=b.error)b.error["class"]==y[0]?v(function(){R(a,c,h)}):e(s[0],"addAllAssignedTasks-"+a+","+JSON.stringify(b.error)),n.hide(),q.hide();else{b=b.data;var k=!0,m=f.get("view");"all"!=m&&"role"!=m&&(k=!1);var d=f.get("hour_types");if("opTask"!=a)R("opTask",c,h),D(function(){var a=
b.length;if(a)for(var c=0;c<a;c++){var h=b[c].task;if(-1!=h.permissions.actions.indexOf("ADD_HOURS")&&-1!=h.permissions.actions.indexOf("CHANGE_STATUS")){var e=!1,m=h.project.hourTypes.length;if(void 0!=d&&m)for(var f=0;f<m;f++){if(void 0!=d[h.project.hourTypes[f].ID]){e=!0;break}}else e=!0;e&&TASK_DB.insert(h.name,{syncID:h.ID,details:h},k&&c==a-1)}}});else{m=b.length;A=k;if(m)for(var g=0;g<m;g++){var p=b[g].opTask;if(-1!=p.permissions.actions.indexOf("ADD_HOURS")&&-1!=p.permissions.actions.indexOf("CHANGE_STATUS")){var l=
!1,u=p.project.hourTypes.length;if(void 0!=d&&u)for(var t=0;t<u;t++){if(void 0!=d[p.project.hourTypes[t].ID]){l=!0;break}}else l=!0;l&&TASK_DB.insert(p.name,{syncID:p.ID,details:p},k&&g==m-1)}}else TASK_CNTRL.showAll(b);c&&c(b)}}});b.fail(function(a,c,h){x({response:a.responseText,type:c,msg:h},function(a,c,h){R(a,c,h)},"addAllAssignedTasks-fail"+c+"-"+h+" "+a.responseText)})}function oa(a){n.show();var c={url:t("api/v7.0")+"user/search",type:"get",data:{fields:"role:*,roles:*",ID:f.get("userID")},
dataType:"json"};w(c);c=jQuery.ajax(c);c.done(function(c){if(void 0!=c.error)c.error["class"]==y[0]?v(function(){oa(a)}):e(s[0],"addAllRoleTasks,"+JSON.stringify(c.error)),n.hide(),q.hide();else if(c=c.data[0],0==c.length)a&&a(),n.hide(),q.hide();else{var b=jQuery("#role-filter"),m=function(){R("task",function(){jQuery("#active-filter").hide();b.css("display","inline-block");n.hide();q.hide()})},d=function(a,c){f.set("currentRole",{name:a,ID:c});b.find("button").html("<strong>Role: </strong><span>"+
a+'</span><span class="caret"></span>');m()},g=f.get("currentRole");void 0!=g?d(g.name,g.ID):void 0!=c.role&&d(c.role.name,c.role.ID);if(void 0!=c.roles&&0!=c.roles.length)for(var g=b.find(".dropdown-menu").html("").first(),p=0,l=c.roles.length;p<l;p++)g.append('<li><a href="#" id="'+c.roles[p].ID+'">'+c.roles[p].name+"</a></li>"),g.find("#"+c.roles[p].ID).click(function(){d(jQuery(this).text(),jQuery(this).attr("id"))});else Ea(),n.hide(),q.hide(),Ba(),TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Roles</h3></div><div class="content"><div><p>No additional roles available.</strong></h3><div><a href="#" class="btn btn-primary cancel" title="Ok">Ok</a><div>')}});
c.fail(function(a,c,b){x({response:a.responseText,type:c,msg:b},oa,"addAllRoleTasks")})}function Ea(){var a=jQuery("#role-filter");a.hide();a.find(".dropdown-menu").first().html("")}function pa(a){n.show();var c={url:t()+"team/search",type:"get",data:{fields:"ID","users:ID":f.get("userID")},dataType:"json"};w(c);c=jQuery.ajax(c);c.done(function(c){void 0!=c.error?(c.error["class"]==y[0]?v(function(){pa(a)}):e(s[0],"addAllGroupTasks,"+JSON.stringify(c.error)),n.hide(),q.hide()):(c=c.data,0==c.length?
(a?a():jQuery("#form-list").hide(),n.hide(),q.hide(),TASK_CNTRL.showNoTaskWindow()):D(function(){for(var b=c.length,e=function(c,h){if(0==--b){var e=H.length;A=!0;if(0==e)TASK_CNTRL.showAll(H);else{for(var m=0;m<e;m++)TASK_DB.insert(H[m].name,{syncID:H[m].ID,details:H[m]},m==e-1);H=[];a&&a()}}},f=0;f<b;f++)Y("task",c[f].ID,e)}))});c.fail(function(a,c,b){x({response:a.responseText,type:c,msg:b},pa,"addAllGroupTasks")})}function Y(a,c,h){a=void 0==a?"task":a;n.show();var b={url:t()+a+"/search?statusEquatesWith=NEW&statusEquatesWith=INP&statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE&project:statusEquatesWith=INF",
type:"get",data:{canStart:!0,statusEquatesWith_Mod:"in","project:statusEquatesWith_Mod":"in",fields:"permissions,extRefID,status,parent,priority,project,project:hourTypes,project:status,plannedCompletionDate",$$LIMIT:1E3,"team:ID":c},dataType:"json"};"task"==a&&(b.data.fields+=",percentComplete");w(b);b=jQuery.ajax(b);b.done(function(b){if(void 0!=b.error)b.error["class"]==y[0]?v(function(){Y(a,c,h)}):e(s[0],"addGroupTasks-"+a+","+JSON.stringify(b.error)),n.hide(),q.hide();else if(b=b.data,0==b.length)h&&
h(a,c);else if("opTask"!=a){Y("opTask",c,h);for(var k=b.length,f=0;f<k;f++)H.push(b[f])}else{k=b.length;for(f=0;f<k;f++)H.push(b[f]);h&&h(a,c)}});b.fail(function(a,c,h){x({response:a.responseText,type:c,msg:h},Y,"addGroupTasks-fail"+c+"-"+h+" "+a.responseText)})}function qa(){n.show();var a={url:t()+"hour/report",type:"get",data:{entryDate:"$$TODAY-14d",entryDate_Range:"$$TODAY",entryDate_Mod:"between","timesheet:userID":f.get("userID")},dataType:"json"};w(a);var c=jQuery.extend(!0,{},a);c.data["opTask:canStart"]=
!0;c.data.opTaskID_1_GroupBy=!0;a.data["task:canStart"]=!0;a.data.taskID_1_GroupBy=!0;jQuery.when(jQuery.ajax(a),jQuery.ajax(c)).done(function(a,c){a=a[0];c=c[0];var b=void 0!=a.error?a.error:c.error;if(void 0!=b)b["class"]==y[0]?v(function(){qa()}):e(s[0],"addRecentTasks,"+JSON.stringify(b)),n.hide(),q.hide();else{var f=Object.keys(c.data).concat(Object.keys(a.data));0==f.length?(A=!0,D(function(){TASK_CNTRL.showAll(f)})):D(function(){A=!0;TASK_CNTRL.showAll(TASK_CNTRL.taskDB.loadSyncIds(f))})}}).fail(function(a,
c,b){x({response:a.responseText,type:c,msg:b},qa,"addRecentTasks")})}function ra(){function a(a){var h={url:t()+"assgn/search?"+a+":statusEquatesWith=NEW&"+a+":statusEquatesWith=INP&"+a+":statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE",type:"get",data:{},dataType:"json"};h.data[a+":statusEquatesWith_Mod"]="in";h.data[a+":isComplete"]=!1;h.data.status="AD";h.data["project:statusEquatesWith_Mod"]="in";h.data["project:projectedCompletionDate"]="$$TODAYb-1w";h.data["project:projectedCompletionDate_Mod"]=
"gt";h.data.assignedToID=f.get("userID");h.data.fields=a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":status, "+a+":extRefID,"+a+":permissions,"+a+":plannedCompletionDate";"task"==a&&(h.data.fields+=",task:percentComplete");w(h);return h}n.show();jQuery.when(jQuery.ajax(a("task")),jQuery.ajax(a("opTask"))).done(function(a,h){a=a[0];h=h[0];var b=void 0!=a.error?a.error:h.error;void 0!=b?(b["class"]==y[0]?v(function(){ra()}):e(s[0],"addCurrentTasks,"+JSON.stringify(b)),
n.hide(),q.hide()):0==a.data.length&&0==h.data.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){function b(a,c){for(var h=a.length,e=0;e<h;e++){var k=a[e],k=k[c];TASK_DB.insert(k.name,{syncID:k.ID,details:k},e==h-1)}}A=!0;b(a.data,"task");b(h.data,"opTask")})}).fail(function(a,b,e){x({response:a.responseText,type:b,msg:e},function(){ra()},"addCurrentTasks")})}function sa(){function a(a){var b={url:t()+"assgn/search?"+a+":statusEquatesWith=NEW&"+a+":statusEquatesWith=INP&"+a+":statusEquatesWith=ROP&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE",
type:"get",data:{},dataType:"json"};b.data[a+":statusEquatesWith_Mod"]="in";b.data[a+":isComplete"]=!1;b.data[a+":canStart"]=!0;b.data.status="AA";b.data["project:statusEquatesWith_Mod"]="in";b.data["project:projectedCompletionDate"]="$$TODAYb-1w";b.data["project:projectedCompletionDate_Mod"]="gt";b.data.assignedToID=f.get("userID");b.data.fields=a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":status, "+a+":extRefID,"+a+":permissions,"+a+":plannedCompletionDate";
"task"==a&&(b.data.fields+=",task:percentComplete");w(b);return b}n.show();jQuery.when(jQuery.ajax(a("task")),jQuery.ajax(a("opTask"))).done(function(a,b){a=a[0];b=b[0];var k=void 0!=a.error?a.error:b.error;void 0!=k?(k["class"]==y[0]?v(function(){sa()}):e(s[0],"addRequestedTasks,"+JSON.stringify(k)),n.hide(),q.hide()):0==a.data.length&&0==b.data.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){function e(a,c){for(var b=a.length,h=0;h<b;h++){var k=a[h][c];TASK_DB.insert(k.name,{syncID:k.ID,
details:k},h==b-1)}}A=!0;e(a.data,"task");e(b.data,"opTask")})}).fail(function(a,b,e){x({response:a.responseText,type:b,msg:e},function(){sa()},"addRequestedTasks")})}function ta(){function a(a){var b={url:t()+"assgn/search?"+a+":statusEquatesWith=ONH&"+a+":statusEquatesWith=AWF&project:statusEquatesWith=CUR&project:statusEquatesWith=QUE&project:statusEquatesWith=ONH&project:statusEquatesWith=PLN",type:"get",data:{},dataType:"json"};b.data[a+":statusEquatesWith_Mod"]="in";b.data[a+":isComplete"]=
!1;b.data.status="AD";b.data["project:statusEquatesWith_Mod"]="in";b.data["project:projectedCompletionDate"]="$$TODAYb-1w";b.data["project:projectedCompletionDate_Mod"]="gt";b.data.assignedToID=f.get("userID");b.data.fields=a+":parent,"+a+":priority,"+a+":project, "+a+":project:hourTypes,"+a+":project:status,"+a+":status, "+a+":extRefID,"+a+":permissions,"+a+":plannedCompletionDate";"task"==a&&(b.data.fields+=",task:percentComplete");w(b);return b}n.show();jQuery.when(jQuery.ajax(a("task")),jQuery.ajax(a("opTask"))).done(function(a,
b){a=a[0];b=b[0];var k=void 0!=a.error?a.error:b.error;void 0!=k?(k["class"]==y[0]?v(function(){ta()}):e(s[0],"addOnHoldTasks,"+JSON.stringify(k)),n.hide(),q.hide()):0==a.data.length&&0==b.data.length?(A=!0,D(function(){TASK_CNTRL.showAll()})):D(function(){function e(a,c){for(var b=a.length,h=0;h<b;h++){var k=a[h],k=k[c];TASK_DB.insert(k.name,{syncID:k.ID,details:k},h==b-1)}}A=!0;e(a.data,"task");e(b.data,"opTask")})}).fail(function(a,b,e){x({response:a.responseText,type:b,msg:e},function(){ta()},
"addOnHoldTasks")})}function Ha(){var a={url:t()+"user/search",data:{"hourTypes:isActive":!0,fields:"hourTypes:ID,hourTypes:name,hourTypes:description,hourTypes:countAsRevenue",ID:f.get("userID")},type:"get",dataType:"json"};w(a);ua=!1;a=jQuery.ajax(a);a.done(function(a){if(void 0!=a.error)a.error["class"]==y[0]?v(function(){}):e(s[0],"getHourTypes,"+JSON.stringify(a.error)),n.hide(),q.hide();else if(a=a.data,void 0!=a&&0!=a.length&&0!=a[0].hourTypes.length){f.set("hour_type_list",a[0].hourTypes);
for(var b=[],k=0;k<a[0].hourTypes.length;k++)b[a[0].hourTypes[k].ID]=!0;f.set("hour_types",b);ua=!0}});a.fail(function(a,b,k){401==a.status?v(function(){}):"timeout"==b?Ha():e(s[0],"getHourTypes,"+a.responseText)})}function Ra(a,c){if("GEN"==a.details.objCode)c(a);else{var b=f.get("hour_type_list");if(b&&1==b.length)a.details.hourTypeID=b[0].ID,TASK_DB.updateDetails(a.ID,a.details),c(a);else if(void 0!=a.details.project.hourTypes&&1==a.details.project.hourTypes.length)a.details.hourTypeID=a.details.project.hourTypes[0].ID,
TASK_DB.updateDetails(a.ID,a.details),c(a);else{var e=jQuery("#hourTypeSelector");e.text("");b&&b.length&&jQuery.each(b,function(){var a=this.ID;e.append($("<option />").val(a).text(this.name))});a.details.project.hourTypes&&a.details.project.hourTypes.length&&jQuery.each(a.details.project.hourTypes,function(){e.append($("<option />").val(this.ID).text(this.name))});TASK_CNTRL.showWindow(null,"#hourTypeWindow");jQuery("#done_hourType").unbind("click").bind("click",function(b){b.preventDefault();a.details.hourTypeID=
jQuery("#hourTypeSelector").find(":selected").val();TASK_DB.updateDetails(a.ID,a.details);c(a);TASK_CNTRL.hideWindow("#hourTypeWindow")});jQuery("#cancel_hourType").unbind("click").bind("click",function(a){a.preventDefault();TASK_CNTRL.hideWindow("#hourTypeWindow")})}}}function da(a){var c=f.get("todaySched");null!=c?a(c):(c={url:t("api/v7.0")+"user/search?ID=$$USER.ID&fields=schedule:*,schedule:nonWorkDays:*",type:"get",data:{},dataType:"json"},w(c),c=jQuery.ajax(c),c.done(function(c){if(void 0!=
c.error)c.error["class"]==y[0]?v(function(){}):e(s[0],"getSchedule,"+JSON.stringify(c.error)),n.hide(),q.hide();else if(c=c.data[0].schedule,0!=c.length){var b=new Date,m=c["sunday monday tuesday wednesday thursday friday saturday".split(" ")[b.getDay()]],d;if(!0==c.hasNonWorkDays){for(var g=0;g<c.nonWorkDays.length;g++)if(c.nonWorkDays[g].nonWorkDate==b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()&&(void 0!=d&&null!=c.nonWorkDays[g].userID||void 0==d))d=c.nonWorkDays[g].scheduleDay;void 0!=
d&&(m=d)}void 0!=m&&0!=m.length&&(m={start:m[0],stop:m[1]},f.set("todaySched",m));a&&a(m)}}),c.fail(function(c,b,f){401==c.status?v(function(){}):"timeout"==b?da(a):e(s[0],"getSchedule,"+c.responseText)}))}function la(){var a=new Date,a={url:t()+"hour/report?hours_AggFunc=sum",type:"get",data:{entryDate:a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),ownerID:f.get("userID")},dataType:"json"};w(a);a=jQuery.ajax(a);a.done(function(a){void 0!=a.error?(a.error["class"]==y[0]?v(function(){}):e(s[0],
"getTodaysTotalHours,"+JSON.stringify(a.error)),n.hide(),q.hide()):(a=a.data,jQuery("#totalHours").html("Today's Hours: "+(null==a.sum_hours?"0":a.sum_hours.toFixed(2))))});a.fail(function(a,b,k){401==a.status?v(function(){}):"timeout"==b?la():e(s[0],"getTodaysTotalHours,"+a.responseText)})}function U(a){n.show();var c={assignedToID:f.get("userID")};"OPTASK"==a.details.objCode?c.opTaskID=a.syncID:c.taskID=a.syncID;c={url:t()+"assignment/search",type:"get",data:c,dataType:"json"};w(c);c=jQuery.ajax(c);
c.done(function(c){void 0!=c.error?(c.error["class"]==y[0]?v(function(){U(a)}):e(s[0],"getTaskAssignment,"+a.syncID+","+JSON.stringify(c.error)),n.hide(),q.hide()):(c=c.data[0],a.running?(a.done=1,TASK_CNTRL.stopTask(a)):va(c,a))});c.fail(function(c,b,e){x({response:c.responseText,type:b,msg:e},function(){U(a)},"getTaskAssignment,"+a.syncID)})}function va(a,c){n.show();var b={url:t()+"assignment/"+a.ID,data:{method:"PUT",status:"DN"},type:"get",dataType:"json"};w(b);b=jQuery.ajax(b);b.done(function(b){void 0!=
b.error?(b.error["class"]==y[0]?v(function(){va(a,c)}):e(s[0],"setAssignmentDone,"+a.ID+","+JSON.stringify(b.error)),n.hide(),q.hide()):(TASK_DB.remove(c.ID),n.hide(),q.hide(),e(s[2],F(c)+",assignment done"),e(s[1],"assignment done"),wa(c))});b.fail(function(b,e,h){x({response:b.responseText,type:e,msg:h},function(){va(a,c)},"setAssignmentDone,"+a.ID+", "+b.responseText)})}function wa(a){n.show();var c={url:t()+"assignment/count",data:{status:"DN",status_Mod:"ne"},type:"GET",dataType:"json"};"OPTASK"==
a.details.objCode?c.data.opTaskID=a.syncID:c.data.taskID=a.syncID;w(c);c=jQuery.ajax(c);c.done(function(c){void 0!=c.error?(c.error["class"]==y[0]?v(function(){wa(a)}):e(s[0],"getTaskDoneAssignmentCount,"+taskID+","+JSON.stringify(c.error)),n.hide(),q.hide()):(c=c.data,n.hide(),q.hide(),0==c.count&&Z(a))});c.fail(function(c,b,e){x({response:c.responseText,type:b,msg:e},function(){wa(a)},"getTaskDoneAssignmentCount,"+a.syncID)})}function Z(a){var c=a.syncID;n.show();var b="OPTASK"==a.details.objCode?
"CLS":"CPL",b={url:t()+a.details.objCode.toLowerCase()+"/"+c,data:{method:"put",status:b},type:"get",dataType:"json"};w(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?(b.error["class"]==y[0]?v(function(){Z(a)}):x({response:b.error,type:null,msg:null},function(){Z(a)},"setTaskDone,"+c),n.hide(),q.hide()):(n.hide(),q.hide(),e(s[2],F(a)+",task done"),e(s[1],"task done"))});b.fail(function(b,e,h){x({response:b.responseText,type:e,msg:h},function(){Z(a)},"setTaskDone,"+c+", "+b.responseText)})}
function P(a){n.show();var c={url:t()+a.details.objCode.toLowerCase()+"/"+a.syncID,data:{status:"INP",method:"PUT"},type:"get",dataType:"json"};w(c);c=jQuery.ajax(c);c.done(function(c){void 0!=c.error?(c.error["class"]==y[0]?v(function(){P(a)}):x({response:c.error,type:null,msg:null},function(){P(a)},"setTaskInProgress,"+a.syncID),n.hide(),q.hide()):(n.hide(),q.hide(),!0==f.get("logout_on_select")&&J())});c.fail(function(c,b,e){x({response:c.responseText,type:b,msg:e},function(){P(a)},"setTaskInProgress-fail,"+
a.syncID+", "+c.responseText)})}function W(a,c,b){n.show();b={url:t()+"note/",data:{auditType:"NO",ownerID:f.get("userID"),objID:a.syncID,noteObjCode:a.details.objCode,noteText:c.substring(0,2E3),auditText:"Stopwatch",isPrivate:b,method:"post"},type:"get",dataType:"json"};w(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error&&(b.error["class"]==y[0]?v(function(){W(a,c)}):x({response:b.error,type:null,msg:null},function(){W(a,c)},"setComment,"+a.syncID));n.hide();q.hide()});b.fail(function(b,e,
h){x({response:b.responseText,type:e,msg:h},function(){W(a,c)},"setComment-fail,"+a.syncID+", "+b.responseText)})}function V(a,c){n.show();var b={url:t()+a.details.objCode.toLowerCase()+"/"+a.syncID,data:{updates:"{ percentComplete: "+c+"}",method:"PUT"},type:"get",dataType:"json"};w(b);b=jQuery.ajax(b);b.done(function(b){void 0!=b.error?b.error["class"]==y[0]?v(function(){V(a,c)}):x({response:b.error,type:null,msg:null},function(){V(a,c)},"setTaskPercent,"+a.syncID):(a.details.percentComplete=c,
TASK_DB.updateDetails(a.ID,a.details));n.hide();q.hide()});b.fail(function(b,e,h){x({response:b.responseText,type:e,msg:h},function(){V(a,c)},"setTaskPercent-fail,"+a.syncID+", "+b.responseText)})}function Oa(a,c,b){var k,m={ownerID:f.get("userID")};void 0==c||-1!=c.permissions.actions.indexOf("ADD_HOURS")&&-1!=c.permissions.actions.indexOf("CHANGE_STATUS")?(k=0,m.method="post"):(k=c.hours,m.method="put",m.ID=c.ID);"GEN"==a.details.objCode?m.hourTypeID=a.syncID:("OPTASK"==a.details.objCode?m.opTaskID=
a.syncID:m.taskID=a.syncID,m.hourTypeID=f.get("forceHourTypeID"),void 0==m.hourTypeID&&(void 0!=a.details.hourTypeID&&""!=a.details.hourTypeID)&&(m.hourTypeID=a.details.hourTypeID));isNaN(k)&&(k=0);m.entryDate=a.dateStr;var d=Number((a.duration/3600).toFixed(2));f.get("nearestHour")&&(d=Math.round(d));m.hours=parseFloat((d+parseFloat((""+k).split(".").join("."))+" ").split(".").join(".")).toFixed(2);m.ownerID=f.get("userID");var g=new Date;b||(m.extRefID=("OK~"+g.getHours()+":"+g.getMinutes()+"H"+
m.hours+"D"+d+"T"+TASK_CNTRL.hms(a.time)+";"+(c&&c.extRefID?c.extRefID.replace("OK~","OK!"):".")).substring(0,254));e(s[1],"setHourAttask, oldhr: "+k+" method: "+m.method+" start: "+a.dateStr+" task: "+JSON.stringify(a)+" sid: "+f.get("sessionID")+" time: "+g.toTimeString());var p=function(){n.show();var c={url:t()+"hour/",type:"get",data:m,dataType:"json",async:!1};w(c);c=jQuery.ajax(c);c.done(function(c){void 0!=c.error?(c.error["class"]==y[0]?v(function(){p()}):x({response:c.error,type:null,msg:null},
p,"setHourAttask,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(m)+" "+F(a)+","+a.duration,'Time was not tracked, please click on "View" for task: '+a.name+" to record time manually."),n.hide(),q.hide()):(TASK_DB.setTask(a),TASK_CNTRL.toggleRunText(),la(),void 0!=m.taskID||void 0!=m.opTaskID?P(a):!0==f.get("logout_on_select")&&J(),n.hide(),q.hide(),e(s[2],F(a)),e(s[1],"time tracked newHr: "+m.hours+" "+a.duration+" oldHr: "+k),a.done&&U(a))});c.fail(function(c,b,e){x({response:c.responseText,
type:b,msg:e},p,"setHourAttask-fail,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(m)+" "+F(a)+","+a.duration+", "+c.responseText+", "+e,c.responseText+'<br>Time was not tracked, please click on "View" for task: '+a.name+" to record time manually.")})};p()}function La(a,c){X(a,function(a,b,e){c(a,b)},!1)}function Ma(a,c,b){var e={method:"put",ID:c,description:b.substring(0,2E3)};"GEN"==a.details.objCode?e.hourTypeID=a.syncID:"OPTASK"==a.details.objCode?e.opTaskID=a.syncID:e.taskID=a.syncID;
var f=function(){n.show();var c={url:t()+"hour/",type:"get",data:e,dataType:"json",async:!1};w(c);c=jQuery.ajax(c);c.done(function(c){n.hide();q.hide();void 0!=c.error&&(c.error["class"]==y[0]?v(function(){f()}):x({response:c.error,type:null,msg:null},f,"setHourNoteAttask,"+a.syncID+" "+a.name+" url: "+t()+" "+JSON.stringify(e)+" "+F(a)+","+a.duration,"Timesheet hour note was not recorded."))});c.fail(function(c,b,h){x({response:c.responseText,type:b,msg:h},f,"setHourNoteAttask-fail,"+a.syncID+" "+
a.name+" url: "+t()+" "+JSON.stringify(e)+" "+F(a)+","+a.duration+", "+c.responseText+", "+h,c.responseText+"<br>Timesheet hour note was not recorded.")})};f()}function X(a,c,b){var k=new Date,d={};d.entryDate=void 0!=a.dateStr?a.dateStr:k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();d.fields="permissions,ID,hours,extRefID,description";d.ownerID=f.get("userID");"GEN"==a.details.objCode?d.hourTypeID=a.syncID:("OPTASK"==a.details.objCode?d.opTaskID=a.syncID:d.taskID=a.syncID,void 0!=a.details.hourTypeID&&
""!=a.details.hourTypeID&&(d.hourTypeID=a.details.hourTypeID));k={url:t()+"hour/search",type:"get",data:d,dataType:"json",async:!1};w(k);k=jQuery.ajax(k);k.done(function(f){if(void 0!=f.error)f.error["class"]==y[0]?v(function(){X(a,c,b)}):e(s[0],"getHour,"+a.syncID+","+JSON.stringify(f.error)),n.hide(),q.hide();else if(e(s[1],"getHour "+f.data.length+" "+JSON.stringify(f.data)),c){for(var k=f.data.length,d=0;d<k;d++)if(-1!=f.data[d].permissions.actions.indexOf("ADD_HOURS")&&-1!=f.data[d].permissions.actions.indexOf("CHANGE_STATUS")){c(a,
f.data[d],b);return}c(a,f.data[0],b)}});k.fail(function(c,b,h){e(s[0],"getHour,"+a.syncID+","+JSON.stringify(h))})}var y=["com.attask.common.AuthenticationException"],s=["error","debug","informational"],f,I=!(window.hasOwnProperty("chrome")&&window.chrome.hasOwnProperty("windows")),E=isMobile(),ca="www.atappstore.com",xa="secure.atappstore.com",Fa=-1!==document.URL.indexOf("dashboard.directory")||-1!==document.URL.indexOf(ca)||-1!==document.URL.indexOf(xa),ua=!1,L=!1,Pa="Force Desktop Stopwatch Access",
ya=300,H=[],C=[],za,Aa,K={current:{f:ra,t:"Current",d:"Tasks and issues you're working on"},recent:{f:qa,t:"Recent",d:"All tasks and issues tracked within 14 days"},requested:{f:sa,t:"Requested",d:"Tasks and issues you can start on"},onhold:{f:ta,t:"On Hold",d:"Tasks and issues that are on hold"},all:{f:R,t:"All Assigned",d:"All tasks and issues assigned to you"},team:{f:pa,t:"Team Assigned",d:"All tasks and issues assigned to your Teams"},role:{f:oa,t:"Role Assigned",d:"All tasks and issues available to your Roles"}};
I&&(!Fa&&-1==location.origin.indexOf("localhost"))&&(location="https://"+ca+"/client/enterprise-stopwatch/launch.html");z();f=I?{settings:[],set:function(a,c){switch(a){case "domain":case "host":case "userID":case "sessionID":case "username":case "date":case "view":case "current_sort":case "launched":case "ent":"object"===typeof c&&(c=JSON.stringify(c)),this.setCookie(a,c,9999999999)}this.settings[a]=c},get:function(a){switch(a){case "domain":case "host":case "userID":case "sessionID":case "username":case "date":case "view":case "current_sort":case "launched":case "ent":var c=
void 0===this.settings[a]?this.getCookie(a):this.settings[a];this.settings[a]=c;return"undefined"==c||void 0==c?void 0:c;default:return!this.settings.hasOwnProperty(a)||"undefined"==this.settings[a]||void 0==this.settings[a]?void 0:this.settings[a]}},removeAll:function(){var a=new Date,c;for(c in this.settings)this.settings.hasOwnProperty(c)&&(document.cookie=c+"="+this.settings[c]+";expires="+a.toGMTString()+";;");this.settings=[]},setCookie:function(a,c,b){var e=new Date;e.setHours(0);e.setMinutes(0);
e.setSeconds(0);e.setDate(e.getDate()+b);c=encodeURI(c)+(null==b?"":"; expires="+e.toUTCString());document.cookie=a+"="+c},getCookie:function(a){var c,b,e,f=document.cookie.split(";");for(c=0;c<f.length;c++)if(b=f[c].substr(0,f[c].indexOf("=")),e=f[c].substr(f[c].indexOf("=")+1),b=b.replace(/^\s+|\s+$/g,""),b==a)return decodeURI(e);return"undefined"}}:new Store("Attask");f.set("launched",(new Date).getTime());window.addEventListener("offline",function(a){jQuery("#refresh").hide();jQuery(".done").hide();
jQuery(".percent").hide();jQuery(".btn-comment").hide();jQuery(".view").hide();L=!0});window.addEventListener("online",function(a){jQuery("#refresh").show();jQuery(".done").show();jQuery(".percent").show();jQuery(".btn-comment").show();jQuery(".view").show();a=f.get("offlineTasks");if(void 0!=a)for(var c=a.length,b=0;b<c;b++)M(a[b],a[b].duration);f.set("offlineTasks",[]);L=!1});var O;OB.init.add(function(){void 0==f.get("qr")&&f.set("qr","true"==getQueryString("qr")||getQueryString("code"));Ka();
jQuery(document).on("click",".logout",function(){J()});u();var a=getQueryString("s"),c=getQueryString("d");if(c&&(a&&f.set("sessionID",a),a=c.split("."),f.set("host",a[0]),a.shift(),f.set("domain",a.join(".")),a=getQueryString("u"),c=f.get("userID"),void 0==c||a&&c&&a!=c)){f.set("sessionID","");f.set("username","");f.set("password","");f.set("userID",a);f.set("ent",void 0!=f.get("userID"));ea();return}N();!0==f.get("qr")&&void 0==f.get("sessionID")&&(getQueryString("code")?(document.getElementById("button-appscan").style.display=
"block",qrRead(getQueryString("code"),f)):qrLoad(f))});OB.onBeforeUnLoad.add(function(a){var c=TASK_CNTRL.getDuration(a);M(a,c.duration,!1)});OB.onUnLoad.add(function(){TASK_DB.running(function(a){f.get("stopOnClose")&&TASK_CNTRL.stopTask(a)})});OB.onLoad.add(function(){document.addEventListener("resume",function(){jQuery("#loading").show();N()||u()},!1);document.addEventListener("pause",function(){jQuery("#form-list").html("")},!1);document.addEventListener("menubutton",function(){TASK_CNTRL.showWindow('<div style="text-align: center; font-weight: bold;"><h3>Welcome</h3></div><div class="content"><p>If you have any questions please visit <a href="http://store.atappstore.com/index.php/portfolio/stopwatch/" target="_blank" class="btn" >store.atappstore.com</a></p><a href="#" class="btn btn-primary cancel" title="Done">Done</a></div>')},
!1)});OB.displayInterval.add(function(a,c){p(a,c)&&(window.clearInterval(TASK_CNTRL.display_intervals[a.ID]),TASK_CNTRL.IS_EXTENSION||window.clearInterval(TASK_CNTRL.update_intervals[a.ID]),TASK_CNTRL.toggleRunText())});OB.updateAtInterval.add(function(a,c){f.get("updateAtInterval")&&(0==c?n.hide():(n.show(),M(a,c,!0),a.start=new Date,TASK_DB.setTask(a)))});OB.stop.add(function(a,c){n.show();var b,k;b=new Date(a.start);k=new Date;e(s[1],"stop: "+b+" == "+k+" dur:"+c+" totalDuration:"+a.time);if(f.get("minuteBufferSnapToSched")){var d=
f.get("todaySched"),g=f.get("minuteBuffer"),p=k.toLocaleDateString("en-US"),l=Date.parse(p+d.start),d=Date.parse(p+d.stop),p=new Date(l);b<l&&b>p.setMinutes(p.getMinutes()-g)&&(b=new Date(l));p=new Date(d);k>d&&k<p.setMinutes(p.getMinutes()+g)&&(k=new Date(d));if(b>=k){n.hide();return}c=Math.floor((k.getTime()-b.getTime())/1E3);e(s[1],"minuteBufferSnapToSched: "+b+" == "+k+" dur:"+c)}0==c||0==Number((c/3600).toFixed(2))?(n.hide(),TASK_DB.setTask(a)):M(a,c,!1)});OB.update.add(function(a,c){q.show();
M(a,c,!1)});OB.start.add(function(a){ka(a)});OB.preStart.add(function(a){a.running?TASK_CNTRL.toggleTimer(a):navigator.onLine&&!a.disable&&(p(a,a.time)||function(){TASK_DB.loadAll(function(c){var b,e,d=!1,g=c.length;for(b=0;b<g;b++)if(e=c[b],null!=e&&e.running&&a.ID!=e.ID){TASK_CNTRL.toggleTimer(e);d=!0;break}ua||a.details.project.hourTypes.length?Ra(a,function(a){TASK_CNTRL.toggleTimer(a)}):(TASK_CNTRL.toggleTimer(a),!d&&!0==f.get("logout_on_select")&&J())})}())});OB.postAllItemRender.add(function(){jQuery(".remove").css("display",
"none");jQuery(".update").css("display","none");jQuery(".reset").css("display","none");f.get("is_auth")?jQuery("#storelink").text("AtAppStore"):(jQuery("#sort-date").remove(),jQuery(".timer").remove(),jQuery(".done").remove(),jQuery(".percent").remove(),jQuery(".btn-comment").remove(),jQuery(".date").removeClass("date").addClass("date-tall").html('<a href="http://store.atappstore.com/index.php/portfolio/stopwatch/" target="_blank">Trial Expired</a>'),jQuery("#storelink").text("Trial Expired - AtAppStore"));
f.get("hideTaskButtons")&&(jQuery(".timer").addClass("timer-tall"),jQuery(".done").remove(),jQuery(".percent").remove(),jQuery(".task").remove(),jQuery(".view").remove(),jQuery(".date").remove(),jQuery(".btn-comment").remove(),jQuery("#sort-date").remove());f.get("ent")&&jQuery("#totalHours").attr("title","").attr("data-hasqtip",!1).unbind("click").addClass("disabled");if(A){var a=jQuery("#form-list"),c=f.get("vpos");void 0!=c&&a.scrollTop(c);"team"==f.get("view")&&!0==f.get("hide_team_done")&&jQuery(".done").remove();
L?f.get("allowOffline")&&(jQuery(".done").remove(),jQuery(".percent").remove(),jQuery(".view").remove(),jQuery("#bar").hide()):jQuery("#bar").show();c=f.get("current_sort");void 0!=c?("string"===typeof c&&(c=JSON.parse(c)),C[c.sort]=c.order,c=c.sort):(c=f.get("sort"),void 0==c&&(c="date"));jQuery("#sort-"+c).click();jQuery("#search-bar").is(":visible")&&jQuery("#search").click();jQuery("#loading").hide();a.show();a=jQuery("#holder")[0];a.style.display="none";a.style.display="block";n.hide();A=!1}});
OB.postItemRender.add(function(a){var c=jQuery("#item"+a.ID),b=c.find(".details");if(0==c.find("#buttons .view").length){var e=c.find("#buttons"),d=["",{label:"Low",css:"default"},{label:"Normal",css:"success"},{label:"High",css:"warning"},{label:"Urgent",css:"danger"}];"GEN"!=a.details.objCode&&(void 0!=a.details.priority&&0!=a.details.priority)&&(d=d[a.details.priority],e.append('<span class="task priority '+d.css+'" title="'+d.label+'" data-priority="'+a.details.priority+'">'+d.label[0]+"</span> "));
var g;"GEN"==a.details.objCode?(g="General",c.attr("data-type",g),c.attr("data-force-order",0),e.attr("class","days priority"),c.attr("class","item general")):"OPTASK"==a.details.objCode?(g="Issue",c.attr("data-type",g),c.attr("data-force-order",1),e.append('<span class="issue" title="Issue">I</span> ')):"TASK"==a.details.objCode&&(g="Task",c.attr("data-type",g),c.attr("data-force-order",1),e.append('<span class="task" title="Task">T</span> '));void 0!=a.details.status&&(b.attr("data-status",a.details.status),
e.append('<span class="status" title="'+g+" status: "+a.details.status+"<br>Project status: "+a.details.project.status+'">'+a.details.status+"</span> "));"General"!=g&&(e.append('<a href="https://'+f.get("host")+"."+f.get("domain")+"/"+g.toLowerCase()+"/view?ID="+a.syncID+'" target="_blank" class="btn btn-mini view" rel="'+a.ID+'" title="View '+g+'"><i class="fas fa-tasks"></i></a> '),a.disable?void 0!=a.details.status&&(c.find(".timer").text("status: "+a.details.status).unbind("click").addClass("disabled"),
c.find(".timer-info").text("status: "+a.details.status)):e.append('<a href="#" class="btn btn-mini done" rel="'+a.ID+'" title="Done '+g+'"><i class="fas fa-check"></i></a> '));"General"!=g&&e.append('<a href="#" class="btn btn-mini btn-comment" rel="'+a.ID+'" title="Add Comment"><i class="fas fa-comment-dots"></i></a> ');!a.disable&&("Task"==g&&void 0!=a.details.percentComplete)&&e.append('<a href="#" class="btn btn-mini percent" rel="'+a.ID+'" title="Percent Completed">'+a.details.percentComplete+
"%</a> ");e='<span class="date" style="background-color: #EEE;"></span>';if(!a.disable&&"General"!=g&&void 0!=a.details.plannedCompletionDate)if(d=a.details.plannedCompletionDate.replace(/:\d\d\d/,"").replace(/-/g,"/").replace(/[a-z]+/gi," ").replace(/\/(\d\d\d\d)/,"-$1"),d=new Date(Date.parse(d)),isNaN(d.getTime()))b.attr("data-days",9999);else{var p=new Date;p.setHours(0);p.setMinutes(0);p.setSeconds(0);e="#D2E0FF";p=Math.round((d.getTime()-p.getTime())/1E3/60/60/24);0>p?e="#FFCDCD":1>=p&&(e="#FFD7AB");
var l;l=0<p?"days due: "+p:"days late: "+Math.abs(p);e='<div class="date" style="background-color: '+e+';"><div class="days">'+l+"</div><div>"+fa(d.getMonth())+" "+d.getDate()+", "+d.getFullYear()+"</div></div>";b.attr("data-days",p)}else b.attr("data-days",9999);d="";null!=a.details.parent&&(d="<br><br>Parent Task: <br>"+a.details.parent.name);p="";a.details.extRefID&&(p="Reference: <br>"+a.details.extRefID);c.find(".name").attr("title",g+": <br>"+a.name+p+d);"General"!=g?(g=a.details.project.name,
b.html(g).attr("title","Project: <br>"+g+"<br>Status: "+a.details.project.status).attr("data-priority",a.details.priority),b="",a.disable||(b='<span class="hour-note" rel="'+a.ID+'">Add Note</span>'),c.find(".c6").after('<div class="task-lower-block">'+e+b+"</div>")):(b.html(a.details.description).attr("title",a.details.description),c.find(".c6").after('<div class="general-lower-block"><span class="hour-note" style="display:block;" rel="'+a.ID+'">Add Note</span></div>'));E||c.find(".task-lower-block").mouseover(function(){var a=
jQuery(this).find(".hour-note"),c=a.attr("rel");jQuery("#item"+c);if((c=TASK_DB.get(c))&&c.time&&!c.running&&!c.disable){var b=jQuery(this).find(".date").hide(),e=a.show();setTimeout(function(){b.show();e.hide()},3E3)}}).mouseout(function(){jQuery(this).find(".date").show();jQuery(this).find(".hour-note").hide()})}});OB.remove.add(function(a){jQuery("#item"+a).remove()});OB.reset.add(function(a,c){OB.update.dispatch(c,-c.time);jQuery("#item"+a+" .timer").text(TASK_CNTRL.hms(0))});var A=!1,q,n}();var QUERY_LOOKUP=null;function getQueryString(b){if(null==QUERY_LOOKUP){var d=location.search.substring(1),g=/([^&=]+)=([^&]*)/g,l;for(QUERY_LOOKUP={};l=g.exec(d);)QUERY_LOOKUP[decodeURIComponent(l[1])]=decodeURIComponent(l[2])}return b in QUERY_LOOKUP?QUERY_LOOKUP[b]:null}
function isMobile(){var b=!1,d=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,
4)))b=!0;return b}
function taskController(b){var d,g=window.hasOwnProperty("chrome")&&window.chrome.hasOwnProperty("windows"),l=!g&&isMobile();OB.start.add(function(b){startNotify(b)});OB.stop.add(function(b,d,g){stopNotify(b)});OB.onLoad.add(function(){});OB.postAllItemRender.add(function(){l&&(jQuery("#form-list").height(0),d=124);if(!g||"full"==getQueryString("view")){var b=function(){var b=jQuery("#form-list"),e;e=b.height();e+=window.innerHeight-d;0!=window.innerHeight-d&&b.height(e);d=window.innerHeight};jQuery(window).unbind("resize");
jQuery(window).bind("resize",b);b()}var u=!1,b={style:{tip:{corner:!0,width:5,height:5},def:!1,classes:"qtip-info"},position:{adjust:{method:"flip flip"},at:"bottom left",my:"top left",viewport:jQuery(window)},show:{},events:{show:function(b,e){u=!0}},hide:{delay:l?0:100}};jQuery("span[title]").qtip(b);jQuery("#form-list").bind("scroll",function(){u&&(jQuery("span[title]").qtip("hide"),u=!1)});l||(jQuery("a[title]").qtip(b),jQuery("#form-list").bind("scroll",function(){u&&(jQuery("a[title]").qtip("hide"),
u=!1)}));b.content="time < 30 seconds<br> time was not tracked";b.show.event=!1;var p=jQuery(".timer");p.qtip(b);l||p.mouseover(function(){var b=jQuery(this).find(".time").hide(),e=jQuery(this).find(".timer-info").show();setTimeout(function(){b.show();e.hide()},3E3)}).mouseout(function(){jQuery(this).find(".time").show();jQuery(this).find(".timer-info").hide()});l&&(jQuery(".item").css("padding-right","5px"),jQuery(".task").css("padding-right","5px").css("padding-left","5px"),jQuery(".issue").css("padding-right",
"5px").css("padding-left","5px"),jQuery("body").css("font-size","12px"));jQuery("#searchfor").domsearch("#form-list",{unit:"div.item:visible",criteria:["span[oldtitle]"]})});return{display_intervals:[],update_intervals:[],taskDB:b,init:function(){this.bind();this.toggleRunText();var b=jQuery("#form-list");!g||"full"==getQueryString("view")?b.addClass("full"):b.css("max-height","439px");!g&&(window.webkitNotifications&&0!=window.webkitNotifications.checkPermission())&&window.open("core/js/permission.html",
"Permission","height=540,width=447");d=567},bind:function(){if(l)jQuery(document).on("click","a[target='_blank']",function(b){b.preventDefault();window.open(jQuery(this).attr("href"),"_blank","location=yes");return!1});jQuery("#cover").hide();jQuery(document).on("click",".cancel",function(d){d.preventDefault();jQuery("#"+jQuery(this).attr("rel")).hide().hide().find("input:text").val("");jQuery("#form-list").show();jQuery("#top-bar").show();jQuery("#bar").show();b.hideWindow()});jQuery(document).on("click",
"#search",function(b){b.preventDefault();jQuery("#sort-bar").toggle();jQuery("#search-bar").toggle();jQuery("#searchfor").focus().val("").domsearchClear()});jQuery(document).on("click","#popout",function(b){b.preventDefault();g&&window.chrome.windows.create({url:"index.html?view=full",type:"popup",width:450,height:600})});jQuery(document).on("click","#create",function(b){b.preventDefault();jQuery(".form").hide();jQuery("#form-create").slideDown().find("input[name='task-name']").focus()});var b=this;
jQuery(document).on("click","#button-create",function(){var d=jQuery("#form-create");b.taskDB.insert(d.find(":input[name='task-name']").val());d.hide().find("input:text").val("")});jQuery("#task-name").keydown(function(d){13==d.keyCode&&(d=jQuery("#form-create"),b.taskDB.insert(d.find(":input[name='task-name']").val()),d.hide().find("input:text").val(""))});jQuery(document).on("click",".remove",function(b){b.preventDefault();jQuery(".form").hide();jQuery("#button-remove").attr("rel",jQuery(this).attr("rel"));
jQuery("#remove-confirm").html("Are you sure? You want to <strong>delete "+jQuery(this).attr("title")+"</strong>?");jQuery("#form-remove").show()});jQuery(document).on("click","#button-remove",function(){jQuery("#form-remove").hide();b.taskDB.remove(jQuery(this).attr("rel"))});jQuery(document).on("click","#remove-all",function(b){b.preventDefault();jQuery(".form").hide();jQuery("#form-remove-all").slideDown()});jQuery(document).on("click","#button-remove-all",function(){jQuery("#form-remove-all").hide();
b.taskDB.removeall()});jQuery(document).on("click",".update",function(b){b.preventDefault();jQuery(".form").hide();jQuery("#top-bar").hide();jQuery("#bar").hide();this.taskDB.updateValidate(jQuery(this).attr("rel"),this.update)});jQuery(document).on("click","#button-update",function(){var d=jQuery("#form-update");d.hide();jQuery("#top-bar").show();jQuery("#bar").show();b.taskDB.update(d.find(":input[name='task-id']").val(),d.find(":input[name='task-name']").val(),d.find(":input[name='task-time']").val())});
jQuery(document).on("click",".reset",function(d){d.preventDefault();d=jQuery(this).attr("rel");b.taskDB.reset(d)});var d=function(d){d.preventDefault();b.taskDB.updateValidate(jQuery(this).attr("rel"),function(b){OB.preStart.dispatch(b)});return!1};jQuery(document).on("click",".timer",d);jQuery("#running").click(d);jQuery("#holder").show()},isMobile:l,displayError:function(b){this.showWindow('<h3><div style="text-align: center; font-weight: bold;">Error</div></h3><div class="content"><p>'+b+'</p><a href="#" id="cancel_confirm" class="btn btn-primary" title="Done">Done</a></div>')},
showWindow:function(b,d){var g=jQuery("#cover");d=void 0==d?"#window":d;null!=b&&jQuery(d).html(b);l?(g.css("height","100%").css("opacity","0.8").show(),jQuery(d).animate({top:60+window.pageYOffset+"px"},{easing:"easeInCubic",duration:400,complete:function(){}})):g.css("height","100%").show().animate({opacity:"0.8"},400,function(){jQuery(d).animate({top:60+window.pageYOffset+"px"},{easing:"easeInCubic",duration:400,complete:function(){}})})},hideWindow:function(b){var d=jQuery("#cover");b=void 0==
b?"#window":b;l?jQuery(b).animate({top:"-700px"},{easing:"easeOutCubic",duration:400,complete:function(){d.hide()}}):jQuery(b).animate({top:"-700px"},{easing:"easeOutCubic",duration:400,complete:function(){d.animate({opacity:"0"},{duration:400,complete:function(){d.hide()}})}})},update:function(b){var d=jQuery("#form-update");d.find(":input[name='task-id']").val(b.ID);d.find(":input[name='task-name']").val(b.name);d.find(":input[name='task-time']").val(this.hms(b.time));d.slideDown()},truncateString:function(b){return b},
showTask:function(b){var d,g="";d=jQuery("#item"+b.ID);0!=d.length?d.show():(g+='<div class="item'+(b.running?" running":"")+'" id="item'+b.ID+'" rel="'+b.ID+'">',g=g+'<div class="c3">'+('<span class="name c1" title="Task: <br>'+b.name+'" ><strong>'+this.truncateString(b.name)+"</strong></span><br>"),g+='<span class="details" title="'+b.details+'" >'+this.truncateString(b.details)+"</span><br>",g+='<span id="buttons"><a href="#" class="btn btn-mini update" rel="'+b.ID+'" title="Edit: '+b.name+'">Edit</a> ',
g+='<a href="#" class="btn btn-mini reset" rel="'+b.ID+'" title="Reset: '+b.name+'">Reset</a> ',g+='<a href="#" class="btn btn-mini remove" rel="'+b.ID+'" title="Delete: '+b.name+'">Delete</a></span>',g+="</div>",g+='<div class="c8"><div class="c6">',b.running?(d=new Date(b.start),d=Number(b.time)+Math.floor(((new Date).getTime()-d.getTime())/1E3),g+='<a href="#" class="btn timer btn-primary" rel="'+b.ID+'"><span class="time">'+this.hms(d)+"</span>"):g+='<a href="#" class="btn timer '+(b.disable?
"disabled":"")+'" rel="'+b.ID+'"><span class="time">'+this.hms(b.time)+"</span>",g+='<span class="timer-info" style="display: none;">'+(b.running?"Stop":b.disable?"Max Reached":"Start")+"</span></a>",g+="</div>",g+="</div></div>",b.running&&(this.startTask(b),this.toggleRunText()),jQuery("#form-list").append(g),OB.postItemRender.dispatch(b))},showAll:function(b){if(void 0!=b){var d,g=b.length;if(0!=g)for(d=0;d<g;d++)this.showTask(b[d])}0==jQuery(".item").length&&this.showNoTaskWindow();OB.postAllItemRender.dispatch()},
showNoTaskWindow:function(){jQuery("#form-list").css("height","439px");this.showWindow('<h3><div style="text-align: center; font-weight: bold;">No Tasks</div></h3><div class="content"><p>Please assign a task to yourself.</p><a href="#" id="cancel_confirm" class="btn btn-primary cancel" title="Done">Done</a></div>')},toggleTimer:function(b){jQuery("#item"+b.ID+" .timer").toggleClass("btn-primary");b.running?this.stopTask(b):this.startTask(b);this.toggleRunText()},startTask:function(b){if(navigator.onLine){var d=
this,l=jQuery("#item"+b.ID),z=new Date;l.find(".timer .timer-info").text("Stop");window.clearInterval(d.display_intervals[b.ID]);g||window.clearInterval(d.update_intervals[b.ID]);b.running?z=new Date(b.start):this.taskDB.start(b.ID,z);d.display_intervals[b.ID]=window.setInterval(function(){var g=Number(b.time)+Math.floor(((new Date).getTime()-z.getTime())/1E3);jQuery("#item"+b.ID).find(".timer .time").text(d.hms(g));OB.displayInterval.dispatch(b,g)},500);g||(d.update_intervals[b.ID]=window.setInterval(function(){navigator.onLine&&
d.taskDB.updateAtInterval(b.ID,Number(b.time)+Math.floor(((new Date).getTime()-z.getTime())/1E3),300)},3E5))}},stopTask:function(b){var d=jQuery("#item"+b.ID),l=this.getDuration(b),z=Number(b.time),d=d.find(".timer"),z=b.interval?l:z+l;window.clearInterval(this.display_intervals[b.ID]);g||window.clearInterval(this.update_intervals[b.ID]);this.taskDB.stop(b.ID,z,l,b.done);0==l&&d.qtip("show");d.find(".time").text(this.hms(z));d.find(".timer-info").text("Start")},getDuration:function(b){b=new Date(b.start);
b=Math.floor(((new Date).getTime()-b.getTime())/1E3);30>b?b=0:60>b&&29<b&&(b=60);return b},toggleRunText:function(){var b=jQuery("#running"),d=jQuery("#storelink");this.taskDB.running(function(l){g?window.chrome.browserAction.setBadgeText({text:"RUN"}):document.title="Stopwatch - Running: "+l.name;b.text("Running: "+l.name).attr("rel",l.ID).show();d.hide()},function(l){0==l&&(g?window.chrome.browserAction.setBadgeText({text:""}):document.title="Stopwatch",b.hide(),d.show())})},hms:function(b){b=[0,
0,b];var d;for(d=2;0<d;d--)b[d-1]=Math.floor(b[d]/60),b[d]%=60,10>b[d]&&(b[d]="0"+b[d]);return b.join(":")},sec:function(b){b=String(b).split(":");return Number(parseFloat(3600*b[0])+60*parseFloat(b[1])+parseFloat(b[2]))}}};function taskDB(){return{dm:[],log:[],lastId:0,sql:function(b,d,g,l,e,u){},init:function(){this.createDB();return this},setEvent:function(b,d){var g=this.log;20==g.length&&g.shift();g.push({type:b,message:d,time:(new Date).getTime()});this.log=g},getEvents:function(){return this.log},onError:function(b){},createDB:function(){this.dm=[];this.lastId=0},dropTaskTable:function(){this.createDB()},get:function(b){return this.dm[b]},start:function(b,d){this.dm[b].running=1;this.dm[b].start=d;OB.start.dispatch(this.dm[b])},
updateAtInterval:function(b,d,g){this.dm[b].running=1;this.dm[b].time=Number(d);this.dm[b].interval=1;OB.updateAtInterval.dispatch(this.dm[b],Number(g))},stop:function(b,d,g,l){b=this.dm[b];b.running=0;b.interval=0;b.done=l;b.time=Number(d);OB.stop.dispatch(b,Number(g))},setTask:function(b){this.dm[b.ID]=b},running:function(b,d){for(var g in this.dm)if(null!=this.dm[g]&&this.dm[g].running)return b(this.dm[g]),!0;d();return!1},insert:function(b,d,g){var l="null",e="",u=0;void 0!=d&&(void 0!=d.syncID&&
(l=d.syncID),void 0!=d.details&&(e=d.details),void 0!=d.disable&&(u=d.disable));if("null"!=l){d=!1;for(var p in this.dm)if(null!=this.dm[p]&&this.dm[p].syncID==l){d=!0;break}d||(p=this.nextID(),this.dm[p]={ID:p,syncID:l,name:b,details:e,time:0,start:new Date,running:0,done:0,disable:u,interval:!1},OB.insert.dispatch(b,{syncID:l,details:e}));TASK_CNTRL.showTask(this.dm[p]);g&&OB.postAllItemRender.dispatch()}},nextID:function(){return this.lastId++},updateValidate:function(b,d){null!=this.dm[b]&&d(this.dm[b])},
update:function(b,d,g){g=TASK_CNTRL.sec(g);var l;null!=this.dm[b]&&(this.dm[b].name=d,l=this.dm[b].time,this.dm[b].time=g);OB.update.dispatch(this.dm[b],g-l)},updateDetails:function(b,d){null!=this.dm[b]&&(this.dm[b].details=d)},remove:function(b){this.dm[b]=null;void 0!=TASK_CNTRL.update_intervals[b]&&window.clearInterval(TASK_CNTRL.update_intervals[b]);void 0!=TASK_CNTRL.display_intervals[b]&&window.clearInterval(TASK_CNTRL.display_intervals[b]);OB.remove.dispatch(b)},removeall:function(){this.createDB();
for(var b in TASK_CNTRL.update_intervals)window.clearInterval(TASK_CNTRL.update_intervals[b]);for(b in TASK_CNTRL.display_intervals)window.clearInterval(TASK_CNTRL.display_intervals[b]);OB.removeall.dispatch()},reset:function(b){null!=this.dm[b]&&(OB.reset.dispatch(b,this.dm[b]),this.dm[b].time=0)},loadAll:function(b){b(this.dm)}}.init()};function taskDBls(){return{ls:null,ps:null,log:null,userId:null,sql:function(b,d,g,l,e,u){},init:function(){this.ps=new Store("AttaskPersistModel");this.log=new Store("StopwatchLog");null==this.log.get("trace")&&this.log.set("trace",[]);this.ls=new Store("AttaskModel");null==this.ls.get("list")&&this.createDB();return this},setEvent:function(b,d){var g=this.log.get("trace");20==g.length&&g.shift();g.push({type:b,message:d,time:(new Date).getTime()});this.log.set("trace",g)},getEvents:function(){return this.log.get("trace")},
onError:function(b){},createDB:function(){this.ls.set("lastId",0);this.ls.set("list",[])},dropTaskTable:function(){this.ls.removeAll()},userRunningTasks:function(b){return this.ps.get(b+""+this.ps.get(b))},start:function(b,d){var g=this.ls.get(b);null!=g&&void 0!=g&&(g.running=1,g.start=d,this.ls.set(b,g),null!=this.userId&&(this.ps.set(this.userId+""+g.syncID,g),this.ps.set(this.userId,g.syncID)),OB.start.dispatch(g))},updateAtInterval:function(b,d,g){var l=this.ls.get(b);null!=l&&void 0!=l&&(l.time=
Number(d),l.running=1,l.interval=1,this.ls.set(b,l),OB.updateAtInterval.dispatch(l,Number(g)))},stop:function(b,d,g,l){b=this.ls.get(b);null!=b&&void 0!=b&&(b.running=0,b.interval=0,b.done=l,b.time=Number(d),null!=this.userId&&(this.ps.remove(this.userId+""+b.syncID),this.ps.remove(this.userId)),OB.stop.dispatch(b,Number(g)))},setTask:function(b){this.ls.set(b.ID,b)},running:function(b,d){var g=this.ls.get("list"),l,e=0,u;for(u in g)g.hasOwnProperty(u)&&(l=this.ls.get(u),null!=l&&(void 0!=l&&l.running)&&
(void 0!=b&&b(l),e++));void 0!=d&&d(e);return 0!=e},getAllRunning:function(){return this.ps.toObject()},insert:function(b,d,g){var l=this,e="null",u="",p=0;void 0!=d&&(void 0!=d.syncID&&(e=d.syncID),void 0!=d.details&&(u=d.details),void 0!=d.disable&&(p=d.disable));d=function(b,d,e,g,p){var u=l.nextID();p={ID:u,syncID:b,name:d,details:e,time:0,start:new Date,running:0,disable:p,interval:!1};if(null!=l.userId){var z=l.ps.get(l.userId+""+b);null!=z&&z.running&&(p=z)}l.ls.set(u,p);z=l.ls.get("list");
z[u]=b;l.ls.set("list",z);OB.insert.dispatch(d,{syncID:b,details:e});TASK_CNTRL.showTask(p);g&&OB.postAllItemRender.dispatch()};if("null"!=e){var z=l.ls.get("list"),N=!1,B;for(B in z)if(z.hasOwnProperty(B)&&null!=z[B]&&z[B]==e){N=!0;break}N?(e=l.ls.get(B),e.name=b,u&&Object.assign(e.details,u),l.ls.set(B,e),TASK_CNTRL.showTask(e),g&&OB.postAllItemRender.dispatch()):d(e,b,u,g,p)}else d(e,b,u,g,p)},nextID:function(){var b=this.ls.get("lastId");b++;this.ls.set("lastId",b);return b},updateValidate:function(b,
d){var g=this.ls.get(b);null!=g&&void 0!=g&&d(g)},get:function(b){return this.ls.get(b)},update:function(b,d,g){g=TASK_CNTRL.sec(g);b=this.ls.get(b);null!=b&&void 0!=b&&(b.name=d,d=b.time,b.time=g,OB.update.dispatch(b,g-d))},updateDetails:function(b,d){var g=this.ls.get(b);null!=g&&void 0!=g&&(g.details=d,this.ls.set(b,g))},remove:function(b){var d=this.ls.get("list");d[b]=null;this.ls.set("list",d);this.ls.remove(b);void 0!=TASK_CNTRL.update_intervals[b]&&window.clearInterval(TASK_CNTRL.update_intervals[b]);
void 0!=TASK_CNTRL.display_intervals[b]&&window.clearInterval(TASK_CNTRL.display_intervals[b]);OB.remove.dispatch(b)},removeall:function(){this.createDB();for(var b in TASK_CNTRL.update_intervals)window.clearInterval(TASK_CNTRL.update_intervals[b]);for(b in TASK_CNTRL.display_intervals)window.clearInterval(TASK_CNTRL.display_intervals[b]);OB.removeall.dispatch()},reset:function(b){var d=this.ls.get(b);null!=d&&void 0!=d&&(OB.reset.dispatch(b,d),d.time=0,this.ls.set(b,d))},loadAll:function(b){var d=
this.ls.get("list"),g=[],l,e;for(e in d)d.hasOwnProperty(e)&&(l=this.ls.get(e),null!=l&&void 0!=l&&g.push(l));b(g)},loadSyncIds:function(b){for(var d=this.ls.get("list"),g=[],l,e=b.length,u=0;u<e;u++)l=d.indexOf(b[u]),-1!=l&&(l=this.ls.get(l),null!=l&&void 0!=l&&g.push(l));return g}}.init()};var TASK_DB;TASK_DB=window.hasOwnProperty("chrome")&&window.chrome.hasOwnProperty("windows")||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?taskDBls():lscheck()?taskDBls():taskDB();var TASK_CNTRL=taskController(TASK_DB);Offline.options={interceptRequests:!1,requests:!1,checks:{image:{url:"https://www.atappstore.com/client/enterprise-stopwatch/icons/timer32x32.png"},active:"image"}};jQuery(function(){TASK_CNTRL.init();OB.init.dispatch()});
function onLoad(){OB.onLoad.dispatch()}window.addEventListener("beforeunload",function(b){console.log("beforeunload");if(!TASK_CNTRL.IS_EXTENSION&&TASK_DB.running(function(b){OB.onBeforeUnLoad.dispatch(b)}))return(b||window.event).returnValue="Stopwatch has a task running, are you sure?"});window.addEventListener("unload",function(b){console.log("unload");OB.onUnLoad.dispatch()});
function lscheck(){try{return localStorage.setItem("stopwatch","stopwatch"),localStorage.removeItem("stopwatch"),!0}catch(b){return!1}};var interval,notifyWorkIntervalTime=30;function startNotify(b){interval=setInterval(function(){notifyWorking(b)},6E4*notifyWorkIntervalTime)}function stopNotify(){clearInterval(interval)}function notifyWorking(b){if(window.webkitNotifications){var d=webkitNotifications.createNotification("../icons/timer48x48.png","Still working on Task:",b.name+"\n"+b.details.split(", Due:")[0]);d.show();setTimeout(function(){d.cancel()},7E3)}else stopNotify()}
function notifyFriday(){var b=webkitNotifications.createNotification("icons/timer48x48.png","Remember: Submit Timesheet!","");b.show();setTimeout(function(){b.cancel()},7E3)};
